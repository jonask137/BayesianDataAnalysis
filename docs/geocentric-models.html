<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Geocentric Models | Bayesian Data Analysis Notes</title>
  <meta name="description" content="4 Geocentric Models | Bayesian Data Analysis Notes" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Geocentric Models | Bayesian Data Analysis Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Geocentric Models | Bayesian Data Analysis Notes" />
  
  
  

<meta name="author" content="Jonas Ringive Korsholm" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-3-sampling-the-imaginary.html"/>
<link rel="next" href="lecture-notes-wrap-up-chapters-geocentric-models.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="chapter-1-golems-of-prague.html"><a href="chapter-1-golems-of-prague.html"><i class="fa fa-check"></i><b>1</b> Chapter 1 - Golems of Prague</a></li>
<li class="chapter" data-level="2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Chapter 2 - Small worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#models-and-estimation"><i class="fa fa-check"></i><b>2.1</b> Models and Estimation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#engines-motors-to-estimate-the-models"><i class="fa fa-check"></i><b>2.1.1</b> Engines / Motors to estimate the models</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.1.1.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.1.1.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.1.1.3" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.1.1.3</b> Markov Chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#exercises"><i class="fa fa-check"></i><b>2.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.2.1</b> 2M1</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.2.2</b> 2M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Chapter 3 - Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-boundaries"><i class="fa fa-check"></i><b>3.2.1</b> Defined Boundaries</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-probability-mass"><i class="fa fa-check"></i><b>3.2.2</b> Defined Probability Mass</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i><b>3.2.3</b> Point Estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i><b>3.3.1</b> Dummy Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.2</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m1-1"><i class="fa fa-check"></i><b>3.4.1</b> 3M1</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m2-1"><i class="fa fa-check"></i><b>3.4.2</b> 3M2</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m3"><i class="fa fa-check"></i><b>3.4.3</b> 3M3</a></li>
<li class="chapter" data-level="3.4.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m4"><i class="fa fa-check"></i><b>3.4.4</b> 3M4</a></li>
<li class="chapter" data-level="3.4.5" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m5"><i class="fa fa-check"></i><b>3.4.5</b> 3M5</a></li>
<li class="chapter" data-level="3.4.6" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h1"><i class="fa fa-check"></i><b>3.4.6</b> 3H1</a></li>
<li class="chapter" data-level="3.4.7" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h2"><i class="fa fa-check"></i><b>3.4.7</b> 3H2</a></li>
<li class="chapter" data-level="3.4.8" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h3"><i class="fa fa-check"></i><b>3.4.8</b> 3H3</a></li>
<li class="chapter" data-level="3.4.9" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h4"><i class="fa fa-check"></i><b>3.4.9</b> 3H4</a></li>
<li class="chapter" data-level="3.4.10" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h5"><i class="fa fa-check"></i><b>3.4.10</b> 3H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why Normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model"><i class="fa fa-check"></i><b>4.3.1</b> The model</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>4.3.3</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap"><i class="fa fa-check"></i><b>4.3.4</b> Finding the posterior distribution with quap</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap"><i class="fa fa-check"></i><b>4.3.5</b> Sampling from a quap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-lienar-mdoel-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The lienar mdoel strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution</a>
<ul>
<li class="chapter" data-level="4.4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#tables-fo-marginal-distributions"><i class="fa fa-check"></i><b>4.4.3.1</b> Tables fo marginal distributions</a></li>
<li class="chapter" data-level="4.4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-posterior-inference-against-the-data"><i class="fa fa-check"></i><b>4.4.3.2</b> Plotting posterior inference against the data</a></li>
<li class="chapter" data-level="4.4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#adding-uncertainty-around-the-mean"><i class="fa fa-check"></i><b>4.4.3.3</b> Adding uncertainty around the mean</a></li>
<li class="chapter" data-level="4.4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-regression-intervlas-and-contours"><i class="fa fa-check"></i><b>4.4.3.4</b> Plotting regression intervlas and contours</a></li>
<li class="chapter" data-level="4.4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#prediction-intevals"><i class="fa fa-check"></i><b>4.4.3.5</b> Prediction intevals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-form-lines"><i class="fa fa-check"></i><b>4.5</b> Curves form lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i><b>4.5.2</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#exercises-2"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-models.html"><a href="geocentric-models.html#m1-2"><i class="fa fa-check"></i><b>4.6.1</b> 4M1</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-models.html"><a href="geocentric-models.html#m8"><i class="fa fa-check"></i><b>4.6.2</b> 4M8</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-models.html"><a href="geocentric-models.html#h1-1"><i class="fa fa-check"></i><b>4.6.3</b> 4H1</a></li>
<li class="chapter" data-level="4.6.4" data-path="geocentric-models.html"><a href="geocentric-models.html#h2-1"><i class="fa fa-check"></i><b>4.6.4</b> 4H2</a></li>
<li class="chapter" data-level="4.6.5" data-path="geocentric-models.html"><a href="geocentric-models.html#h3-1"><i class="fa fa-check"></i><b>4.6.5</b> 4H3</a></li>
<li class="chapter" data-level="4.6.6" data-path="geocentric-models.html"><a href="geocentric-models.html#h6"><i class="fa fa-check"></i><b>4.6.6</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lecture-notes-wrap-up-chapters-geocentric-models.html"><a href="lecture-notes-wrap-up-chapters-geocentric-models.html"><i class="fa fa-check"></i><b>5</b> Lecture notes - wrap up chapters geocentric models</a></li>
<li class="chapter" data-level="6" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>6.1</b> Spurious Associations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#defining-a-multiple-regression"><i class="fa fa-check"></i><b>6.1.1</b> Defining a multiple regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#approximating-the-posterior"><i class="fa fa-check"></i><b>6.1.2</b> Approximating the posterior</a></li>
<li class="chapter" data-level="6.1.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#the-flow"><i class="fa fa-check"></i><b>6.1.3</b> The flow</a>
<ul>
<li class="chapter" data-level="6.1.3.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>6.1.3.1</b> Posterior Prediction Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>6.2</b> Masked Relationship</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>6.3</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#lecture-notes---not-integrated-in-the-notes"><i class="fa fa-check"></i><b>6.4</b> Lecture notes - not integrated in the notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>7.1</b> Multicollinearity</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post Treatment Bias</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>7.4</b> Confronting Confounding</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#exercises-3"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m1-3"><i class="fa fa-check"></i><b>7.5.1</b> 6M1</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m3-1"><i class="fa fa-check"></i><b>7.5.2</b> 6M3</a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h"><i class="fa fa-check"></i><b>7.5.3</b> 6H</a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h3-2"><i class="fa fa-check"></i><b>7.5.4</b> 6H3</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h4-1"><i class="fa fa-check"></i><b>7.5.5</b> 6H4</a></li>
<li class="chapter" data-level="7.5.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h5-1"><i class="fa fa-check"></i><b>7.5.6</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#lecture-notes---not-integrated-in-the-text"><i class="fa fa-check"></i><b>7.6</b> Lecture notes - not integrated in the text</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model comparison</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The problem with parameters</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem Taming: Regularization</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>8.4</b> Predicting predictive accuracy</a></li>
<li class="chapter" data-level="8.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#model-comparison"><i class="fa fa-check"></i><b>8.5</b> Model Comparison</a></li>
<li class="chapter" data-level="8.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#exercies"><i class="fa fa-check"></i><b>8.6</b> Exercies</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#medium-exercises"><i class="fa fa-check"></i><b>8.6.1</b> Medium exercises</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#hard-exercises"><i class="fa fa-check"></i><b>8.6.2</b> Hard exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html"><i class="fa fa-check"></i><b>9</b> Chapter 8 - Model comparison</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>9.1.1</b> Adding an indicator variable isn’t enough.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#continuous-interactions"><i class="fa fa-check"></i><b>9.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#a-winter-flower"><i class="fa fa-check"></i><b>9.3.1</b> A Winter Flower</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#the-models"><i class="fa fa-check"></i><b>9.3.2</b> The models</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#exercises-4"><i class="fa fa-check"></i><b>9.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#m4-1"><i class="fa fa-check"></i><b>9.4.1</b> 8M4</a>
<ul>
<li class="chapter" data-level="9.4.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#interaction-model"><i class="fa fa-check"></i><b>9.4.1.1</b> Interaction model</a></li>
<li class="chapter" data-level="9.4.1.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#conclusion"><i class="fa fa-check"></i><b>9.4.1.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#h3-3"><i class="fa fa-check"></i><b>9.4.2</b> 8H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>10</b> Chapter 9 - Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algorithms</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#easy-hmc-ulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: ulam</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-quap"><i class="fa fa-check"></i><b>10.4.1</b> Fitting using quap</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-hmc"><i class="fa fa-check"></i><b>10.4.2</b> Fitting using HMC</a>
<ul>
<li class="chapter" data-level="10.4.2.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#preparing-data"><i class="fa fa-check"></i><b>10.4.2.1</b> Preparing data</a></li>
<li class="chapter" data-level="10.4.2.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-from-the-posterior-1"><i class="fa fa-check"></i><b>10.4.2.2</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="10.4.2.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>10.4.2.3</b> Sampling again, in parallel</a></li>
<li class="chapter" data-level="10.4.2.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>10.4.2.4</b> Visualization</a></li>
<li class="chapter" data-level="10.4.2.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.2.5</b> Checking the chain</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>10.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="10.5.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>10.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="10.5.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#taming-a-wild-chain"><i class="fa fa-check"></i><b>10.5.3</b> Taming a wild chain</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#exercises-5"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e4"><i class="fa fa-check"></i><b>10.6.1</b> E4</a></li>
<li class="chapter" data-level="10.6.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e5"><i class="fa fa-check"></i><b>10.6.2</b> E5</a></li>
<li class="chapter" data-level="10.6.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e6"><i class="fa fa-check"></i><b>10.6.3</b> E6</a></li>
<li class="chapter" data-level="10.6.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e7"><i class="fa fa-check"></i><b>10.6.4</b> E7</a></li>
<li class="chapter" data-level="10.6.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#m1-4"><i class="fa fa-check"></i><b>10.6.5</b> M1</a></li>
<li class="chapter" data-level="10.6.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#h2-2"><i class="fa fa-check"></i><b>10.6.6</b> H2</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#lecture-notes"><i class="fa fa-check"></i><b>10.7</b> Lecture notes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>11</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>11.1.1</b> Binomial</a>
<ul>
<li class="chapter" data-level="11.1.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#example-from-the-lecture"><i class="fa fa-check"></i><b>11.1.1.1</b> Example from the lecture</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="11.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy-priors"><i class="fa fa-check"></i><b>11.3</b> Maximum entropy priors</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>12</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="12.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression</a>
<ul>
<li class="chapter" data-level="12.1.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.0.1</b> Logistic regression: Prosocial chimpanzees:</a></li>
<li class="chapter" data-level="12.1.0.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.0.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="12.1.0.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>12.1.0.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="12.1.0.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.0.4</b> Aggregated binomial: Graduate school admissions</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression</a>
<ul>
<li class="chapter" data-level="12.2.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>12.2.0.1</b> Negative binomial (gamma-poisson) models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-regression"><i class="fa fa-check"></i><b>12.3</b> Multinomial Regression</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-from-the-lecture-1"><i class="fa fa-check"></i><b>12.3.1</b> Example from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#exercies-1"><i class="fa fa-check"></i><b>12.4</b> Exercies</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>12.4.1</b> E1</a></li>
<li class="chapter" data-level="12.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2"><i class="fa fa-check"></i><b>12.4.2</b> E2</a></li>
<li class="chapter" data-level="12.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3"><i class="fa fa-check"></i><b>12.4.3</b> E3</a></li>
<li class="chapter" data-level="12.4.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7"><i class="fa fa-check"></i><b>12.4.4</b> M7</a></li>
<li class="chapter" data-level="12.4.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-2"><i class="fa fa-check"></i><b>12.4.5</b> H1</a></li>
<li class="chapter" data-level="12.4.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-3"><i class="fa fa-check"></i><b>12.4.6</b> H2</a></li>
<li class="chapter" data-level="12.4.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-4"><i class="fa fa-check"></i><b>12.4.7</b> H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Ch 13 - Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-effects-and-the-underfitting-overfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting / overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-model-1"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#assign-values-to-the-parameters"><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.3</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a></li>
<li class="chapter" data-level="13.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.0.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-devils-funnel-example"><i class="fa fa-check"></i><b>13.4.0.1</b> The Devil’s Funnel: (example)</a></li>
<li class="chapter" data-level="13.4.0.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#non-centered-chimpanzees-example"><i class="fa fa-check"></i><b>13.4.0.2</b> Non-centered chimpanzees (example)</a>
<ul>
<li class="chapter" data-level="13.4.0.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-1-centered-parameterization-increasing-acceptance-rate"><i class="fa fa-check"></i><b>13.4.0.2.1</b> Solution 1: Centered parameterization (Increasing acceptance rate)</a></li>
<li class="chapter" data-level="13.4.0.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-2-non-centered-version-reparameterize"><i class="fa fa-check"></i><b>13.4.0.2.2</b> Solution 2: Non-centered version (reparameterize)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#exercises-6"><i class="fa fa-check"></i><b>13.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e1-1"><i class="fa fa-check"></i><b>13.6.1</b> E1</a></li>
<li class="chapter" data-level="13.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e2-1"><i class="fa fa-check"></i><b>13.6.2</b> E2</a></li>
<li class="chapter" data-level="13.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e3-1"><i class="fa fa-check"></i><b>13.6.3</b> E3</a></li>
<li class="chapter" data-level="13.6.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e4-1"><i class="fa fa-check"></i><b>13.6.4</b> E4</a></li>
<li class="chapter" data-level="13.6.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#m1-5"><i class="fa fa-check"></i><b>13.6.5</b> M1</a></li>
<li class="chapter" data-level="13.6.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#h1-3"><i class="fa fa-check"></i><b>13.6.6</b> H1</a>
<ul>
<li class="chapter" data-level="13.6.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#fixed-effects-model"><i class="fa fa-check"></i><b>13.6.6.1</b> Fixed effects model:</a></li>
<li class="chapter" data-level="13.6.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-intercepts-model"><i class="fa fa-check"></i><b>13.6.6.2</b> Varying intercepts model:</a></li>
<li class="chapter" data-level="13.6.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#extract-samples"><i class="fa fa-check"></i><b>13.6.6.3</b> Extract samples</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html"><i class="fa fa-check"></i><b>14</b> Ch 14 - Advuntetures in Coviaraince</a>
<ul>
<li class="chapter" data-level="14.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-the-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population</a></li>
<li class="chapter" data-level="14.1.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-observations"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations</a></li>
<li class="chapter" data-level="14.1.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a>
<ul>
<li class="chapter" data-level="14.2.0.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#inference"><i class="fa fa-check"></i><b>14.2.0.1</b> Inference!</a></li>
<li class="chapter" data-level="14.2.0.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#conclusions---multilevel-horoscopes"><i class="fa fa-check"></i><b>14.2.0.2</b> Conclusions - multilevel horoscopes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#exercises-7"><i class="fa fa-check"></i><b>14.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e1-2"><i class="fa fa-check"></i><b>14.3.1</b> E1</a></li>
<li class="chapter" data-level="14.3.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e3-2"><i class="fa fa-check"></i><b>14.3.2</b> E3</a></li>
<li class="chapter" data-level="14.3.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h1-4"><i class="fa fa-check"></i><b>14.3.3</b> H1</a></li>
<li class="chapter" data-level="14.3.4" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h2-4"><i class="fa fa-check"></i><b>14.3.4</b> H2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html"><i class="fa fa-check"></i><b>15</b> Ch 14 - Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="15.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#ch-14.3---instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.1</b> Ch 14.3 - Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>15.1.1</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.1.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#only-including-e-we-add-confounding-effect-sideeffect-of-e"><i class="fa fa-check"></i><b>15.1.1.1</b> 1. Only including E (we add confounding effect sideeffect of E)</a></li>
<li class="chapter" data-level="15.1.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#adding-instrument-q-the-wrong-way"><i class="fa fa-check"></i><b>15.1.1.2</b> 2. Adding instrument Q (the wrong way)</a></li>
<li class="chapter" data-level="15.1.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#correct-use-of-the-instrument-variable"><i class="fa fa-check"></i><b>15.1.1.3</b> 3. Correct use of the instrument variable</a></li>
</ul></li>
<li class="chapter" data-level="15.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>15.1.2</b> Other designs</a>
<ul>
<li class="chapter" data-level="15.1.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#front-door-criterion"><i class="fa fa-check"></i><b>15.1.2.1</b> Front-Door Criterion</a></li>
<li class="chapter" data-level="15.1.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#regression-discontinuity-rdd"><i class="fa fa-check"></i><b>15.1.2.2</b> Regression discontinuity (RDD)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-processes-continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.2</b> (Gaussian Processes) Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>15.2.1</b> Example: Spatial autocorrelation in Oceanic tools</a>
<ul>
<li class="chapter" data-level="15.2.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#loading-data-defining-model"><i class="fa fa-check"></i><b>15.2.1.1</b> Loading data + defining model</a></li>
<li class="chapter" data-level="15.2.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#the-full-model"><i class="fa fa-check"></i><b>15.2.1.2</b> The full model</a></li>
<li class="chapter" data-level="15.2.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-process-posterior"><i class="fa fa-check"></i><b>15.2.1.3</b> Gaussian Process Posterior</a></li>
</ul></li>
<li class="chapter" data-level="15.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-phylogenetic-distance-not-in-the-curriculum"><i class="fa fa-check"></i><b>15.2.2</b> Example: Phylogenetic distance (not in the curriculum)</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#exercises-8"><i class="fa fa-check"></i><b>15.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m3-2"><i class="fa fa-check"></i><b>15.3.1</b> M3</a></li>
<li class="chapter" data-level="15.3.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m4-2"><i class="fa fa-check"></i><b>15.3.2</b> M4</a></li>
<li class="chapter" data-level="15.3.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h2-5"><i class="fa fa-check"></i><b>15.3.3</b> H2</a></li>
<li class="chapter" data-level="15.3.4" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h4-varying-intercepts-varying-slopes"><i class="fa fa-check"></i><b>15.3.4</b> H4 Varying intercepts Varying slopes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="geocentric-models" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Geocentric Models</h1>
<p><em>This chapter introduce lienar regression as a Bayesian procedure</em>. Thus we will apply probability measures for intepretation, as that is what Bayesian is.</p>
<div id="why-normal-distributions-are-normal" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Why Normal distributions are normal</h2>
<p>This section examplifies why normal distributions are normal and how it is often seen in nature. Jesper shows an example where binomial random draws will tend to be centered around 0 as there are the most paths leading towards the middle. That is why we often find the normal distribution in real life.</p>
<p>It express that normal distributions come from addition of random events, e.g., the result of consecutive coin tosses. Also the product of small numbers approximate addition, hence the result of such outcomes is similar to the added scenario.</p>
<p>Although with large numbers we will tend not to get a normal distribution by finding the product hereof.</p>
<p>The book aim to teaach a strategy to model data and not a single model just for the toolbox.</p>
</div>
<div id="a-language-for-describing-models" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> A language for describing models</h2>
<p>This chapter summarize how models are defined and defines mathematical terminalogy.</p>
<p><strong>Recipe of defining models</strong></p>
<ol style="list-style-type: decimal">
<li><p>Recognize the variables that you want to understand. Observable variables = data. While unobservable things = parameters, e.g., averages and rates, e.g., you dont observe GDP growth rates, but it can be deducted from assessing varaibles (observed data).</p></li>
<li><p>Each variable can be defined in terms of other variables or in terms of a probability distribution. This enables one to learn about associations between variables.</p></li>
<li><p>The combination of variables and their probability distributions defines a joint generative model. This can be used to simulate hypothetical observations as well as analyze real ones.</p></li>
</ol>
<p><strong>Mathematical terminology:</strong></p>
<p>We see that <span class="math inline">\(W \sim Binomial(N,p)\)</span> means that W (water) variable is binomial, it has two outcomes, yes or no. and then we have <span class="math inline">\(p ~ Uniform(0,1)\)</span>, means that p (proportion of water on the globe) is between 0 and 1.</p>
<p>Notice that the wavy symbol <code>~</code> means that the models are <strong><em>stochastic</em></strong>, i.e., there are no instances on the left that are known with certainty. I.e., W is distributed as binomial</p>
<p><strong>Regarding priors:</strong></p>
<p>The priors must be set before you see the data, as if you did not do that, then it is no more a prior.</p>
<p>If you have no idea what to set as a prior, then you set it to some random value, e.g., making it uniform to be within a specific range.</p>
</div>
<div id="gaussian-model-of-height" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Gaussian model of height</h2>
<p>The following is an example to understand normal distributions of normal distributions.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="geocentric-models.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb69-2"><a href="geocentric-models.html#cb69-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1 <span class="co">#d for data frame</span></span>
<span id="cb69-3"><a href="geocentric-models.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(d)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    544 obs. of  4 variables:
##  $ height: num  152 140 137 157 145 ...
##  $ weight: num  47.8 36.5 31.9 53 41.3 ...
##  $ age   : num  63 63 65 41 51 35 32 27 19 54 ...
##  $ male  : int  1 0 0 1 0 1 0 1 0 1 ...</code></pre>
<p>We see that we have height, wiehgt, age and male.</p>
<p>This can also be summarized with mean, sd, percentiles and histograms.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="geocentric-models.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(d)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">138.2635963</td>
</tr>
<tr class="even">
<td align="right">35.6106176</td>
</tr>
<tr class="odd">
<td align="right">29.3443934</td>
</tr>
<tr class="even">
<td align="right">0.4724265</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">27.6024476</td>
</tr>
<tr class="even">
<td align="right">14.7191782</td>
</tr>
<tr class="odd">
<td align="right">20.7468882</td>
</tr>
<tr class="even">
<td align="right">0.4996986</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">81.108550</td>
</tr>
<tr class="even">
<td align="right">9.360721</td>
</tr>
<tr class="odd">
<td align="right">1.000000</td>
</tr>
<tr class="even">
<td align="right">0.000000</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">165.73500</td>
</tr>
<tr class="even">
<td align="right">54.50289</td>
</tr>
<tr class="odd">
<td align="right">66.13500</td>
</tr>
<tr class="even">
<td align="right">1.00000</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">▁▁▁▁▁▁▁▂▁▇▇▅▁</td>
</tr>
<tr class="even">
<td align="left">▁▂▃▂▂▂▂▅▇▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">▇▅▅▃▅▂▂▁▁</td>
</tr>
<tr class="even">
<td align="left">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>And thus we see the distributions. We are only going to be working with people above or equal to 18 years of age.</p>
<p>Notice that we cannot use the histograms to suggest a distribution, that is because we need to select the priors on berforehand.</p>
<p>The precis function also shows the compatibility intervals (recall the probability intervals)</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="geocentric-models.html#cb72-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span></code></pre></div>
<div id="the-model" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> The model</h3>
<p>Now we can define the model with with the following terms:</p>
<p><span class="math display">\[h_i \sim Normal(\mu,\sigma)\]</span></p>
<p><span class="math inline">\(h_i \sim \mathcal{N}\)</span>, this is exactly the same, just shortened.</p>
<p>Meaning that height is stochastic, given the wavy character <code>~</code>, it is normal with mu and sigma mean and standard deviation. The <code>i</code> means each element in vector <code>h</code>.</p>
<p>Now we can specify the priors. <em>this is done independently for each parameter (unobserved)</em>. It looks the following:</p>
<p><img src="Images/paste-A88626AF.png" /></p>
<p>We see that we have the likelihood that consist of the priors, which are specified afterwards. This can be plotted with.</p>
<p>It means that the mean is centered in 178 and 20 standard deviation, thus two standard deviations (95% being 40), we will have 95% of the people within 178 +- 40.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="geocentric-models.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,<span class="dv">178</span>,<span class="dv">20</span>),<span class="at">from =</span> <span class="dv">100</span>,<span class="at">to =</span> <span class="dv">250</span>,<span class="at">main =</span> <span class="st">&#39;Mean prior&#39;</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.12-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="geocentric-models.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dunif</span>(x,<span class="dv">0</span>,<span class="dv">50</span>),<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>,<span class="at">to =</span> <span class="dv">60</span>,<span class="at">main =</span> <span class="st">&quot;Sigma prior&quot;</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.12-2.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now one can sample heights based on the two priors.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="geocentric-models.html#cb75-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb75-2"><a href="geocentric-models.html#cb75-2" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(samples,<span class="dv">178</span>,<span class="dv">20</span>) <span class="co">#notice we cannot take the mean of the data, as it is a prior!!!</span></span>
<span id="cb75-3"><a href="geocentric-models.html#cb75-3" aria-hidden="true" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">runif</span>(samples,<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb75-4"><a href="geocentric-models.html#cb75-4" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(samples,sample_mu,sample_sigma)</span>
<span id="cb75-5"><a href="geocentric-models.html#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.14-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>One see that the mean is around the 178. The more samples we draw, the more normal will it look.</p>
<p>Now this makes sense since the mean standard deviation is rather low, lets look at an example with a large standard deviation to the mean.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="geocentric-models.html#cb76-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb76-2"><a href="geocentric-models.html#cb76-2" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(samples,<span class="dv">178</span>,<span class="dv">100</span>) <span class="co">#notice we cannot take the mean of the data, as it is a prior!!!</span></span>
<span id="cb76-3"><a href="geocentric-models.html#cb76-3" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(samples,sample_mu,sample_sigma)</span>
<span id="cb76-4"><a href="geocentric-models.html#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.15-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we see that the height can go all the way up to 600 and down to a negative number.</p>
<p>When you have a lot of data instances, then such a prior is not harmfull even though it clearly expects a lot of people being very tall and some even below 0. So having an unreasonable prior is not necessarily bad.</p>
</div>
<div id="grid-approximation-of-the-posterior-distribution" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Grid approximation of the posterior distribution</h3>
<p><strong><em>Notice that in practice we dont really do this, as it is computationally heavy. Although it is shown for explanatory reasons.</em></strong></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="geocentric-models.html#cb77-1" aria-hidden="true" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">160</span>, <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb77-2"><a href="geocentric-models.html#cb77-2" aria-hidden="true" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">7</span>, <span class="at">to=</span><span class="dv">9</span>, <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb77-3"><a href="geocentric-models.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="geocentric-models.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Expand list, mu and sigma, </span></span>
<span id="cb77-5"><a href="geocentric-models.html#cb77-5" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">mu =</span> mu.list, <span class="at">sigma =</span> sigma.list)</span>
<span id="cb77-6"><a href="geocentric-models.html#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="geocentric-models.html#cb77-7" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post), <span class="cf">function</span>(i) <span class="fu">sum</span>(</span>
<span id="cb77-8"><a href="geocentric-models.html#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>(<span class="at">x =</span> d2<span class="sc">$</span>height</span>
<span id="cb77-9"><a href="geocentric-models.html#cb77-9" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">mean =</span> post<span class="sc">$</span>mu[i]</span>
<span id="cb77-10"><a href="geocentric-models.html#cb77-10" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">sd =</span> post<span class="sc">$</span>sigma[i]</span>
<span id="cb77-11"><a href="geocentric-models.html#cb77-11" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-12"><a href="geocentric-models.html#cb77-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-13"><a href="geocentric-models.html#cb77-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-14"><a href="geocentric-models.html#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="geocentric-models.html#cb77-15" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prod <span class="ot">&lt;-</span> post<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb77-16"><a href="geocentric-models.html#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dunif</span>(post<span class="sc">$</span>sigma,<span class="dv">0</span>, <span class="dv">50</span>, <span class="cn">TRUE</span>)</span>
<span id="cb77-17"><a href="geocentric-models.html#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="geocentric-models.html#cb77-18" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>(post<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post<span class="sc">$</span>prod))</span></code></pre></div>
<p>Now, lets inspect the posterior distribution</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="geocentric-models.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb78-2"><a href="geocentric-models.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#A contour plot</span></span>
<span id="cb78-3"><a href="geocentric-models.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">contour_xyz</span>(post<span class="sc">$</span>mu, post<span class="sc">$</span>sigma, post<span class="sc">$</span>prob)</span>
<span id="cb78-4"><a href="geocentric-models.html#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="geocentric-models.html#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co">#A heatmap</span></span>
<span id="cb78-6"><a href="geocentric-models.html#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="fu">image_xyz</span>(<span class="at">x =</span> post<span class="sc">$</span>mu,<span class="at">y =</span>  post<span class="sc">$</span>sigma,<span class="at">z =</span>  post<span class="sc">$</span>prob)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.17-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>What we get from this, is the most probable combinations of the mu and sigma. Hence we see that very often the mean will be between 154 and 155 while the standard deviation is between 7.5 and 8.</p>
</div>
<div id="sampling-from-the-posterior" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Sampling from the posterior</h3>
<p>Now we are going to sample from the posterior, just as in the globe tossing problem. Here we are just also to sample from the mean and standard deviation. This is done by first making a set of samples, where each row number is listed, basically just an index.</p>
<p>Then we use the index to return the given mean and standard deviation.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="geocentric-models.html#cb79-1" aria-hidden="true" tabindex="-1"></a>sample.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post),<span class="at">size =</span> <span class="dv">10000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co">#We can draw the same instance twice</span></span>
<span id="cb79-2"><a href="geocentric-models.html#cb79-2" aria-hidden="true" tabindex="-1"></a>sample.mu <span class="ot">&lt;-</span> post<span class="sc">$</span>mu[sample.rows]</span>
<span id="cb79-3"><a href="geocentric-models.html#cb79-3" aria-hidden="true" tabindex="-1"></a>sample.sigma <span class="ot">&lt;-</span> post<span class="sc">$</span>sigma[sample.rows]</span></code></pre></div>
<p>We see that <code>post$mu</code> and <code>sigma</code> is a grid ranging from respectively 150 to 160 and 7 to 9. e.g.,</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="geocentric-models.html#cb80-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(post<span class="sc">$</span>mu,<span class="at">nrow =</span> <span class="dv">100</span>,<span class="at">ncol =</span> <span class="dv">100</span>)</span>
<span id="cb80-2"><a href="geocentric-models.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(m[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>],<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##           [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]     [,8]
##  [1,] 150.0000 150.0000 150.0000 150.0000 150.0000 150.0000 150.0000 150.0000
##  [2,] 150.1010 150.1010 150.1010 150.1010 150.1010 150.1010 150.1010 150.1010
##  [3,] 150.2020 150.2020 150.2020 150.2020 150.2020 150.2020 150.2020 150.2020
##  [4,] 150.3030 150.3030 150.3030 150.3030 150.3030 150.3030 150.3030 150.3030
##  [5,] 150.4040 150.4040 150.4040 150.4040 150.4040 150.4040 150.4040 150.4040
##  [6,] 150.5051 150.5051 150.5051 150.5051 150.5051 150.5051 150.5051 150.5051
##  [7,] 150.6061 150.6061 150.6061 150.6061 150.6061 150.6061 150.6061 150.6061
##  [8,] 150.7071 150.7071 150.7071 150.7071 150.7071 150.7071 150.7071 150.7071
##  [9,] 150.8081 150.8081 150.8081 150.8081 150.8081 150.8081 150.8081 150.8081
## [10,] 150.9091 150.9091 150.9091 150.9091 150.9091 150.9091 150.9091 150.9091
##           [,9]    [,10]
##  [1,] 150.0000 150.0000
##  [2,] 150.1010 150.1010
##  [3,] 150.2020 150.2020
##  [4,] 150.3030 150.3030
##  [5,] 150.4040 150.4040
##  [6,] 150.5051 150.5051
##  [7,] 150.6061 150.6061
##  [8,] 150.7071 150.7071
##  [9,] 150.8081 150.8081
## [10,] 150.9091 150.9091</code></pre>
<p>Now lets plot the samples.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="geocentric-models.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb82-2"><a href="geocentric-models.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sample.mu,sample.sigma</span>
<span id="cb82-3"><a href="geocentric-models.html#cb82-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">cex =</span> <span class="fl">0.5</span>,<span class="at">pch =</span> <span class="dv">16</span> <span class="co">#Dot sizes and shape</span></span>
<span id="cb82-4"><a href="geocentric-models.html#cb82-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>) <span class="co">#make transparant colors</span></span>
<span id="cb82-5"><a href="geocentric-models.html#cb82-5" aria-hidden="true" tabindex="-1"></a>     )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.20-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we can inspect the priors.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="geocentric-models.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb83-2"><a href="geocentric-models.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample.mu)</span>
<span id="cb83-3"><a href="geocentric-models.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample.sigma)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.21-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>These should have been more or less normally distributed according to the book, but for some reason they are not.</p>
</div>
<div id="finding-the-posterior-distribution-with-quap" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Finding the posterior distribution with quap</h3>
<p>This is using quadratic approximation.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="geocentric-models.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb84-2"><a href="geocentric-models.html#cb84-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb84-3"><a href="geocentric-models.html#cb84-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span></code></pre></div>
<p>We can spcify the model with the following:</p>
<p><span class="math display">\[h_i \sim Normal(\mu,\sigma)\]</span> <span class="math display">\[\mu \sim Normal(178,20)\]</span> <span class="math display">\[\sigma \sim Uniform(0,150)\]</span></p>
<p>While the equivilent in code is:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="geocentric-models.html#cb85-1" aria-hidden="true" tabindex="-1"></a>height <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb85-2"><a href="geocentric-models.html#cb85-2" aria-hidden="true" tabindex="-1"></a>mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>,<span class="dv">10</span>)</span>
<span id="cb85-3"><a href="geocentric-models.html#cb85-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span></code></pre></div>
<p>This can be placed in a list:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="geocentric-models.html#cb86-1" aria-hidden="true" tabindex="-1"></a>flist <span class="ot">&lt;-</span>  <span class="fu">alist</span>(</span>
<span id="cb86-2"><a href="geocentric-models.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  height <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb86-3"><a href="geocentric-models.html#cb86-3" aria-hidden="true" tabindex="-1"></a>  ,mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>,<span class="dv">10</span>)</span>
<span id="cb86-4"><a href="geocentric-models.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  ,sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb86-5"><a href="geocentric-models.html#cb86-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Now we can fit the model to the data:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="geocentric-models.html#cb87-1" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(flist,<span class="at">data =</span> d2)</span>
<span id="cb87-2"><a href="geocentric-models.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.1</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.636775</td>
</tr>
<tr class="even">
<td align="right">7.731408</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4117468</td>
</tr>
<tr class="even">
<td align="right">0.2913949</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">153.978724</td>
</tr>
<tr class="even">
<td align="right">7.265703</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">155.294826</td>
</tr>
<tr class="even">
<td align="right">8.197114</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="sampling-from-a-quap" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Sampling from a quap</h3>
<p>Now we are going to sample from the quadratic approximation.</p>
<p>Covariances is key to quadratic approximation. This can be found with:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="geocentric-models.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(m4<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##                 mu        sigma
## mu    0.1695354471 0.0008701619
## sigma 0.0008701619 0.0849109920</code></pre>
<p>This tells us how each parameter (unobserved) relates to every other parameter in the posterior distribution. In this scenario covariance does not matter a lot, but when we have a predictor variable, it will be key.</p>
<p>This can be extended to 2 elements:</p>
<ol style="list-style-type: decimal">
<li>A vector of variances for the parameters</li>
<li>A correlation matrix that tells us how changes in any parameter lead to correlated changes in others.</li>
</ol>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="geocentric-models.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(<span class="fu">vcov</span>(m4<span class="fl">.1</span>))</span>
<span id="cb90-2"><a href="geocentric-models.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov2cor</span>(<span class="fu">vcov</span>(m4<span class="fl">.1</span>))</span></code></pre></div>
<pre><code>##         mu      sigma 
## 0.16953545 0.08491099 
##                mu       sigma
## mu    1.000000000 0.007252502
## sigma 0.007252502 1.000000000</code></pre>
<p>We see that a change of 1 in mu will lead to a change of 1 in mu, and it will lead to a change of 0.0018 in sigma. This is very small, hence we can see that there is no correlation between the two of these. <em>Thus, learning the mean will not tell anything about the standard deviation.</em></p>
<p><strong>Getting samples</strong></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="geocentric-models.html#cb92-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.1</span>,<span class="at">n =</span> <span class="dv">10000</span>)</span>
<span id="cb92-2"><a href="geocentric-models.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">mu</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.2506</td>
<td align="right">7.260139</td>
</tr>
<tr class="even">
<td align="right">155.2653</td>
<td align="right">7.831658</td>
</tr>
<tr class="odd">
<td align="right">155.2295</td>
<td align="right">8.015096</td>
</tr>
<tr class="even">
<td align="right">155.4242</td>
<td align="right">7.819525</td>
</tr>
<tr class="odd">
<td align="right">154.6868</td>
<td align="right">8.088762</td>
</tr>
<tr class="even">
<td align="right">154.5212</td>
<td align="right">8.095557</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="geocentric-models.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(post)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.633205</td>
</tr>
<tr class="even">
<td align="right">7.736503</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4122893</td>
</tr>
<tr class="even">
<td align="right">0.2928388</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">153.971768</td>
</tr>
<tr class="even">
<td align="right">7.265452</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">155.291918</td>
</tr>
<tr class="even">
<td align="right">8.206378</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">▁▁▅▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">▁▁▁▂▅▇▇▃▁▁▁</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We can see that distributions look more or less normal.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="geocentric-models.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(post,<span class="at">pch =</span> <span class="dv">20</span></span>
<span id="cb94-2"><a href="geocentric-models.html#cb94-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-50-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="linear-prediction" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Linear prediction</h2>
<hr />
<p><em>The procedure that we end up going through:</em></p>
<p><em>1. Use <code>link</code> to generate distributions of posterior value for mu.</em></p>
<p><em>2. Use summary functions like <code>mean</code> or <code>PI</code> to find averages and lower and upper bounds of mu, for each value of the predictor variable.</em></p>
<p><em>3. Finally, use plotting functions like <code>lines</code> and <code>shade</code> to draw the lines and intervels. Or you might plot the distributions of the predictions, or do even something else.</em></p>
<hr />
<p>Now we are going to regress one variable on another, hence we have a predictor and an outcome variable. The following example is predicting height given the weight.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="geocentric-models.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(d2<span class="sc">$</span>height <span class="sc">~</span> d2<span class="sc">$</span>weight)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-51-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>There is clearly a relationship.</p>
<div id="the-lienar-mdoel-strategy" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> The lienar mdoel strategy</h3>
<p>To specify this model we will say:</p>
<p><em>let x = weight, thus</em> <span class="math inline">\(\bar{x}\)</span> is the average weight parameter of the observed variable.</p>
<p><img src="Images/paste-604F2802.png" /></p>
<p>Now we see that heights are stochastic and normally distributed and is described by the mean and standard deviation. To predict height, we need the mean of the weight variable. This one is deterministic hence the <code>=</code> and not the <code>~</code> sign. It consists of the priors (assumptions), where we express <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span>. These are all stochastic, where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are normally distributed while <span class="math inline">\(\sigma\)</span> is uniform.</p>
<p>Now one can simulate the priors.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="geocentric-models.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb96-2"><a href="geocentric-models.html#cb96-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb96-3"><a href="geocentric-models.html#cb96-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">178</span>,<span class="dv">20</span>) <span class="co">#notice we cannot take the mean of the data, as it is a prior!!!</span></span>
<span id="cb96-4"><a href="geocentric-models.html#cb96-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="dv">10</span>)</span></code></pre></div>
<p>This returns 100 pairs of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>. This can be plotted with:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="geocentric-models.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span> </span>
<span id="cb97-2"><a href="geocentric-models.html#cb97-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>)</span>
<span id="cb97-3"><a href="geocentric-models.html#cb97-3" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span> )</span>
<span id="cb97-4"><a href="geocentric-models.html#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="geocentric-models.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb97-6"><a href="geocentric-models.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb97-7"><a href="geocentric-models.html#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;b ~ dnorm(0,10)&quot;</span>)</span>
<span id="cb97-8"><a href="geocentric-models.html#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="geocentric-models.html#cb97-9" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb97-10"><a href="geocentric-models.html#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x <span class="sc">-</span> xbar)</span>
<span id="cb97-11"><a href="geocentric-models.html#cb97-11" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight), <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb97-12"><a href="geocentric-models.html#cb97-12" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">add=</span><span class="cn">TRUE</span></span>
<span id="cb97-13"><a href="geocentric-models.html#cb97-13" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.39-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that that we get many predictions where we expect a person to be higher than the worlds largest and smaller than the worlds smallest. We can address with by taking the logarithm, which is done in the following:</p>
<p><img src="Images/paste-6503E9ED.png" /></p>
<p>Hence we see that log is added to the equation.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="geocentric-models.html#cb98-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="dv">10000</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb98-2"><a href="geocentric-models.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(b,<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),<span class="at">adj=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.40-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Doing the prior predictive simulation again, to compare with the logarithm of beta.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="geocentric-models.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb99-2"><a href="geocentric-models.html#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="geocentric-models.html#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb99-4"><a href="geocentric-models.html#cb99-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb99-5"><a href="geocentric-models.html#cb99-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">178</span>,<span class="dv">20</span>)</span>
<span id="cb99-6"><a href="geocentric-models.html#cb99-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb99-7"><a href="geocentric-models.html#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span>,<span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>),<span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span> )</span>
<span id="cb99-8"><a href="geocentric-models.html#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb99-9"><a href="geocentric-models.html#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb99-10"><a href="geocentric-models.html#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;b ~ dnorm(0,10)&quot;</span>)</span>
<span id="cb99-11"><a href="geocentric-models.html#cb99-11" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb99-12"><a href="geocentric-models.html#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x <span class="sc">-</span> xbar),<span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight), <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),<span class="at">add=</span><span class="cn">TRUE</span>,<span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>))</span>
<span id="cb99-13"><a href="geocentric-models.html#cb99-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-14"><a href="geocentric-models.html#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co">#With beta logarithm</span></span>
<span id="cb99-15"><a href="geocentric-models.html#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb99-16"><a href="geocentric-models.html#cb99-16" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb99-17"><a href="geocentric-models.html#cb99-17" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb99-18"><a href="geocentric-models.html#cb99-18" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(N, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#RLNORM for logarithm</span></span>
<span id="cb99-19"><a href="geocentric-models.html#cb99-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="cn">NULL</span> ,<span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight), <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>),<span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb99-20"><a href="geocentric-models.html#cb99-20" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb99-21"><a href="geocentric-models.html#cb99-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">272</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="fl">0.5</span>)</span>
<span id="cb99-22"><a href="geocentric-models.html#cb99-22" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;b ~ dnorm(0,10)&quot;</span>)</span>
<span id="cb99-23"><a href="geocentric-models.html#cb99-23" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb99-24"><a href="geocentric-models.html#cb99-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) <span class="fu">curve</span>(a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x <span class="sc">-</span> xbar),<span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight), <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight),<span class="at">add=</span><span class="cn">TRUE</span>,<span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.41-1.png" alt="Left = Initial model, Right = logarithm of beta" width="720" />
<p class="caption">
(#fig:4.41)Left = Initial model, Right = logarithm of beta
</p>
</div>
<p>Now we see that the joint prior for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are realistict.</p>
<p><em>Joint prior = The predicted height given the wiehgt, which rely on alpha and beta priors that we have made.</em></p>
<p><strong>Then, what is the correct prior?</strong> It is a fallacy that there is one unique value that is optimal for the prior. Thus one must reason for the selection of the prior and perhaps try different priors to see what it suggest. Essentially the prior is just information that you give the model and can e.g., work as a constrain, as we see in the example above where the priors initially returned extreme values, which we need to tamper down.</p>
<p>Then one could say that we should compare the predictions with the actual sample and then optimize against this. Although one must be weary, as this will just yield to fitting against the sample, and is likely not to be the correct model. Although it boiles down to the purpose of the model.</p>
</div>
<div id="finding-the-posterior-distribution" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Finding the posterior distribution</h3>
<p>We see that we have the following model specification:</p>
<p><img src="Images/paste-82599F2B.png" /></p>
<p><em>Notice that <code>=</code> is exchanged with <code>&lt;-</code>, that is by convention and must be used when specifying the model in R.</em></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="geocentric-models.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Howell1&quot;</span>)</span>
<span id="cb100-2"><a href="geocentric-models.html#cb100-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb100-3"><a href="geocentric-models.html#cb100-3" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span>,]</span>
<span id="cb100-4"><a href="geocentric-models.html#cb100-4" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb100-5"><a href="geocentric-models.html#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="geocentric-models.html#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the model</span></span>
<span id="cb100-7"><a href="geocentric-models.html#cb100-7" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb100-8"><a href="geocentric-models.html#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb100-9"><a href="geocentric-models.html#cb100-9" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb100-10"><a href="geocentric-models.html#cb100-10" aria-hidden="true" tabindex="-1"></a>    ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> xbar) <span class="co">#Notice each weight is subtracted by the mean, the closer to the mean the smaller effect of b</span></span>
<span id="cb100-11"><a href="geocentric-models.html#cb100-11" aria-hidden="true" tabindex="-1"></a>    ,a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>,<span class="dv">20</span>)</span>
<span id="cb100-12"><a href="geocentric-models.html#cb100-12" aria-hidden="true" tabindex="-1"></a>    ,b <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb100-13"><a href="geocentric-models.html#cb100-13" aria-hidden="true" tabindex="-1"></a>    ,sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb100-14"><a href="geocentric-models.html#cb100-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb100-15"><a href="geocentric-models.html#cb100-15" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> d2</span>
<span id="cb100-16"><a href="geocentric-models.html#cb100-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="interpreting-the-posterior-distribution" class="section level3" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Interpreting the posterior distribution</h3>
<p>One can interpret the posterior distribution in two ways:</p>
<ol style="list-style-type: decimal">
<li>By assessing tables of information</li>
<li>Plotting the posterior distributions</li>
</ol>
<p>It is often easiest to deduct conclusions based on the plots. The following make examples of both the tables and the plots.</p>
<div id="tables-fo-marginal-distributions" class="section level4" number="4.4.3.1">
<h4><span class="header-section-number">4.4.3.1</span> Tables fo marginal distributions</h4>
<p>Marginal posterior distribution of the parameters:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="geocentric-models.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.3</span></span>
<span id="cb101-2"><a href="geocentric-models.html#cb101-2" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">prob =</span> <span class="fl">0.89</span> <span class="co">#PI for 89% percent, also default</span></span>
<span id="cb101-3"><a href="geocentric-models.html#cb101-3" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.6013671</td>
</tr>
<tr class="even">
<td align="right">0.9032807</td>
</tr>
<tr class="odd">
<td align="right">5.0718809</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.2703077</td>
</tr>
<tr class="even">
<td align="right">0.0419236</td>
</tr>
<tr class="odd">
<td align="right">0.1911548</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.1693633</td>
</tr>
<tr class="even">
<td align="right">0.8362787</td>
</tr>
<tr class="odd">
<td align="right">4.7663786</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">155.0333710</td>
</tr>
<tr class="even">
<td align="right">0.9702828</td>
</tr>
<tr class="odd">
<td align="right">5.3773831</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>For example we see that the mean height increase by a factor of 0.9 if one person is 1 kg heavier, hence the heavier, the taller.</p>
<p>The 5.5% and 94.5% indicate that 89% percent of the time one gets between 84cm and 97 cm taller if one is 1kg heavier.</p>
<p>One can also assess the covariances:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="geocentric-models.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">vcov</span>(m4<span class="fl">.3</span>),<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           a     b sigma
## a     0.073 0.000 0.000
## b     0.000 0.002 0.000
## sigma 0.000 0.000 0.037</code></pre>
<p>And we see that there is very little covariance among the parameters.</p>
<p>This is a visual representation of the same.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="geocentric-models.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(m4<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-54-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-posterior-inference-against-the-data" class="section level4" number="4.4.3.2">
<h4><span class="header-section-number">4.4.3.2</span> Plotting posterior inference against the data</h4>
<p>First the raw data is plotted:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="geocentric-models.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb105-2"><a href="geocentric-models.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight,<span class="at">data =</span> d2,<span class="at">col =</span> rangi2)</span>
<span id="cb105-3"><a href="geocentric-models.html#cb105-3" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb105-4"><a href="geocentric-models.html#cb105-4" aria-hidden="true" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb105-5"><a href="geocentric-models.html#cb105-5" aria-hidden="true" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb105-6"><a href="geocentric-models.html#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="at">expr =</span> a_map <span class="sc">+</span> b_map <span class="sc">*</span> (x <span class="sc">-</span> xbar),<span class="at">add =</span> <span class="cn">TRUE</span>) <span class="co">#Ability to plot a function</span></span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.46-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the function we defined based on the posterior seem reasonable, although there are many plausible lines.</p>
<p>Hence we are going to look into dealing with uncertainty.</p>
</div>
<div id="adding-uncertainty-around-the-mean" class="section level4" number="4.4.3.3">
<h4><span class="header-section-number">4.4.3.3</span> Adding uncertainty around the mean</h4>
<p>We are going to make many of the lines to interprete where they end up, hence also reflecting uncertainty.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="geocentric-models.html#cb106-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>) <span class="co">#Default = 10.000</span></span>
<span id="cb106-2"><a href="geocentric-models.html#cb106-2" aria-hidden="true" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">a</th>
<th align="right">b</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.5789</td>
<td align="right">0.9376825</td>
<td align="right">5.220756</td>
</tr>
<tr class="even">
<td align="right">154.4067</td>
<td align="right">0.8937310</td>
<td align="right">4.752735</td>
</tr>
<tr class="odd">
<td align="right">154.4622</td>
<td align="right">0.9150822</td>
<td align="right">5.341227</td>
</tr>
<tr class="even">
<td align="right">154.2649</td>
<td align="right">0.9236067</td>
<td align="right">5.160423</td>
</tr>
<tr class="odd">
<td align="right">155.1258</td>
<td align="right">0.9495934</td>
<td align="right">5.108891</td>
</tr>
</tbody>
</table>
</div>
<p>We see that these are basically all different functions that can be plotted to show the uncertainty.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="geocentric-models.html#cb107-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">150</span> <span class="co">#No. of samples</span></span>
<span id="cb107-2"><a href="geocentric-models.html#cb107-2" aria-hidden="true" tabindex="-1"></a>dN <span class="ot">&lt;-</span> d2[<span class="dv">1</span><span class="sc">:</span>N,] <span class="co">#subsetting</span></span>
<span id="cb107-3"><a href="geocentric-models.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Approximating the the </span></span>
<span id="cb107-4"><a href="geocentric-models.html#cb107-4" aria-hidden="true" tabindex="-1"></a>mN <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb107-5"><a href="geocentric-models.html#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb107-6"><a href="geocentric-models.html#cb107-6" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma )</span>
<span id="cb107-7"><a href="geocentric-models.html#cb107-7" aria-hidden="true" tabindex="-1"></a>    ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>( weight <span class="sc">-</span> <span class="fu">mean</span>(weight) )</span>
<span id="cb107-8"><a href="geocentric-models.html#cb107-8" aria-hidden="true" tabindex="-1"></a>    ,a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> )</span>
<span id="cb107-9"><a href="geocentric-models.html#cb107-9" aria-hidden="true" tabindex="-1"></a>    ,b <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> )</span>
<span id="cb107-10"><a href="geocentric-models.html#cb107-10" aria-hidden="true" tabindex="-1"></a>    ,sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb107-11"><a href="geocentric-models.html#cb107-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb107-12"><a href="geocentric-models.html#cb107-12" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data=</span>dN</span>
<span id="cb107-13"><a href="geocentric-models.html#cb107-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>The following will show one example where we loop of the data data fit the line.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="geocentric-models.html#cb108-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="co">#No of loops</span></span>
<span id="cb108-2"><a href="geocentric-models.html#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="geocentric-models.html#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract n samples from the posterior distribution</span></span>
<span id="cb108-4"><a href="geocentric-models.html#cb108-4" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(mN ,<span class="at">n=</span>n)</span>
<span id="cb108-5"><a href="geocentric-models.html#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="geocentric-models.html#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># display raw data and sample size</span></span>
<span id="cb108-7"><a href="geocentric-models.html#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> dN<span class="sc">$</span>weight</span>
<span id="cb108-8"><a href="geocentric-models.html#cb108-8" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">y =</span> dN<span class="sc">$</span>height</span>
<span id="cb108-9"><a href="geocentric-models.html#cb108-9" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight),<span class="at">ylim=</span><span class="fu">range</span>(d2<span class="sc">$</span>height) </span>
<span id="cb108-10"><a href="geocentric-models.html#cb108-10" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col=</span>rangi2</span>
<span id="cb108-11"><a href="geocentric-models.html#cb108-11" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab=</span><span class="st">&quot;weight&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;height&quot;</span>)</span>
<span id="cb108-12"><a href="geocentric-models.html#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="geocentric-models.html#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">concat</span>(<span class="st">&quot;N = &quot;</span>,N,<span class="st">&quot;, Iterations = &quot;</span>,n))</span>
<span id="cb108-14"><a href="geocentric-models.html#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="geocentric-models.html#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the lines, with transparency</span></span>
<span id="cb108-16"><a href="geocentric-models.html#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb108-17"><a href="geocentric-models.html#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Draw a and b values from the subset of the data</span></span>
<span id="cb108-18"><a href="geocentric-models.html#cb108-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>(post<span class="sc">$</span>a[i] <span class="sc">+</span> post<span class="sc">$</span>b[i]<span class="sc">*</span>(x<span class="sc">-</span><span class="fu">mean</span>(dN<span class="sc">$</span>weight)) </span>
<span id="cb108-19"><a href="geocentric-models.html#cb108-19" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.3</span>)</span>
<span id="cb108-20"><a href="geocentric-models.html#cb108-20" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">add=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.49-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>One will see that the more observations we include, the more certain will the model become. One will often experience that we are more confident around the mean and less in the ends of the x-range.</p>
<p>In other words, the less data we introduce, the less we rely on the priors that we specified before seeing the data. that is because the prior is updated according to the data.</p>
<p><strong><em>Notice that confidence is not equal to correctness</em></strong> that is due to the data that we have may not reflect a truer perspective than the priors.</p>
</div>
<div id="plotting-regression-intervlas-and-contours" class="section level4" number="4.4.3.4">
<h4><span class="header-section-number">4.4.3.4</span> Plotting regression intervlas and contours</h4>
<p>Now lets start an example where the weight is fixed to 50 kg. We will see that a person with 50kg is not fixed to one height, but some will have greater certainty.</p>
<p>We see that we get 10.000 samples, thus 10.000 priors for both a and b and thus we can simulate the expected height for such a given person.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="geocentric-models.html#cb109-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>,<span class="at">n =</span> <span class="dv">10000</span>)</span>
<span id="cb109-2"><a href="geocentric-models.html#cb109-2" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b <span class="sc">*</span> (<span class="dv">50</span><span class="sc">-</span>xbar)</span>
<span id="cb109-3"><a href="geocentric-models.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(<span class="at">x =</span> mu_at_50,<span class="at">col =</span> rangi2,<span class="at">lwd =</span> <span class="dv">2</span>,<span class="at">xlab =</span> <span class="st">&quot;mu|weight=50&quot;</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.52-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now what we want to do is the same, but for <em>all weights</em>. For this one can use the <code>link</code> function.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="geocentric-models.html#cb110-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m4<span class="fl">.3</span>,<span class="at">n =</span> <span class="dv">1000</span>) <span class="co">#1000 is also default</span></span>
<span id="cb110-2"><a href="geocentric-models.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:352] 158 157 157 157 157 ...</code></pre>
<p>We see that 352 roes in the data hence we get a matrix 352 columns (one for each individual) with 1.000 rows.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="geocentric-models.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define sequence of weights to compute predictions for these values will be on the horizontal axis</span></span>
<span id="cb112-2"><a href="geocentric-models.html#cb112-2" aria-hidden="true" tabindex="-1"></a>weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">25</span>, <span class="at">to=</span><span class="dv">70</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb112-3"><a href="geocentric-models.html#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="geocentric-models.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use link to compute mu for each sample from posterior and for each weight in weight.seq</span></span>
<span id="cb112-5"><a href="geocentric-models.html#cb112-5" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>( m4<span class="fl">.3</span> , <span class="at">data=</span><span class="fu">data.frame</span>(<span class="at">weight=</span>weight.seq) )</span>
<span id="cb112-6"><a href="geocentric-models.html#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 136 136 136 137 137 ...</code></pre>
<p>Now we see that since we fed 46 values for the weight, we get 46 columns instead of one pr invidual.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="geocentric-models.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight,<span class="at">data =</span> d2,<span class="at">type=</span><span class="st">&quot;n&quot;</span>) <span class="co">#use type=&quot;n&quot; to hide raw data </span></span>
<span id="cb114-2"><a href="geocentric-models.html#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="geocentric-models.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over samples and plot each mu value</span></span>
<span id="cb114-4"><a href="geocentric-models.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb114-5"><a href="geocentric-models.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(weight.seq, mu[i,] ,<span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.55-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Finally we will summarize the distribution for each weight value.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="geocentric-models.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the distribution of mu</span></span>
<span id="cb115-2"><a href="geocentric-models.html#cb115-2" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean) <span class="co">#46 values, one for each weight</span></span>
<span id="cb115-3"><a href="geocentric-models.html#cb115-3" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob=</span><span class="fl">0.89</span>) <span class="co">#The 89% PI for each mean</span></span></code></pre></div>
<p><code>mu.mean</code> = the average height (mu) for each weight value. And the PI is just accompanied with this as well.</p>
<p>Now we plot the means and the PI ontop of the data.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="geocentric-models.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Raw data plot</span></span>
<span id="cb116-2"><a href="geocentric-models.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, <span class="at">data =</span> d2, <span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>))</span>
<span id="cb116-3"><a href="geocentric-models.html#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="geocentric-models.html#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Ploatting MAP line (mean mu for each weight)</span></span>
<span id="cb116-5"><a href="geocentric-models.html#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> weight.seq,<span class="at">y =</span> mu.mean)</span>
<span id="cb116-6"><a href="geocentric-models.html#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="geocentric-models.html#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting PI intervals for each weight</span></span>
<span id="cb116-8"><a href="geocentric-models.html#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI,weight.seq)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-57-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><strong><em>NOTICE THAT THIS IS PREDICTION OF AVERAGE HEIGHTS, IN THE FOLLOWING WE MAKE INTERVALS FOR ACTUAL HEIGHTS</em></strong></p>
</div>
<div id="prediction-intevals" class="section level4" number="4.4.3.5">
<h4><span class="header-section-number">4.4.3.5</span> Prediction intevals</h4>
<p>Now we are going to predict actual heights.</p>
<p>Also notice that up until now, we have not had to simulate sigma, as it is only relevant for predicting actual heights, and as we saw that mean heights are dependent (deterministic) on alpha and beta prior, but not on sigma.</p>
<p>This comes down to, <strong>what is sigma</strong>, it is an expression of the scatter of the points.</p>
<p>The following is an example of actual predictions and generating a band of percentile interval.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="geocentric-models.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Simulate height (Simulates posterior observations for map and map2stan model fits.)</span></span>
<span id="cb117-2"><a href="geocentric-models.html#cb117-2" aria-hidden="true" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq)) <span class="co">#n = 1000</span></span>
<span id="cb117-3"><a href="geocentric-models.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 136 131 140 139 136 ...</code></pre>
<p>This contains simulated heights and not distributions as we saw previously.</p>
<p>Now we can generate the PI that we are going to plot.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="geocentric-models.html#cb119-1" aria-hidden="true" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,PI,<span class="at">prob =</span> <span class="fl">0.89</span>)</span>
<span id="cb119-2"><a href="geocentric-models.html#cb119-2" aria-hidden="true" tabindex="-1"></a>height.HPDI67 <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,HPDI,<span class="at">prob =</span> <span class="fl">0.67</span>)</span>
<span id="cb119-3"><a href="geocentric-models.html#cb119-3" aria-hidden="true" tabindex="-1"></a>height.HPDI89 <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,HPDI,<span class="at">prob =</span> <span class="fl">0.89</span>)</span>
<span id="cb119-4"><a href="geocentric-models.html#cb119-4" aria-hidden="true" tabindex="-1"></a>height.HPDI97 <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,HPDI,<span class="at">prob =</span> <span class="fl">0.97</span>)</span></code></pre></div>
<p>Lastly we need to plot the predictions and the percentile interval.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="geocentric-models.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the data points</span></span>
<span id="cb120-2"><a href="geocentric-models.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight,<span class="at">data =</span> d2,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>))</span>
<span id="cb120-3"><a href="geocentric-models.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="geocentric-models.html#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw MAP line</span></span>
<span id="cb120-5"><a href="geocentric-models.html#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(weight.seq,<span class="at">y =</span> mu.mean)</span>
<span id="cb120-6"><a href="geocentric-models.html#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="geocentric-models.html#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Draw HPDI region for simulated heights, notice I added two additional regions</span></span>
<span id="cb120-8"><a href="geocentric-models.html#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(height.HPDI67,weight.seq)</span>
<span id="cb120-9"><a href="geocentric-models.html#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(height.HPDI89,weight.seq)</span>
<span id="cb120-10"><a href="geocentric-models.html#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(height.HPDI97,weight.seq)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/4.61-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we see that the region is far wider.</p>
</div>
</div>
</div>
<div id="curves-form-lines" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Curves form lines</h2>
<p>This is technically the same, but we add complexity in the form of more predictors. We approach this with polynomial regression and splines.</p>
<div id="polynomial-regression" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Polynomial regression</h3>
<p>This is basically using the same variable, but transforming it into second or third order polynomials.</p>
<p>When doing polynomials you are at risk of generating very large numbers, hence one should standardize the variable to avoid this. This also means that interpreting the effects from each parameter is more difficult.</p>
<p>Now we can specify the model with the following:</p>
<p><img src="Images/paste-E98BCBE5.png" /></p>
<p><em>Notice that this is for a cubic polynomial regression. One can just disregard $/beta_3$ in a quadratic polynomial.</em></p>
<p>The following will plot the example of:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="geocentric-models.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Standardize weights</span></span>
<span id="cb121-2"><a href="geocentric-models.html#cb121-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>weight_s <span class="ot">&lt;-</span> ( d<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight) )<span class="sc">/</span><span class="fu">sd</span>(d<span class="sc">$</span>weight)</span>
<span id="cb121-3"><a href="geocentric-models.html#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="geocentric-models.html#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Add vector of squared values, for the polynomial variable</span></span>
<span id="cb121-5"><a href="geocentric-models.html#cb121-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>weight_s2 <span class="ot">&lt;-</span> d<span class="sc">$</span>weight_s<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb121-6"><a href="geocentric-models.html#cb121-6" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>weight_s3 <span class="ot">&lt;-</span> d<span class="sc">$</span>weight_s<span class="sc">^</span><span class="dv">3</span> <span class="co">#For the cubic model</span></span>
<span id="cb121-7"><a href="geocentric-models.html#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="geocentric-models.html#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Specfify models</span></span>
<span id="cb121-9"><a href="geocentric-models.html#cb121-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-10"><a href="geocentric-models.html#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Linear model</span></span>
<span id="cb121-11"><a href="geocentric-models.html#cb121-11" aria-hidden="true" tabindex="-1"></a>  m4<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb121-12"><a href="geocentric-models.html#cb121-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">alist</span>(</span>
<span id="cb121-13"><a href="geocentric-models.html#cb121-13" aria-hidden="true" tabindex="-1"></a>        height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb121-14"><a href="geocentric-models.html#cb121-14" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b1<span class="sc">*</span>weight_s ,</span>
<span id="cb121-15"><a href="geocentric-models.html#cb121-15" aria-hidden="true" tabindex="-1"></a>        a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb121-16"><a href="geocentric-models.html#cb121-16" aria-hidden="true" tabindex="-1"></a>        b1 <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb121-17"><a href="geocentric-models.html#cb121-17" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb121-18"><a href="geocentric-models.html#cb121-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb121-19"><a href="geocentric-models.html#cb121-19" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">data =</span> d</span>
<span id="cb121-20"><a href="geocentric-models.html#cb121-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb121-21"><a href="geocentric-models.html#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="geocentric-models.html#cb121-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Quadratic model (4.65)</span></span>
<span id="cb121-23"><a href="geocentric-models.html#cb121-23" aria-hidden="true" tabindex="-1"></a>  m4<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb121-24"><a href="geocentric-models.html#cb121-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb121-25"><a href="geocentric-models.html#cb121-25" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb121-26"><a href="geocentric-models.html#cb121-26" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b1<span class="sc">*</span>weight_s <span class="sc">+</span> b2<span class="sc">*</span>weight_s2 ,</span>
<span id="cb121-27"><a href="geocentric-models.html#cb121-27" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb121-28"><a href="geocentric-models.html#cb121-28" aria-hidden="true" tabindex="-1"></a>      b1 <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb121-29"><a href="geocentric-models.html#cb121-29" aria-hidden="true" tabindex="-1"></a>      b2 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb121-30"><a href="geocentric-models.html#cb121-30" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb121-31"><a href="geocentric-models.html#cb121-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb121-32"><a href="geocentric-models.html#cb121-32" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">data =</span> d</span>
<span id="cb121-33"><a href="geocentric-models.html#cb121-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-34"><a href="geocentric-models.html#cb121-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-35"><a href="geocentric-models.html#cb121-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Cubic model (4.69)</span></span>
<span id="cb121-36"><a href="geocentric-models.html#cb121-36" aria-hidden="true" tabindex="-1"></a>  d<span class="sc">$</span>weight_s3 <span class="ot">&lt;-</span> d<span class="sc">$</span>weight_s<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb121-37"><a href="geocentric-models.html#cb121-37" aria-hidden="true" tabindex="-1"></a>  m4<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb121-38"><a href="geocentric-models.html#cb121-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb121-39"><a href="geocentric-models.html#cb121-39" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb121-40"><a href="geocentric-models.html#cb121-40" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b1<span class="sc">*</span>weight_s <span class="sc">+</span> b2<span class="sc">*</span>weight_s2 <span class="sc">+</span> b3<span class="sc">*</span>weight_s3 ,</span>
<span id="cb121-41"><a href="geocentric-models.html#cb121-41" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb121-42"><a href="geocentric-models.html#cb121-42" aria-hidden="true" tabindex="-1"></a>      b1 <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb121-43"><a href="geocentric-models.html#cb121-43" aria-hidden="true" tabindex="-1"></a>      b2 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> ) ,</span>
<span id="cb121-44"><a href="geocentric-models.html#cb121-44" aria-hidden="true" tabindex="-1"></a>      b3 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> ) ,</span>
<span id="cb121-45"><a href="geocentric-models.html#cb121-45" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb121-46"><a href="geocentric-models.html#cb121-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb121-47"><a href="geocentric-models.html#cb121-47" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data=</span>d</span>
<span id="cb121-48"><a href="geocentric-models.html#cb121-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-49"><a href="geocentric-models.html#cb121-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-50"><a href="geocentric-models.html#cb121-50" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting</span></span>
<span id="cb121-51"><a href="geocentric-models.html#cb121-51" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb121-52"><a href="geocentric-models.html#cb121-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-53"><a href="geocentric-models.html#cb121-53" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Linear</span></span>
<span id="cb121-54"><a href="geocentric-models.html#cb121-54" aria-hidden="true" tabindex="-1"></a>  weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="sc">-</span><span class="fl">2.2</span> , <span class="at">to=</span><span class="dv">2</span> , <span class="at">length.out=</span><span class="dv">30</span> )</span>
<span id="cb121-55"><a href="geocentric-models.html#cb121-55" aria-hidden="true" tabindex="-1"></a>  pred_dat <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">weight_s=</span>weight.seq ) <span class="co">#adds degree of poly</span></span>
<span id="cb121-56"><a href="geocentric-models.html#cb121-56" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">link</span>( m4<span class="fl">.4</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-57"><a href="geocentric-models.html#cb121-57" aria-hidden="true" tabindex="-1"></a>  mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , mean )</span>
<span id="cb121-58"><a href="geocentric-models.html#cb121-58" aria-hidden="true" tabindex="-1"></a>  mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-59"><a href="geocentric-models.html#cb121-59" aria-hidden="true" tabindex="-1"></a>  sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>( m4<span class="fl">.4</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-60"><a href="geocentric-models.html#cb121-60" aria-hidden="true" tabindex="-1"></a>  height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( sim.height , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-61"><a href="geocentric-models.html#cb121-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-62"><a href="geocentric-models.html#cb121-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>( height <span class="sc">~</span> weight_s , d , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>),<span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb121-63"><a href="geocentric-models.html#cb121-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( weight.seq , mu.mean )</span>
<span id="cb121-64"><a href="geocentric-models.html#cb121-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( mu.PI , weight.seq )</span>
<span id="cb121-65"><a href="geocentric-models.html#cb121-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( height.PI , weight.seq )</span>
<span id="cb121-66"><a href="geocentric-models.html#cb121-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-67"><a href="geocentric-models.html#cb121-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Quadratic</span></span>
<span id="cb121-68"><a href="geocentric-models.html#cb121-68" aria-hidden="true" tabindex="-1"></a>  weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="sc">-</span><span class="fl">2.2</span> , <span class="at">to=</span><span class="dv">2</span> , <span class="at">length.out=</span><span class="dv">30</span> )</span>
<span id="cb121-69"><a href="geocentric-models.html#cb121-69" aria-hidden="true" tabindex="-1"></a>  pred_dat <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">weight_s=</span>weight.seq , <span class="at">weight_s2=</span>weight.seq<span class="sc">^</span><span class="dv">2</span> ) <span class="co">#adds degree of poly</span></span>
<span id="cb121-70"><a href="geocentric-models.html#cb121-70" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">link</span>( m4<span class="fl">.5</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-71"><a href="geocentric-models.html#cb121-71" aria-hidden="true" tabindex="-1"></a>  mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , mean )</span>
<span id="cb121-72"><a href="geocentric-models.html#cb121-72" aria-hidden="true" tabindex="-1"></a>  mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-73"><a href="geocentric-models.html#cb121-73" aria-hidden="true" tabindex="-1"></a>  sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>( m4<span class="fl">.5</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-74"><a href="geocentric-models.html#cb121-74" aria-hidden="true" tabindex="-1"></a>  height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( sim.height , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-75"><a href="geocentric-models.html#cb121-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-76"><a href="geocentric-models.html#cb121-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>( height <span class="sc">~</span> weight_s , d , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>),<span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb121-77"><a href="geocentric-models.html#cb121-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( weight.seq , mu.mean )</span>
<span id="cb121-78"><a href="geocentric-models.html#cb121-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( mu.PI , weight.seq )</span>
<span id="cb121-79"><a href="geocentric-models.html#cb121-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( height.PI , weight.seq )</span>
<span id="cb121-80"><a href="geocentric-models.html#cb121-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-81"><a href="geocentric-models.html#cb121-81" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cubic</span></span>
<span id="cb121-82"><a href="geocentric-models.html#cb121-82" aria-hidden="true" tabindex="-1"></a>  weight.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="sc">-</span><span class="fl">2.2</span> , <span class="at">to=</span><span class="dv">2</span> , <span class="at">length.out=</span><span class="dv">30</span> )</span>
<span id="cb121-83"><a href="geocentric-models.html#cb121-83" aria-hidden="true" tabindex="-1"></a>  pred_dat <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">weight_s=</span>weight.seq , <span class="at">weight_s2=</span>weight.seq<span class="sc">^</span><span class="dv">2</span>, <span class="at">weight_s3=</span>weight.seq<span class="sc">^</span><span class="dv">3</span> ) <span class="co">#adds degree of poly</span></span>
<span id="cb121-84"><a href="geocentric-models.html#cb121-84" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">link</span>( m4<span class="fl">.6</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-85"><a href="geocentric-models.html#cb121-85" aria-hidden="true" tabindex="-1"></a>  mu.mean <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , mean )</span>
<span id="cb121-86"><a href="geocentric-models.html#cb121-86" aria-hidden="true" tabindex="-1"></a>  mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( mu , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-87"><a href="geocentric-models.html#cb121-87" aria-hidden="true" tabindex="-1"></a>  sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>( m4<span class="fl">.6</span> , <span class="at">data=</span>pred_dat ) <span class="co">#need to change model</span></span>
<span id="cb121-88"><a href="geocentric-models.html#cb121-88" aria-hidden="true" tabindex="-1"></a>  height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( sim.height , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span>
<span id="cb121-89"><a href="geocentric-models.html#cb121-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-90"><a href="geocentric-models.html#cb121-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>( height <span class="sc">~</span> weight_s , d , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>),<span class="at">pch =</span> <span class="dv">20</span>)</span>
<span id="cb121-91"><a href="geocentric-models.html#cb121-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( weight.seq , mu.mean )</span>
<span id="cb121-92"><a href="geocentric-models.html#cb121-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( mu.PI , weight.seq )</span>
<span id="cb121-93"><a href="geocentric-models.html#cb121-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>( height.PI , weight.seq )</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-58"></span>
<img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-58-1.png" alt="Comparison between a linear, quadratic and cubic model. Notice that the same variable is used, just with different degree of polynomials." width="720" />
<p class="caption">
Figure 4.1: Comparison between a linear, quadratic and cubic model. Notice that the same variable is used, just with different degree of polynomials.
</p>
</div>
<p><strong>Table output for the polynomial</strong></p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="geocentric-models.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.5</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">146.057160</td>
</tr>
<tr class="even">
<td align="right">21.733407</td>
</tr>
<tr class="odd">
<td align="right">-7.803209</td>
</tr>
<tr class="even">
<td align="right">5.774538</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.3689809</td>
</tr>
<tr class="even">
<td align="right">0.2888934</td>
</tr>
<tr class="odd">
<td align="right">0.2741871</td>
</tr>
<tr class="even">
<td align="right">0.1764700</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">145.467457</td>
</tr>
<tr class="even">
<td align="right">21.271700</td>
</tr>
<tr class="odd">
<td align="right">-8.241412</td>
</tr>
<tr class="even">
<td align="right">5.492504</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">146.646862</td>
</tr>
<tr class="even">
<td align="right">22.195114</td>
</tr>
<tr class="odd">
<td align="right">-7.365005</td>
</tr>
<tr class="even">
<td align="right">6.056571</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see that b2 for instance is more complicated, as it is squared values that the parameter is multiplied with. Notice that a is still the intercept with y.</p>
<p>Also since the same variable is in the model more than once, one cannot interpret one without the other.</p>
<p><strong>Arguments for why polynomials are bad:</strong></p>
<ol style="list-style-type: decimal">
<li>If you have regions with no data, the model can do all kinds of weird things</li>
<li>Makes absurd predictions outside range of data</li>
<li>It is likely to get some obscure shapes</li>
<li>The model is difficult to interpret as you cannot interpret one parameter without the other,as the polynomial variable is tied to the non polynomial variable.</li>
<li>Often having a polynomial makes no sense in real life, even though you may find a relationship</li>
<li>In a quadratic model, the fitted lines will always go up and then down, hence it needs to fit the data in that way. The same applies to cubic functions.</li>
<li>Actually not very flexible and cannot have monotone shape</li>
</ol>
<p>The spline that we see in the following is the answer to many of these difficulties.</p>
</div>
<div id="splines" class="section level3" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Splines</h3>
<p>This is an alternative way of adding curvature. We are going to use basis splines, i.e., B-splines. <em>This is also called P-splines, this is for penalty-splines, as the priors adds a penalty.</em></p>
<p>The code is not exemplified yet. Do this. For now, see <a href="#4m"><strong>??</strong></a></p>
<p>It is basically just splines as we have seen earlier in ML.</p>
<p>It is often a much better model and polynomial regression.</p>
<p>During the lecture he shows a really nice representation of which of the basis functions that are active.</p>
</div>
</div>
<div id="exercises-2" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Exercises</h2>
<div id="m1-2" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> 4M1</h3>
<p><em>For the model definition below, simulate observed y values from the prior (not the posterior).</em></p>
<p><span class="math display">\[y_i \sim Normal(\mu,\sigma)\]</span></p>
<p><span class="math display">\[\mu \sim Normal(0,10)\]</span></p>
<p><span class="math display">\[\sigma \sim Exponential(1)\]</span></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="geocentric-models.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1337</span>)</span>
<span id="cb123-2"><a href="geocentric-models.html#cb123-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb123-3"><a href="geocentric-models.html#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="geocentric-models.html#cb123-4" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N,<span class="dv">0</span>,<span class="dv">10</span>) <span class="co">#notice we cannot take the mean of the data, as it is a prior!!!</span></span>
<span id="cb123-5"><a href="geocentric-models.html#cb123-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb123-6"><a href="geocentric-models.html#cb123-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-7"><a href="geocentric-models.html#cb123-7" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N,mu,sigma)</span>
<span id="cb123-8"><a href="geocentric-models.html#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-59-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><em>Note, in this example <code>dnorm</code> and <code>rnorm</code> is exactly the same</em></p>
<p><strong>Plotting the priors</strong></p>
</div>
<div id="m8" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> 4M8</h3>
<p><em>In the chapter, we used 15 knots with the cherry blossom spline.</em></p>
<p><em>1. Increase the number of knots and observe what happens to the resulting spline.</em> <em>1. Then adjust also the width of the prior on the weights</em> <em>1. change the standard deviation of the prior and watch what happens.</em> <em>1. What do you think the combination of knot number and the prior on the weights controls?</em></p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="geocentric-models.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a function for the exercise, so you dont have to run it all again to make modifications</span></span>
<span id="cb124-2"><a href="geocentric-models.html#cb124-2" aria-hidden="true" tabindex="-1"></a>load_execute <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb124-3"><a href="geocentric-models.html#cb124-3" aria-hidden="true" tabindex="-1"></a>     N_knots</span>
<span id="cb124-4"><a href="geocentric-models.html#cb124-4" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">model_spec =</span> <span class="fu">alist</span>(</span>
<span id="cb124-5"><a href="geocentric-models.html#cb124-5" aria-hidden="true" tabindex="-1"></a>                          T <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb124-6"><a href="geocentric-models.html#cb124-6" aria-hidden="true" tabindex="-1"></a>                          ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w</span>
<span id="cb124-7"><a href="geocentric-models.html#cb124-7" aria-hidden="true" tabindex="-1"></a>                          ,a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">6</span>,<span class="dv">10</span>)</span>
<span id="cb124-8"><a href="geocentric-models.html#cb124-8" aria-hidden="true" tabindex="-1"></a>                          ,w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb124-9"><a href="geocentric-models.html#cb124-9" aria-hidden="true" tabindex="-1"></a>                          ,sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb124-10"><a href="geocentric-models.html#cb124-10" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb124-11"><a href="geocentric-models.html#cb124-11" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb124-12"><a href="geocentric-models.html#cb124-12" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb124-13"><a href="geocentric-models.html#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rethinking)</span>
<span id="cb124-14"><a href="geocentric-models.html#cb124-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-15"><a href="geocentric-models.html#cb124-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Load data</span></span>
<span id="cb124-16"><a href="geocentric-models.html#cb124-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb124-17"><a href="geocentric-models.html#cb124-17" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb124-18"><a href="geocentric-models.html#cb124-18" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d<span class="sc">$</span>temp),] <span class="co"># complete cases on temp</span></span>
<span id="cb124-19"><a href="geocentric-models.html#cb124-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#precis(d) #For inspections</span></span>
<span id="cb124-20"><a href="geocentric-models.html#cb124-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-21"><a href="geocentric-models.html#cb124-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Defining spline specifications</span></span>
<span id="cb124-22"><a href="geocentric-models.html#cb124-22" aria-hidden="true" tabindex="-1"></a>  num_knots <span class="ot">&lt;-</span> N_knots</span>
<span id="cb124-23"><a href="geocentric-models.html#cb124-23" aria-hidden="true" tabindex="-1"></a>  knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="at">x =</span> d<span class="sc">$</span>year <span class="co">#Data</span></span>
<span id="cb124-24"><a href="geocentric-models.html#cb124-24" aria-hidden="true" tabindex="-1"></a>                        ,<span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span>num_knots) <span class="co">#probabilities</span></span>
<span id="cb124-25"><a href="geocentric-models.html#cb124-25" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb124-26"><a href="geocentric-models.html#cb124-26" aria-hidden="true" tabindex="-1"></a>  knot_list <span class="ot">&lt;-</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,num_knots)] <span class="co">#Remove knot at 0 and 1</span></span>
<span id="cb124-27"><a href="geocentric-models.html#cb124-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-28"><a href="geocentric-models.html#cb124-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Defining the splines</span></span>
<span id="cb124-29"><a href="geocentric-models.html#cb124-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(splines)</span>
<span id="cb124-30"><a href="geocentric-models.html#cb124-30" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">bs</span>(</span>
<span id="cb124-31"><a href="geocentric-models.html#cb124-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> d<span class="sc">$</span>year</span>
<span id="cb124-32"><a href="geocentric-models.html#cb124-32" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">knots =</span> knot_list</span>
<span id="cb124-33"><a href="geocentric-models.html#cb124-33" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">degree =</span> <span class="dv">3</span> <span class="co">#cubic splines</span></span>
<span id="cb124-34"><a href="geocentric-models.html#cb124-34" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">intercept =</span> <span class="cn">TRUE</span></span>
<span id="cb124-35"><a href="geocentric-models.html#cb124-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-36"><a href="geocentric-models.html#cb124-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb124-37"><a href="geocentric-models.html#cb124-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Define model</span></span>
<span id="cb124-38"><a href="geocentric-models.html#cb124-38" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb124-39"><a href="geocentric-models.html#cb124-39" aria-hidden="true" tabindex="-1"></a>    model_spec</span>
<span id="cb124-40"><a href="geocentric-models.html#cb124-40" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">data =</span> <span class="fu">list</span>(<span class="at">T =</span> d<span class="sc">$</span>temp,<span class="at">B =</span> B)</span>
<span id="cb124-41"><a href="geocentric-models.html#cb124-41" aria-hidden="true" tabindex="-1"></a>    ,<span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">ncol</span>(B)))</span>
<span id="cb124-42"><a href="geocentric-models.html#cb124-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb124-43"><a href="geocentric-models.html#cb124-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#precis(m,depth = 2)</span></span>
<span id="cb124-44"><a href="geocentric-models.html#cb124-44" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>From this we can see all the parameters at the knots, although this does not provide much information anymore before plotting.</p>
<p>We see the effect of each spline.</p>
<p>Now we can plot the actual fitted lines and the compatibility interval.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="geocentric-models.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb125-2"><a href="geocentric-models.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb125-3"><a href="geocentric-models.html#cb125-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb125-4"><a href="geocentric-models.html#cb125-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d<span class="sc">$</span>temp),] <span class="co"># complete cases on temp</span></span>
<span id="cb125-5"><a href="geocentric-models.html#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="geocentric-models.html#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">10</span>)){</span>
<span id="cb125-7"><a href="geocentric-models.html#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load_execute</span>(<span class="at">N_knots =</span> i)</span>
<span id="cb125-8"><a href="geocentric-models.html#cb125-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-9"><a href="geocentric-models.html#cb125-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m)</span>
<span id="cb125-10"><a href="geocentric-models.html#cb125-10" aria-hidden="true" tabindex="-1"></a>  mu_PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> mu,<span class="at">MARGIN =</span> <span class="dv">2</span>,<span class="at">FUN =</span> PI,<span class="fl">0.97</span>) <span class="co">#0.97 is input to PI</span></span>
<span id="cb125-11"><a href="geocentric-models.html#cb125-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-12"><a href="geocentric-models.html#cb125-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding raw data</span></span>
<span id="cb125-13"><a href="geocentric-models.html#cb125-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(d<span class="sc">$</span>year,d<span class="sc">$</span>temp</span>
<span id="cb125-14"><a href="geocentric-models.html#cb125-14" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.3</span>)</span>
<span id="cb125-15"><a href="geocentric-models.html#cb125-15" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">pch =</span> <span class="dv">16</span></span>
<span id="cb125-16"><a href="geocentric-models.html#cb125-16" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb125-17"><a href="geocentric-models.html#cb125-17" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">ylab =</span> <span class="st">&quot;Temp&quot;</span></span>
<span id="cb125-18"><a href="geocentric-models.html#cb125-18" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;No. of knots:&quot;</span>,i,<span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb125-19"><a href="geocentric-models.html#cb125-19" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb125-20"><a href="geocentric-models.html#cb125-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb125-21"><a href="geocentric-models.html#cb125-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Adding shade for the intervals</span></span>
<span id="cb125-22"><a href="geocentric-models.html#cb125-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade</span>(<span class="at">object =</span> mu_PI</span>
<span id="cb125-23"><a href="geocentric-models.html#cb125-23" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">lim =</span> d<span class="sc">$</span>year</span>
<span id="cb125-24"><a href="geocentric-models.html#cb125-24" aria-hidden="true" tabindex="-1"></a>        ,<span class="at">col =</span> <span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.5</span>)</span>
<span id="cb125-25"><a href="geocentric-models.html#cb125-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb125-26"><a href="geocentric-models.html#cb125-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-62-1.png" width="720" style="display: block; margin: auto;" /></p>
</div>
<div id="h1-1" class="section level3" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> 4H1</h3>
<p>The weights listed below were recorded in the !Kung census, but heights were not recorded for these individuals. Provide predicted heights and 89% intervals for each of these individuals. That is, fill in the table below, using model-based predictions.</p>
<p><img src="Images/paste-71AAF267.png" /></p>
<p>First we define the model to get the parameters, such as mean for beta. Recall that a = the intercept with y.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="geocentric-models.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb126-2"><a href="geocentric-models.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb126-3"><a href="geocentric-models.html#cb126-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb126-4"><a href="geocentric-models.html#cb126-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age<span class="sc">&gt;=</span><span class="dv">18</span>,]</span>
<span id="cb126-5"><a href="geocentric-models.html#cb126-5" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb126-6"><a href="geocentric-models.html#cb126-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb126-7"><a href="geocentric-models.html#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb126-8"><a href="geocentric-models.html#cb126-8" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb126-9"><a href="geocentric-models.html#cb126-9" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> xbar),</span>
<span id="cb126-10"><a href="geocentric-models.html#cb126-10" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ),</span>
<span id="cb126-11"><a href="geocentric-models.html#cb126-11" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb126-12"><a href="geocentric-models.html#cb126-12" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb126-13"><a href="geocentric-models.html#cb126-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb126-14"><a href="geocentric-models.html#cb126-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>d2</span>
<span id="cb126-15"><a href="geocentric-models.html#cb126-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb126-16"><a href="geocentric-models.html#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m) <span class="co">#similar to summary()</span></span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.6013676</td>
</tr>
<tr class="even">
<td align="right">0.9032809</td>
</tr>
<tr class="odd">
<td align="right">5.0718805</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.2703076</td>
</tr>
<tr class="even">
<td align="right">0.0419236</td>
</tr>
<tr class="odd">
<td align="right">0.1911547</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.1693637</td>
</tr>
<tr class="even">
<td align="right">0.8362789</td>
</tr>
<tr class="odd">
<td align="right">4.7663783</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">155.033371</td>
</tr>
<tr class="even">
<td align="right">0.970283</td>
</tr>
<tr class="odd">
<td align="right">5.377383</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>From this we are able to extract samples:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="geocentric-models.html#cb127-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m)</span>
<span id="cb127-2"><a href="geocentric-models.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(post)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    10000 obs. of  3 variables:
##  $ a    : num  155 155 155 154 155 ...
##  $ b    : num  0.95 0.916 0.93 0.892 0.841 ...
##  $ sigma: num  5.25 4.87 4.93 5.2 5.11 ...
##  - attr(*, &quot;source&quot;)= chr &quot;quap posterior: 10000 samples from m&quot;</code></pre>
<p>Function to get n samples based on the input weight, it returns the mean y and the compatability interval</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="geocentric-models.html#cb129-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>( weight ) {</span>
<span id="cb129-2"><a href="geocentric-models.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span>  <span class="dv">10000</span> , post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b <span class="sc">*</span> (weight <span class="sc">-</span> xbar) , post<span class="sc">$</span>sigma )</span>
<span id="cb129-3"><a href="geocentric-models.html#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">c</span>( <span class="fu">mean</span>(y) , <span class="fu">PI</span>(y,<span class="at">prob=</span><span class="fl">0.89</span>) ) )</span>
<span id="cb129-4"><a href="geocentric-models.html#cb129-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb129-5"><a href="geocentric-models.html#cb129-5" aria-hidden="true" tabindex="-1"></a>weight_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">46.95</span>,<span class="fl">43.72</span>,<span class="fl">64.78</span>,<span class="fl">32.59</span>,<span class="fl">54.63</span>)</span>
<span id="cb129-6"><a href="geocentric-models.html#cb129-6" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sapply</span>( weight_list , f )</span>
<span id="cb129-7"><a href="geocentric-models.html#cb129-7" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>##         [,1]     [,2]     [,3]     [,4]     [,5]
##     156.3964 153.4632 172.4339 143.3563 163.3754
## 5%  148.1975 145.3652 164.1295 135.1368 155.3528
## 94% 164.6221 161.6903 180.7454 151.5014 171.4404</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="geocentric-models.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setNames</span>(<span class="at">object =</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(weight_list,<span class="fu">t</span>(result)))</span>
<span id="cb131-2"><a href="geocentric-models.html#cb131-2" aria-hidden="true" tabindex="-1"></a>         ,<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;Weight&quot;</span>,<span class="st">&quot;Height&quot;</span>,<span class="st">&quot;5%&quot;</span>,<span class="st">&quot;94%&quot;</span>))</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Weight</th>
<th align="right">Height</th>
<th align="right">5%</th>
<th align="right">94%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">46.95</td>
<td align="right">156.3964</td>
<td align="right">148.1975</td>
<td align="right">164.6221</td>
</tr>
<tr class="even">
<td align="right">43.72</td>
<td align="right">153.4632</td>
<td align="right">145.3652</td>
<td align="right">161.6903</td>
</tr>
<tr class="odd">
<td align="right">64.78</td>
<td align="right">172.4339</td>
<td align="right">164.1295</td>
<td align="right">180.7454</td>
</tr>
<tr class="even">
<td align="right">32.59</td>
<td align="right">143.3563</td>
<td align="right">135.1368</td>
<td align="right">151.5014</td>
</tr>
<tr class="odd">
<td align="right">54.63</td>
<td align="right">163.3754</td>
<td align="right">155.3528</td>
<td align="right">171.4404</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the heights has now been estimated.</p>
<blockquote>
<p><strong>Why we use the function:</strong> We need to samples to estimate the percentage intervals, thus sampling is required. One could merely also say <span class="math inline">\(\alpha + \beta * (weight - \bar{weight})\)</span>, thus find the point estimate given the different weights. Although that will not reflect the compatibility intervals.</p>
</blockquote>
<p>Finding point estimates.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="geocentric-models.html#cb132-1" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">=</span> weight_list[<span class="dv">2</span>]</span>
<span id="cb132-2"><a href="geocentric-models.html#cb132-2" aria-hidden="true" tabindex="-1"></a>m<span class="sc">@</span>coef[<span class="st">&#39;a&#39;</span>] <span class="sc">+</span> m<span class="sc">@</span>coef[<span class="st">&#39;b&#39;</span>] <span class="sc">*</span> (weight <span class="sc">-</span> xbar)</span></code></pre></div>
<pre><code>##        a 
## 153.4538</code></pre>
</div>
<div id="h2-1" class="section level3" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> 4H2</h3>
<p>Select out all the rows in the Howell1data with ages below 18 years of age. If you do it right, you should end up with a new data frame with 192 rows in it.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="geocentric-models.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb134-2"><a href="geocentric-models.html#cb134-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1[Howell1<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">18</span>,]</span>
<span id="cb134-3"><a href="geocentric-models.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(d)</span></code></pre></div>
<pre><code>## [1] 192   4</code></pre>
<ol style="list-style-type: lower-alpha">
<li>Fit a linear regression to these data, using quap. Present and interpret the estimates. For every 10 units of increase in weight, how much taller does the model predict a child gets?</li>
</ol>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="geocentric-models.html#cb136-1" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight)</span>
<span id="cb136-2"><a href="geocentric-models.html#cb136-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb136-3"><a href="geocentric-models.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb136-4"><a href="geocentric-models.html#cb136-4" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb136-5"><a href="geocentric-models.html#cb136-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> xbar),</span>
<span id="cb136-6"><a href="geocentric-models.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ),</span>
<span id="cb136-7"><a href="geocentric-models.html#cb136-7" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">10</span> ),</span>
<span id="cb136-8"><a href="geocentric-models.html#cb136-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb136-9"><a href="geocentric-models.html#cb136-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-10"><a href="geocentric-models.html#cb136-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb136-11"><a href="geocentric-models.html#cb136-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb136-12"><a href="geocentric-models.html#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">108.383568</td>
</tr>
<tr class="even">
<td align="right">2.719939</td>
</tr>
<tr class="odd">
<td align="right">8.437316</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.6086646</td>
</tr>
<tr class="even">
<td align="right">0.0682926</td>
</tr>
<tr class="odd">
<td align="right">0.4305876</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">107.410804</td>
</tr>
<tr class="even">
<td align="right">2.610794</td>
</tr>
<tr class="odd">
<td align="right">7.749154</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">109.356332</td>
</tr>
<tr class="even">
<td align="right">2.829083</td>
</tr>
<tr class="odd">
<td align="right">9.125478</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see see that for 1 increase in weight the mean is expected to increase by 2.72. While the 89% combatibiity intervals being 2.61 and 2.83, hence there is a positive effect. Thus by 10 kg, we expect someone to grow by a magnitude of 10.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Plot the raw data, with height on the vertical axis and weight on the horizontal axis. Superimpose the MAP regression line and 89% interval for the mean. Also superimpose the 89% interval for predicted heights.</li>
</ol>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="geocentric-models.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight,<span class="at">y =</span> d<span class="sc">$</span>height,<span class="at">pch =</span> <span class="dv">20</span>,<span class="at">main =</span> <span class="st">&quot;Regression, age &lt; 18&quot;</span></span>
<span id="cb137-2"><a href="geocentric-models.html#cb137-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;Weight&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;Height&quot;</span>)</span>
<span id="cb137-3"><a href="geocentric-models.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb137-4"><a href="geocentric-models.html#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="geocentric-models.html#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding the model predictions</span></span>
<span id="cb137-6"><a href="geocentric-models.html#cb137-6" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m)</span>
<span id="cb137-7"><a href="geocentric-models.html#cb137-7" aria-hidden="true" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb137-8"><a href="geocentric-models.html#cb137-8" aria-hidden="true" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb137-9"><a href="geocentric-models.html#cb137-9" aria-hidden="true" tabindex="-1"></a> <span class="co">#Ability to plot a function</span></span>
<span id="cb137-10"><a href="geocentric-models.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="at">expr =</span> a_map <span class="sc">+</span> b_map <span class="sc">*</span> (x <span class="sc">-</span> xbar)</span>
<span id="cb137-11"><a href="geocentric-models.html#cb137-11" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">add =</span> <span class="cn">TRUE</span> <span class="co">#Add to existing plot</span></span>
<span id="cb137-12"><a href="geocentric-models.html#cb137-12" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span></span>
<span id="cb137-13"><a href="geocentric-models.html#cb137-13" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb137-14"><a href="geocentric-models.html#cb137-14" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb137-15"><a href="geocentric-models.html#cb137-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-16"><a href="geocentric-models.html#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Weight sequence for getting intervals</span></span>
<span id="cb137-17"><a href="geocentric-models.html#cb137-17" aria-hidden="true" tabindex="-1"></a>weight.seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="fu">floor</span>(<span class="fu">min</span>(d<span class="sc">$</span>weight)),<span class="fu">ceiling</span>(<span class="fu">max</span>(d<span class="sc">$</span>weight)),<span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb137-18"><a href="geocentric-models.html#cb137-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-19"><a href="geocentric-models.html#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Simulate height (Simulates posterior observations for map and map2stan model fits.)</span></span>
<span id="cb137-20"><a href="geocentric-models.html#cb137-20" aria-hidden="true" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq)) <span class="co">#n = 1000</span></span>
<span id="cb137-21"><a href="geocentric-models.html#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:42] 63.7 60.3 60.5 45.9 71.7 ...</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="geocentric-models.html#cb139-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2"><a href="geocentric-models.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co">#PI + plot</span></span>
<span id="cb139-3"><a href="geocentric-models.html#cb139-3" aria-hidden="true" tabindex="-1"></a>height.PI89 <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,PI,<span class="at">prob =</span> <span class="fl">0.89</span>)</span>
<span id="cb139-4"><a href="geocentric-models.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(height.PI89,weight.seq)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-71-1.png" width="720" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li>What aspects of the model fit concern you? Describe the kinds of assumptions you would change, if any, to improve the model. You don’t have to write any new code. Just explain what the model appears to be doing a bad job of, and what you hypothesize would be a better model.</li>
</ol>
<p>One could try:</p>
<ol style="list-style-type: decimal">
<li>Polynomial - as it appears as the relationship is not linear.</li>
<li>Splines - same reason as above</li>
</ol>
</div>
<div id="h3-1" class="section level3" number="4.6.5">
<h3><span class="header-section-number">4.6.5</span> 4H3</h3>
<p>Suppose a colleague of yours, who works on allometry, glances at the practice problems just above. Your colleague exclaims, “That’s silly. Everyone knows that it’s only the logarithm of body weight that scales with height!” Let’s take your colleague’s advice and see what happens.</p>
<ol style="list-style-type: lower-alpha">
<li>Model the relationship between height (cm) and the natural logarithm of weight (log-kg). Use the entire Howell1data frame, all 544 rows, adults and non-adults. Can you interpret the resulting estimates?</li>
</ol>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="geocentric-models.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data</span></span>
<span id="cb140-2"><a href="geocentric-models.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb140-3"><a href="geocentric-models.html#cb140-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb140-4"><a href="geocentric-models.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">&quot;data dimensions: &quot;</span>,<span class="fu">dim</span>(d)[<span class="dv">1</span>])</span>
<span id="cb140-5"><a href="geocentric-models.html#cb140-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-6"><a href="geocentric-models.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Define and approximate the model</span></span>
<span id="cb140-7"><a href="geocentric-models.html#cb140-7" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d<span class="sc">$</span>weight)</span>
<span id="cb140-8"><a href="geocentric-models.html#cb140-8" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb140-9"><a href="geocentric-models.html#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb140-10"><a href="geocentric-models.html#cb140-10" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb140-11"><a href="geocentric-models.html#cb140-11" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> (weight <span class="sc">-</span> xbar),</span>
<span id="cb140-12"><a href="geocentric-models.html#cb140-12" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ),</span>
<span id="cb140-13"><a href="geocentric-models.html#cb140-13" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb140-14"><a href="geocentric-models.html#cb140-14" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb140-15"><a href="geocentric-models.html#cb140-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb140-16"><a href="geocentric-models.html#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb140-17"><a href="geocentric-models.html#cb140-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb140-18"><a href="geocentric-models.html#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m)</span></code></pre></div>
<pre><code>## [1] &quot;data dimensions: 544&quot;</code></pre>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">138.279540</td>
</tr>
<tr class="even">
<td align="right">1.763637</td>
</tr>
<tr class="odd">
<td align="right">9.345902</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4006230</td>
</tr>
<tr class="even">
<td align="right">0.0272501</td>
</tr>
<tr class="odd">
<td align="right">0.2833404</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">137.639267</td>
</tr>
<tr class="even">
<td align="right">1.720086</td>
</tr>
<tr class="odd">
<td align="right">8.893069</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">138.919813</td>
</tr>
<tr class="even">
<td align="right">1.807188</td>
</tr>
<tr class="odd">
<td align="right">9.798734</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>Same principle as earlier, we see that one grows with 1.76 for each increase in kg of weight. While the 89% plausible outcomes are 1.72 and 1.81.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Begin with this plot: plot( height ~ weight , data=Howell1 ). Then use samples from the quadratic approximate posterior of the model in (a) to superimpose on the plot: (1) the predicted mean height as a function of weight, (2) the 97% interval for the mean, and (3) the 97% interval for predicted heights.</li>
</ol>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="geocentric-models.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight,<span class="at">y =</span> d<span class="sc">$</span>height,<span class="at">pch =</span> <span class="dv">20</span>,<span class="at">main =</span> <span class="st">&quot;Regression, all observations&quot;</span></span>
<span id="cb142-2"><a href="geocentric-models.html#cb142-2" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;Weight&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;Height&quot;</span>)</span>
<span id="cb142-3"><a href="geocentric-models.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb142-4"><a href="geocentric-models.html#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="geocentric-models.html#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding the model predictions</span></span>
<span id="cb142-6"><a href="geocentric-models.html#cb142-6" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m)</span>
<span id="cb142-7"><a href="geocentric-models.html#cb142-7" aria-hidden="true" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb142-8"><a href="geocentric-models.html#cb142-8" aria-hidden="true" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb142-9"><a href="geocentric-models.html#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Ability to plot a function</span></span>
<span id="cb142-10"><a href="geocentric-models.html#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="at">expr =</span> a_map <span class="sc">+</span> b_map <span class="sc">*</span> (x <span class="sc">-</span> xbar)</span>
<span id="cb142-11"><a href="geocentric-models.html#cb142-11" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">add =</span> <span class="cn">TRUE</span> <span class="co">#Add to existing plot</span></span>
<span id="cb142-12"><a href="geocentric-models.html#cb142-12" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span></span>
<span id="cb142-13"><a href="geocentric-models.html#cb142-13" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb142-14"><a href="geocentric-models.html#cb142-14" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb142-15"><a href="geocentric-models.html#cb142-15" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb142-16"><a href="geocentric-models.html#cb142-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-17"><a href="geocentric-models.html#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Weight sequence for getting intervals</span></span>
<span id="cb142-18"><a href="geocentric-models.html#cb142-18" aria-hidden="true" tabindex="-1"></a>weight.seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="fu">floor</span>(<span class="fu">min</span>(d<span class="sc">$</span>weight)),<span class="fu">ceiling</span>(<span class="fu">max</span>(d<span class="sc">$</span>weight)),<span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb142-19"><a href="geocentric-models.html#cb142-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-20"><a href="geocentric-models.html#cb142-20" aria-hidden="true" tabindex="-1"></a><span class="co"># mean intervals</span></span>
<span id="cb142-21"><a href="geocentric-models.html#cb142-21" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m,<span class="at">data =</span> <span class="fu">list</span>(<span class="at">weight =</span> weight.seq))</span>
<span id="cb142-22"><a href="geocentric-models.html#cb142-22" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="at">X =</span> mu,<span class="at">MARGIN =</span> <span class="dv">2</span>,<span class="at">FUN =</span> PI</span>
<span id="cb142-23"><a href="geocentric-models.html#cb142-23" aria-hidden="true" tabindex="-1"></a>                ,<span class="at">prob=</span><span class="fl">0.97</span> <span class="co">#input for the function</span></span>
<span id="cb142-24"><a href="geocentric-models.html#cb142-24" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb142-25"><a href="geocentric-models.html#cb142-25" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(<span class="at">object =</span> mu.PI,<span class="at">lim =</span> weight.seq,<span class="at">col =</span> <span class="fu">col.alpha</span>(<span class="st">&quot;red&quot;</span>,<span class="fl">0.15</span>))</span>
<span id="cb142-26"><a href="geocentric-models.html#cb142-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-27"><a href="geocentric-models.html#cb142-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Simulate height (Simulates posterior observations for map and map2stan model fits.)</span></span>
<span id="cb142-28"><a href="geocentric-models.html#cb142-28" aria-hidden="true" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>(m, <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq)) <span class="co">#n = 1000</span></span>
<span id="cb142-29"><a href="geocentric-models.html#cb142-29" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span>
<span id="cb142-30"><a href="geocentric-models.html#cb142-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-31"><a href="geocentric-models.html#cb142-31" aria-hidden="true" tabindex="-1"></a><span class="co">#PI + plot intervals for the predictions</span></span>
<span id="cb142-32"><a href="geocentric-models.html#cb142-32" aria-hidden="true" tabindex="-1"></a>height.PI97 <span class="ot">&lt;-</span> <span class="fu">apply</span>(sim.height,<span class="dv">2</span>,PI,<span class="at">prob =</span> <span class="fl">0.97</span>)</span>
<span id="cb142-33"><a href="geocentric-models.html#cb142-33" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(height.PI97,weight.seq,<span class="at">col =</span> <span class="fu">col.alpha</span>(<span class="st">&quot;orange&quot;</span>,<span class="fl">0.15</span>))</span>
<span id="cb142-34"><a href="geocentric-models.html#cb142-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-35"><a href="geocentric-models.html#cb142-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding legend</span></span>
<span id="cb142-36"><a href="geocentric-models.html#cb142-36" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span></span>
<span id="cb142-37"><a href="geocentric-models.html#cb142-37" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Linear pred&quot;</span>,<span class="st">&quot;mean PI97&quot;</span>,<span class="st">&quot;pred PI97&quot;</span>)</span>
<span id="cb142-38"><a href="geocentric-models.html#cb142-38" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;darkblue&quot;</span>,<span class="at">col =</span> <span class="fu">col.alpha</span>(<span class="st">&quot;red&quot;</span>,<span class="fl">0.15</span>),<span class="fu">col.alpha</span>(<span class="st">&quot;orange&quot;</span>,<span class="fl">0.15</span>))</span>
<span id="cb142-39"><a href="geocentric-models.html#cb142-39" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lty =</span> <span class="dv">2</span></span>
<span id="cb142-40"><a href="geocentric-models.html#cb142-40" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">lwd =</span> <span class="dv">5</span></span>
<span id="cb142-41"><a href="geocentric-models.html#cb142-41" aria-hidden="true" tabindex="-1"></a>       ,<span class="at">cex =</span> <span class="fl">0.8</span></span>
<span id="cb142-42"><a href="geocentric-models.html#cb142-42" aria-hidden="true" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-74-1.png" width="720" style="display: block; margin: auto;" /></p>
<pre><code>##  num [1:1000, 1:60] 94 73.8 93.9 92.8 89.1 ...</code></pre>
<p>We see that the expected mean is very close to the linear prediction, while the actual predictions are expected to lie in a wider space.</p>
</div>
<div id="h6" class="section level3" number="4.6.6">
<h3><span class="header-section-number">4.6.6</span> 4H6</h3>
<p>Simulate the prior predictive distribution for the cherry blossom spline in the chapter. Adjust the prior on the weights and observe what happens. What do you think the prior on the weights is doing?</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="geocentric-models.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load data</span></span>
<span id="cb144-2"><a href="geocentric-models.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb144-3"><a href="geocentric-models.html#cb144-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> cherry_blossoms</span>
<span id="cb144-4"><a href="geocentric-models.html#cb144-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[<span class="fu">complete.cases</span>(d<span class="sc">$</span>temp),] <span class="co"># complete cases on temp</span></span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="geocentric-models.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining spline specifications</span></span>
<span id="cb145-2"><a href="geocentric-models.html#cb145-2" aria-hidden="true" tabindex="-1"></a>num_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb145-3"><a href="geocentric-models.html#cb145-3" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="at">x =</span> d<span class="sc">$</span>year <span class="co">#Data</span></span>
<span id="cb145-4"><a href="geocentric-models.html#cb145-4" aria-hidden="true" tabindex="-1"></a>                      ,<span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span>num_knots) <span class="co">#probabilities</span></span>
<span id="cb145-5"><a href="geocentric-models.html#cb145-5" aria-hidden="true" tabindex="-1"></a>                      )</span>
<span id="cb145-6"><a href="geocentric-models.html#cb145-6" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,num_knots)] <span class="co">#Remove knot at 0 and 1</span></span>
<span id="cb145-7"><a href="geocentric-models.html#cb145-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-8"><a href="geocentric-models.html#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining the splines - notice that m is altered in later code to represent other examples</span></span>
<span id="cb145-9"><a href="geocentric-models.html#cb145-9" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(</span>
<span id="cb145-10"><a href="geocentric-models.html#cb145-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> d<span class="sc">$</span>year</span>
<span id="cb145-11"><a href="geocentric-models.html#cb145-11" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">knots =</span> knot_list</span>
<span id="cb145-12"><a href="geocentric-models.html#cb145-12" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">degree =</span> <span class="dv">3</span> <span class="co">#cubic splines</span></span>
<span id="cb145-13"><a href="geocentric-models.html#cb145-13" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">intercept =</span> <span class="cn">TRUE</span></span>
<span id="cb145-14"><a href="geocentric-models.html#cb145-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-15"><a href="geocentric-models.html#cb145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-16"><a href="geocentric-models.html#cb145-16" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb145-17"><a href="geocentric-models.html#cb145-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">alist</span>(</span>
<span id="cb145-18"><a href="geocentric-models.html#cb145-18" aria-hidden="true" tabindex="-1"></a>                T <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb145-19"><a href="geocentric-models.html#cb145-19" aria-hidden="true" tabindex="-1"></a>                ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w</span>
<span id="cb145-20"><a href="geocentric-models.html#cb145-20" aria-hidden="true" tabindex="-1"></a>                ,a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>,<span class="dv">10</span>)</span>
<span id="cb145-21"><a href="geocentric-models.html#cb145-21" aria-hidden="true" tabindex="-1"></a>                ,w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb145-22"><a href="geocentric-models.html#cb145-22" aria-hidden="true" tabindex="-1"></a>                ,sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb145-23"><a href="geocentric-models.html#cb145-23" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb145-24"><a href="geocentric-models.html#cb145-24" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> <span class="fu">list</span>(<span class="at">T =</span> d<span class="sc">$</span>temp,<span class="at">B =</span> B)</span>
<span id="cb145-25"><a href="geocentric-models.html#cb145-25" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">ncol</span>(B)))</span>
<span id="cb145-26"><a href="geocentric-models.html#cb145-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-27"><a href="geocentric-models.html#cb145-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-28"><a href="geocentric-models.html#cb145-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-29"><a href="geocentric-models.html#cb145-29" aria-hidden="true" tabindex="-1"></a><span class="do">### PLOTTING!</span></span>
<span id="cb145-30"><a href="geocentric-models.html#cb145-30" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, .<span class="dv">1</span>, .<span class="dv">1</span>),<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>)) <span class="co">#adjust print window</span></span>
<span id="cb145-31"><a href="geocentric-models.html#cb145-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-32"><a href="geocentric-models.html#cb145-32" aria-hidden="true" tabindex="-1"></a><span class="do">### Top print</span></span>
<span id="cb145-33"><a href="geocentric-models.html#cb145-33" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(m)</span>
<span id="cb145-34"><a href="geocentric-models.html#cb145-34" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m,<span class="at">post =</span> p)</span>
<span id="cb145-35"><a href="geocentric-models.html#cb145-35" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>year,<span class="at">y =</span> d<span class="sc">$</span>doy</span>
<span id="cb145-36"><a href="geocentric-models.html#cb145-36" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.3</span>)</span>
<span id="cb145-37"><a href="geocentric-models.html#cb145-37" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">pch =</span> <span class="dv">16</span></span>
<span id="cb145-38"><a href="geocentric-models.html#cb145-38" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;day in year&quot;</span></span>
<span id="cb145-39"><a href="geocentric-models.html#cb145-39" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">140</span>)</span>
<span id="cb145-40"><a href="geocentric-models.html#cb145-40" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">sub =</span> <span class="st">&quot;w ~ dnorm(0,10)&quot;</span></span>
<span id="cb145-41"><a href="geocentric-models.html#cb145-41" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb145-42"><a href="geocentric-models.html#cb145-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-43"><a href="geocentric-models.html#cb145-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> ) <span class="fu">lines</span>( d<span class="sc">$</span>year , mu[i,] , <span class="at">lwd=</span><span class="dv">1</span>)</span>
<span id="cb145-44"><a href="geocentric-models.html#cb145-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-45"><a href="geocentric-models.html#cb145-45" aria-hidden="true" tabindex="-1"></a><span class="do">### Middle print</span></span>
<span id="cb145-46"><a href="geocentric-models.html#cb145-46" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb145-47"><a href="geocentric-models.html#cb145-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">alist</span>(</span>
<span id="cb145-48"><a href="geocentric-models.html#cb145-48" aria-hidden="true" tabindex="-1"></a>                T <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb145-49"><a href="geocentric-models.html#cb145-49" aria-hidden="true" tabindex="-1"></a>                ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w</span>
<span id="cb145-50"><a href="geocentric-models.html#cb145-50" aria-hidden="true" tabindex="-1"></a>                ,a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>,<span class="dv">10</span>)</span>
<span id="cb145-51"><a href="geocentric-models.html#cb145-51" aria-hidden="true" tabindex="-1"></a>                ,w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="co">#This is altered</span></span>
<span id="cb145-52"><a href="geocentric-models.html#cb145-52" aria-hidden="true" tabindex="-1"></a>                ,sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb145-53"><a href="geocentric-models.html#cb145-53" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb145-54"><a href="geocentric-models.html#cb145-54" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> <span class="fu">list</span>(<span class="at">T =</span> d<span class="sc">$</span>temp,<span class="at">B =</span> B)</span>
<span id="cb145-55"><a href="geocentric-models.html#cb145-55" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">ncol</span>(B)))</span>
<span id="cb145-56"><a href="geocentric-models.html#cb145-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-57"><a href="geocentric-models.html#cb145-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-58"><a href="geocentric-models.html#cb145-58" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(m)</span>
<span id="cb145-59"><a href="geocentric-models.html#cb145-59" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m,<span class="at">post =</span> p)</span>
<span id="cb145-60"><a href="geocentric-models.html#cb145-60" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>year,<span class="at">y =</span> d<span class="sc">$</span>doy</span>
<span id="cb145-61"><a href="geocentric-models.html#cb145-61" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.3</span>)</span>
<span id="cb145-62"><a href="geocentric-models.html#cb145-62" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">pch =</span> <span class="dv">16</span></span>
<span id="cb145-63"><a href="geocentric-models.html#cb145-63" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;day in year&quot;</span></span>
<span id="cb145-64"><a href="geocentric-models.html#cb145-64" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">140</span>)</span>
<span id="cb145-65"><a href="geocentric-models.html#cb145-65" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">sub =</span> <span class="st">&quot;w ~ dnorm(0,5)&quot;</span></span>
<span id="cb145-66"><a href="geocentric-models.html#cb145-66" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb145-67"><a href="geocentric-models.html#cb145-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-68"><a href="geocentric-models.html#cb145-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> ) <span class="fu">lines</span>( d<span class="sc">$</span>year , mu[i,] , <span class="at">lwd=</span><span class="dv">1</span>)</span>
<span id="cb145-69"><a href="geocentric-models.html#cb145-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-70"><a href="geocentric-models.html#cb145-70" aria-hidden="true" tabindex="-1"></a><span class="do">### Bottum print</span></span>
<span id="cb145-71"><a href="geocentric-models.html#cb145-71" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb145-72"><a href="geocentric-models.html#cb145-72" aria-hidden="true" tabindex="-1"></a>          <span class="fu">alist</span>(</span>
<span id="cb145-73"><a href="geocentric-models.html#cb145-73" aria-hidden="true" tabindex="-1"></a>                T <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma)</span>
<span id="cb145-74"><a href="geocentric-models.html#cb145-74" aria-hidden="true" tabindex="-1"></a>                ,mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w</span>
<span id="cb145-75"><a href="geocentric-models.html#cb145-75" aria-hidden="true" tabindex="-1"></a>                ,a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>,<span class="dv">10</span>)</span>
<span id="cb145-76"><a href="geocentric-models.html#cb145-76" aria-hidden="true" tabindex="-1"></a>                ,w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="co">#This is altered</span></span>
<span id="cb145-77"><a href="geocentric-models.html#cb145-77" aria-hidden="true" tabindex="-1"></a>                ,sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb145-78"><a href="geocentric-models.html#cb145-78" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb145-79"><a href="geocentric-models.html#cb145-79" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">data =</span> <span class="fu">list</span>(<span class="at">T =</span> d<span class="sc">$</span>temp,<span class="at">B =</span> B)</span>
<span id="cb145-80"><a href="geocentric-models.html#cb145-80" aria-hidden="true" tabindex="-1"></a>          ,<span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">ncol</span>(B)))</span>
<span id="cb145-81"><a href="geocentric-models.html#cb145-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-82"><a href="geocentric-models.html#cb145-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-83"><a href="geocentric-models.html#cb145-83" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(m)</span>
<span id="cb145-84"><a href="geocentric-models.html#cb145-84" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">link</span>(m,<span class="at">post =</span> p)</span>
<span id="cb145-85"><a href="geocentric-models.html#cb145-85" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>year,<span class="at">y =</span> d<span class="sc">$</span>doy</span>
<span id="cb145-86"><a href="geocentric-models.html#cb145-86" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2,<span class="fl">0.3</span>)</span>
<span id="cb145-87"><a href="geocentric-models.html#cb145-87" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">pch =</span> <span class="dv">16</span></span>
<span id="cb145-88"><a href="geocentric-models.html#cb145-88" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;day in year&quot;</span></span>
<span id="cb145-89"><a href="geocentric-models.html#cb145-89" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">140</span>)</span>
<span id="cb145-90"><a href="geocentric-models.html#cb145-90" aria-hidden="true" tabindex="-1"></a>     ,<span class="at">sub =</span> <span class="st">&quot;w ~ dnorm(0,1)&quot;</span></span>
<span id="cb145-91"><a href="geocentric-models.html#cb145-91" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb145-92"><a href="geocentric-models.html#cb145-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-93"><a href="geocentric-models.html#cb145-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> ) <span class="fu">lines</span>( d<span class="sc">$</span>year , mu[i,] , <span class="at">lwd=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-77-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that the smaller we define the width of w, the less wiggly will the lines be. Hence we add more penalty to the movements, i.e., so we generalize more and fit less to the data.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-3-sampling-the-imaginary.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lecture-notes-wrap-up-chapters-geocentric-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
