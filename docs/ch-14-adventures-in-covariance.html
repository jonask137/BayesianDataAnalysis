<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15 Ch 14 - Adventures in Covariance | Bayesian Data Analysis Notes</title>
  <meta name="description" content="15 Ch 14 - Adventures in Covariance | Bayesian Data Analysis Notes" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="15 Ch 14 - Adventures in Covariance | Bayesian Data Analysis Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15 Ch 14 - Adventures in Covariance | Bayesian Data Analysis Notes" />
  
  
  

<meta name="author" content="Jonas Ringive Korsholm" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-14-advuntetures-in-coviaraince.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="chapter-1-golems-of-prague.html"><a href="chapter-1-golems-of-prague.html"><i class="fa fa-check"></i><b>1</b> Chapter 1 - Golems of Prague</a></li>
<li class="chapter" data-level="2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Chapter 2 - Small worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#models-and-estimation"><i class="fa fa-check"></i><b>2.1</b> Models and Estimation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#engines-motors-to-estimate-the-models"><i class="fa fa-check"></i><b>2.1.1</b> Engines / Motors to estimate the models</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.1.1.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.1.1.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.1.1.3" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.1.1.3</b> Markov Chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#exercises"><i class="fa fa-check"></i><b>2.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.2.1</b> 2M1</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.2.2</b> 2M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Chapter 3 - Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-boundaries"><i class="fa fa-check"></i><b>3.2.1</b> Defined Boundaries</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-probability-mass"><i class="fa fa-check"></i><b>3.2.2</b> Defined Probability Mass</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i><b>3.2.3</b> Point Estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i><b>3.3.1</b> Dummy Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.2</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m1-1"><i class="fa fa-check"></i><b>3.4.1</b> 3M1</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m2-1"><i class="fa fa-check"></i><b>3.4.2</b> 3M2</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m3"><i class="fa fa-check"></i><b>3.4.3</b> 3M3</a></li>
<li class="chapter" data-level="3.4.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m4"><i class="fa fa-check"></i><b>3.4.4</b> 3M4</a></li>
<li class="chapter" data-level="3.4.5" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m5"><i class="fa fa-check"></i><b>3.4.5</b> 3M5</a></li>
<li class="chapter" data-level="3.4.6" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h1"><i class="fa fa-check"></i><b>3.4.6</b> 3H1</a></li>
<li class="chapter" data-level="3.4.7" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h2"><i class="fa fa-check"></i><b>3.4.7</b> 3H2</a></li>
<li class="chapter" data-level="3.4.8" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h3"><i class="fa fa-check"></i><b>3.4.8</b> 3H3</a></li>
<li class="chapter" data-level="3.4.9" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h4"><i class="fa fa-check"></i><b>3.4.9</b> 3H4</a></li>
<li class="chapter" data-level="3.4.10" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h5"><i class="fa fa-check"></i><b>3.4.10</b> 3H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why Normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model"><i class="fa fa-check"></i><b>4.3.1</b> The model</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>4.3.3</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap"><i class="fa fa-check"></i><b>4.3.4</b> Finding the posterior distribution with quap</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap"><i class="fa fa-check"></i><b>4.3.5</b> Sampling from a quap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-lienar-mdoel-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The lienar mdoel strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution</a>
<ul>
<li class="chapter" data-level="4.4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#tables-fo-marginal-distributions"><i class="fa fa-check"></i><b>4.4.3.1</b> Tables fo marginal distributions</a></li>
<li class="chapter" data-level="4.4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-posterior-inference-against-the-data"><i class="fa fa-check"></i><b>4.4.3.2</b> Plotting posterior inference against the data</a></li>
<li class="chapter" data-level="4.4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#adding-uncertainty-around-the-mean"><i class="fa fa-check"></i><b>4.4.3.3</b> Adding uncertainty around the mean</a></li>
<li class="chapter" data-level="4.4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-regression-intervlas-and-contours"><i class="fa fa-check"></i><b>4.4.3.4</b> Plotting regression intervlas and contours</a></li>
<li class="chapter" data-level="4.4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#prediction-intevals"><i class="fa fa-check"></i><b>4.4.3.5</b> Prediction intevals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-form-lines"><i class="fa fa-check"></i><b>4.5</b> Curves form lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i><b>4.5.2</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#exercises-2"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-models.html"><a href="geocentric-models.html#m1-2"><i class="fa fa-check"></i><b>4.6.1</b> 4M1</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-models.html"><a href="geocentric-models.html#m8"><i class="fa fa-check"></i><b>4.6.2</b> 4M8</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-models.html"><a href="geocentric-models.html#h1-1"><i class="fa fa-check"></i><b>4.6.3</b> 4H1</a></li>
<li class="chapter" data-level="4.6.4" data-path="geocentric-models.html"><a href="geocentric-models.html#h2-1"><i class="fa fa-check"></i><b>4.6.4</b> 4H2</a></li>
<li class="chapter" data-level="4.6.5" data-path="geocentric-models.html"><a href="geocentric-models.html#h3-1"><i class="fa fa-check"></i><b>4.6.5</b> 4H3</a>
<ul>
<li class="chapter" data-level="4.6.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-same-but-using-log-of-weight"><i class="fa fa-check"></i><b>4.6.5.1</b> The same but using log of weight</a></li>
</ul></li>
<li class="chapter" data-level="4.6.6" data-path="geocentric-models.html"><a href="geocentric-models.html#h6"><i class="fa fa-check"></i><b>4.6.6</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lecture-notes-wrap-up-chapters-geocentric-models.html"><a href="lecture-notes-wrap-up-chapters-geocentric-models.html"><i class="fa fa-check"></i><b>5</b> Lecture notes - wrap up chapters geocentric models</a></li>
<li class="chapter" data-level="6" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>6.1</b> Spurious Associations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#defining-a-multiple-regression"><i class="fa fa-check"></i><b>6.1.1</b> Defining a multiple regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#approximating-the-posterior"><i class="fa fa-check"></i><b>6.1.2</b> Approximating the posterior</a></li>
<li class="chapter" data-level="6.1.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#the-flow"><i class="fa fa-check"></i><b>6.1.3</b> The flow</a>
<ul>
<li class="chapter" data-level="6.1.3.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>6.1.3.1</b> Posterior Prediction Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>6.2</b> Masked Relationship</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>6.3</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#lecture-notes---not-integrated-in-the-notes"><i class="fa fa-check"></i><b>6.4</b> Lecture notes - not integrated in the notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>7.1</b> Multicollinearity</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post Treatment Bias</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>7.4</b> Confronting Confounding</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#exercises-3"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m1-3"><i class="fa fa-check"></i><b>7.5.1</b> 6M1</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m3-1"><i class="fa fa-check"></i><b>7.5.2</b> 6M3</a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h"><i class="fa fa-check"></i><b>7.5.3</b> 6H</a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h3-2"><i class="fa fa-check"></i><b>7.5.4</b> 6H3</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h4-1"><i class="fa fa-check"></i><b>7.5.5</b> 6H4</a></li>
<li class="chapter" data-level="7.5.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h5-1"><i class="fa fa-check"></i><b>7.5.6</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#lecture-notes---not-integrated-in-the-text"><i class="fa fa-check"></i><b>7.6</b> Lecture notes - not integrated in the text</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model comparison</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The problem with parameters</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem Taming: Regularization</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>8.4</b> Predicting predictive accuracy</a></li>
<li class="chapter" data-level="8.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#model-comparison"><i class="fa fa-check"></i><b>8.5</b> Model Comparison</a></li>
<li class="chapter" data-level="8.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#exercies"><i class="fa fa-check"></i><b>8.6</b> Exercies</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m3-2"><i class="fa fa-check"></i><b>8.6.1</b> 7M3</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m4-1"><i class="fa fa-check"></i><b>8.6.2</b> 7M4</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m5-1"><i class="fa fa-check"></i><b>8.6.3</b> 7M5</a></li>
<li class="chapter" data-level="8.6.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m6"><i class="fa fa-check"></i><b>8.6.4</b> 7M6</a></li>
<li class="chapter" data-level="8.6.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h1-2"><i class="fa fa-check"></i><b>8.6.5</b> 7H1</a></li>
<li class="chapter" data-level="8.6.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h2-2"><i class="fa fa-check"></i><b>8.6.6</b> 7H2</a>
<ul>
<li class="chapter" data-level="8.6.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#identify-the-outlier"><i class="fa fa-check"></i><b>8.6.6.1</b> (1) Identify the outlier</a></li>
<li class="chapter" data-level="8.6.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#inspect-model-predictions"><i class="fa fa-check"></i><b>8.6.6.2</b> (2) Inspect model predictions</a></li>
<li class="chapter" data-level="8.6.6.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#using-students-t-distribution"><i class="fa fa-check"></i><b>8.6.6.3</b> (3) Using students t distribution</a></li>
</ul></li>
<li class="chapter" data-level="8.6.7" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h5-2"><i class="fa fa-check"></i><b>8.6.7</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html"><i class="fa fa-check"></i><b>9</b> Chapter 8 - Model comparison</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>9.1.1</b> Adding an indicator variable isn’t enough.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#continuous-interactions"><i class="fa fa-check"></i><b>9.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#a-winter-flower"><i class="fa fa-check"></i><b>9.3.1</b> A Winter Flower</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#the-models"><i class="fa fa-check"></i><b>9.3.2</b> The models</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#exercises-4"><i class="fa fa-check"></i><b>9.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#m4-2"><i class="fa fa-check"></i><b>9.4.1</b> 8M4</a>
<ul>
<li class="chapter" data-level="9.4.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#interaction-model"><i class="fa fa-check"></i><b>9.4.1.1</b> Interaction model</a></li>
<li class="chapter" data-level="9.4.1.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#conclusion"><i class="fa fa-check"></i><b>9.4.1.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#h3-3"><i class="fa fa-check"></i><b>9.4.2</b> 8H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>10</b> Chapter 9 - Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algorithms</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#easy-hmc-ulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: ulam</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-quap"><i class="fa fa-check"></i><b>10.4.1</b> Fitting using quap</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-hmc"><i class="fa fa-check"></i><b>10.4.2</b> Fitting using HMC</a>
<ul>
<li class="chapter" data-level="10.4.2.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#preparing-data"><i class="fa fa-check"></i><b>10.4.2.1</b> Preparing data</a></li>
<li class="chapter" data-level="10.4.2.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-from-the-posterior-1"><i class="fa fa-check"></i><b>10.4.2.2</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="10.4.2.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>10.4.2.3</b> Sampling again, in parallel</a></li>
<li class="chapter" data-level="10.4.2.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>10.4.2.4</b> Visualization</a></li>
<li class="chapter" data-level="10.4.2.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.2.5</b> Checking the chain</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>10.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="10.5.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>10.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="10.5.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#taming-a-wild-chain"><i class="fa fa-check"></i><b>10.5.3</b> Taming a wild chain</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#exercises-5"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e4"><i class="fa fa-check"></i><b>10.6.1</b> E4</a></li>
<li class="chapter" data-level="10.6.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e5"><i class="fa fa-check"></i><b>10.6.2</b> E5</a></li>
<li class="chapter" data-level="10.6.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e6"><i class="fa fa-check"></i><b>10.6.3</b> E6</a></li>
<li class="chapter" data-level="10.6.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e7"><i class="fa fa-check"></i><b>10.6.4</b> E7</a></li>
<li class="chapter" data-level="10.6.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#m1-4"><i class="fa fa-check"></i><b>10.6.5</b> M1</a></li>
<li class="chapter" data-level="10.6.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#h2-3"><i class="fa fa-check"></i><b>10.6.6</b> H2</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#lecture-notes"><i class="fa fa-check"></i><b>10.7</b> Lecture notes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>11</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>11.1.1</b> Binomial</a>
<ul>
<li class="chapter" data-level="11.1.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#example-from-the-lecture"><i class="fa fa-check"></i><b>11.1.1.1</b> Example from the lecture</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="11.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy-priors"><i class="fa fa-check"></i><b>11.3</b> Maximum entropy priors</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>12</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="12.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression</a>
<ul>
<li class="chapter" data-level="12.1.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.0.1</b> Logistic regression: Prosocial chimpanzees:</a></li>
<li class="chapter" data-level="12.1.0.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.0.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="12.1.0.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>12.1.0.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="12.1.0.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.0.4</b> Aggregated binomial: Graduate school admissions</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression</a>
<ul>
<li class="chapter" data-level="12.2.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>12.2.0.1</b> Negative binomial (gamma-poisson) models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-regression"><i class="fa fa-check"></i><b>12.3</b> Multinomial Regression</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-from-the-lecture-1"><i class="fa fa-check"></i><b>12.3.1</b> Example from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#exercies-1"><i class="fa fa-check"></i><b>12.4</b> Exercies</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>12.4.1</b> E1</a></li>
<li class="chapter" data-level="12.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2"><i class="fa fa-check"></i><b>12.4.2</b> E2</a></li>
<li class="chapter" data-level="12.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3"><i class="fa fa-check"></i><b>12.4.3</b> E3</a></li>
<li class="chapter" data-level="12.4.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7"><i class="fa fa-check"></i><b>12.4.4</b> M7</a></li>
<li class="chapter" data-level="12.4.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-3"><i class="fa fa-check"></i><b>12.4.5</b> H1</a></li>
<li class="chapter" data-level="12.4.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-4"><i class="fa fa-check"></i><b>12.4.6</b> H2</a></li>
<li class="chapter" data-level="12.4.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-4"><i class="fa fa-check"></i><b>12.4.7</b> H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Ch 13 - Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-effects-and-the-underfitting-overfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting / overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-model-1"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#assign-values-to-the-parameters"><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.3</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a></li>
<li class="chapter" data-level="13.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.0.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-devils-funnel-example"><i class="fa fa-check"></i><b>13.4.0.1</b> The Devil’s Funnel: (example)</a></li>
<li class="chapter" data-level="13.4.0.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#non-centered-chimpanzees-example"><i class="fa fa-check"></i><b>13.4.0.2</b> Non-centered chimpanzees (example)</a>
<ul>
<li class="chapter" data-level="13.4.0.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-1-centered-parameterization-increasing-acceptance-rate"><i class="fa fa-check"></i><b>13.4.0.2.1</b> Solution 1: Centered parameterization (Increasing acceptance rate)</a></li>
<li class="chapter" data-level="13.4.0.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-2-non-centered-version-reparameterize"><i class="fa fa-check"></i><b>13.4.0.2.2</b> Solution 2: Non-centered version (reparameterize)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#exercises-6"><i class="fa fa-check"></i><b>13.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e1-1"><i class="fa fa-check"></i><b>13.6.1</b> E1</a></li>
<li class="chapter" data-level="13.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e2-1"><i class="fa fa-check"></i><b>13.6.2</b> E2</a></li>
<li class="chapter" data-level="13.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e3-1"><i class="fa fa-check"></i><b>13.6.3</b> E3</a></li>
<li class="chapter" data-level="13.6.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e4-1"><i class="fa fa-check"></i><b>13.6.4</b> E4</a></li>
<li class="chapter" data-level="13.6.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#m1-5"><i class="fa fa-check"></i><b>13.6.5</b> M1</a></li>
<li class="chapter" data-level="13.6.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#h1-4"><i class="fa fa-check"></i><b>13.6.6</b> H1</a>
<ul>
<li class="chapter" data-level="13.6.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#fixed-effects-model"><i class="fa fa-check"></i><b>13.6.6.1</b> Fixed effects model:</a></li>
<li class="chapter" data-level="13.6.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-intercepts-model"><i class="fa fa-check"></i><b>13.6.6.2</b> Varying intercepts model:</a></li>
<li class="chapter" data-level="13.6.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#extract-samples"><i class="fa fa-check"></i><b>13.6.6.3</b> Extract samples</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html"><i class="fa fa-check"></i><b>14</b> Ch 14 - Advuntetures in Coviaraince</a>
<ul>
<li class="chapter" data-level="14.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-the-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population</a></li>
<li class="chapter" data-level="14.1.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-observations"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations</a></li>
<li class="chapter" data-level="14.1.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a>
<ul>
<li class="chapter" data-level="14.2.0.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#inference"><i class="fa fa-check"></i><b>14.2.0.1</b> Inference!</a></li>
<li class="chapter" data-level="14.2.0.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#conclusions---multilevel-horoscopes"><i class="fa fa-check"></i><b>14.2.0.2</b> Conclusions - multilevel horoscopes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#exercises-7"><i class="fa fa-check"></i><b>14.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e1-2"><i class="fa fa-check"></i><b>14.3.1</b> E1</a></li>
<li class="chapter" data-level="14.3.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e3-2"><i class="fa fa-check"></i><b>14.3.2</b> E3</a></li>
<li class="chapter" data-level="14.3.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h1-5"><i class="fa fa-check"></i><b>14.3.3</b> H1</a></li>
<li class="chapter" data-level="14.3.4" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h2-5"><i class="fa fa-check"></i><b>14.3.4</b> H2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html"><i class="fa fa-check"></i><b>15</b> Ch 14 - Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="15.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#ch-14.3---instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.1</b> Ch 14.3 - Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>15.1.1</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.1.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#only-including-e-we-add-confounding-effect-sideeffect-of-e"><i class="fa fa-check"></i><b>15.1.1.1</b> 1. Only including E (we add confounding effect sideeffect of E)</a></li>
<li class="chapter" data-level="15.1.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#adding-instrument-q-the-wrong-way"><i class="fa fa-check"></i><b>15.1.1.2</b> 2. Adding instrument Q (the wrong way)</a></li>
<li class="chapter" data-level="15.1.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#correct-use-of-the-instrument-variable"><i class="fa fa-check"></i><b>15.1.1.3</b> 3. Correct use of the instrument variable</a></li>
</ul></li>
<li class="chapter" data-level="15.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>15.1.2</b> Other designs</a>
<ul>
<li class="chapter" data-level="15.1.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#front-door-criterion"><i class="fa fa-check"></i><b>15.1.2.1</b> Front-Door Criterion</a></li>
<li class="chapter" data-level="15.1.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#regression-discontinuity-rdd"><i class="fa fa-check"></i><b>15.1.2.2</b> Regression discontinuity (RDD)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-processes-continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.2</b> (Gaussian Processes) Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>15.2.1</b> Example: Spatial autocorrelation in Oceanic tools</a>
<ul>
<li class="chapter" data-level="15.2.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#loading-data-defining-model"><i class="fa fa-check"></i><b>15.2.1.1</b> Loading data + defining model</a></li>
<li class="chapter" data-level="15.2.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#the-full-model"><i class="fa fa-check"></i><b>15.2.1.2</b> The full model</a></li>
<li class="chapter" data-level="15.2.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-process-posterior"><i class="fa fa-check"></i><b>15.2.1.3</b> Gaussian Process Posterior</a></li>
</ul></li>
<li class="chapter" data-level="15.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-phylogenetic-distance-not-in-the-curriculum"><i class="fa fa-check"></i><b>15.2.2</b> Example: Phylogenetic distance (not in the curriculum)</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#exercises-8"><i class="fa fa-check"></i><b>15.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m3-3"><i class="fa fa-check"></i><b>15.3.1</b> M3</a></li>
<li class="chapter" data-level="15.3.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m4-3"><i class="fa fa-check"></i><b>15.3.2</b> M4</a></li>
<li class="chapter" data-level="15.3.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h2-6"><i class="fa fa-check"></i><b>15.3.3</b> H2</a></li>
<li class="chapter" data-level="15.3.4" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h4-varying-intercepts-varying-slopes"><i class="fa fa-check"></i><b>15.3.4</b> H4 Varying intercepts Varying slopes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-14---adventures-in-covariance" class="section level1" number="15">
<h1><span class="header-section-number">15</span> Ch 14 - Adventures in Covariance</h1>
<div id="ch-14.3---instruments-and-causal-designs" class="section level2" number="15.1">
<h2><span class="header-section-number">15.1</span> Ch 14.3 - Instruments and causal designs</h2>
<p>Sometimes it may not be possible to close all backdoors in a DAG. There are different approaches to this, the most famous is first represented and then alternatives are presented.</p>
<div id="instrumental-variables" class="section level3" number="15.1.1">
<h3><span class="header-section-number">15.1.1</span> Instrumental variables</h3>
<p>Althoguh in rare occations it may be possible to specify the model otherwise and include an instrumental variable to enable correct inferrential properties of a model.</p>
<p><em>If the model is misspecified, then there is a possibility of the coefficients for the model parameters being wrong. Hence inference bbeing done on this model will be wrong. Thus empasizing the importance of evaluating the DAGs</em></p>
<p>Let say we have the following DAG.</p>
<p><img src="Images/paste-35FEEEE5.png" /></p>
<p>We see that U is an observed variable and has a forking property, where it influence both W and E. Although it is unobserved hence we cannot include it in the model.</p>
<p><em>Hence there is a backdoor! (confounding effect)</em>. We may be able to solve this with an <strong>instrumental variable</strong>. For an instrumental variable to be valid it needs to fulfill the following properties.</p>
<hr />
<p><em>He makes an example of regressing education on wage, where we also may expect that lazyness is a deterministic factor, although we cannot observe that, so by including age we also indicrectly include lazyness as high lazyness may mean less education but also on lower wages. Thus, we have opened a backdoor and sit with a confounding effect. The following section elaborates on how an instrument can be added.</em></p>
<hr />
<ol style="list-style-type: decimal">
<li>Must be independent of the unobserved U, hence Q independent of U</li>
<li>Must not be dependent of the observed variable that we want to make inference on.</li>
<li>Q (instrumental variable) cannot influence the target variable, as that would create a babckdoor.</li>
</ol>
<p><em>Code example, we are going to simulate some data so we know the relations.</em></p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="ch-14-adventures-in-covariance.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb383-2"><a href="ch-14-adventures-in-covariance.html#cb383-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb383-3"><a href="ch-14-adventures-in-covariance.html#cb383-3" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">&quot;dag {</span></span>
<span id="cb383-4"><a href="ch-14-adventures-in-covariance.html#cb383-4" aria-hidden="true" tabindex="-1"></a><span class="st">  U [unobserved]</span></span>
<span id="cb383-5"><a href="ch-14-adventures-in-covariance.html#cb383-5" aria-hidden="true" tabindex="-1"></a><span class="st">  E [exposure]</span></span>
<span id="cb383-6"><a href="ch-14-adventures-in-covariance.html#cb383-6" aria-hidden="true" tabindex="-1"></a><span class="st">  W [outcome]</span></span>
<span id="cb383-7"><a href="ch-14-adventures-in-covariance.html#cb383-7" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; E</span></span>
<span id="cb383-8"><a href="ch-14-adventures-in-covariance.html#cb383-8" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; W</span></span>
<span id="cb383-9"><a href="ch-14-adventures-in-covariance.html#cb383-9" aria-hidden="true" tabindex="-1"></a><span class="st">  E -&gt; W</span></span>
<span id="cb383-10"><a href="ch-14-adventures-in-covariance.html#cb383-10" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb383-11"><a href="ch-14-adventures-in-covariance.html#cb383-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb383-12"><a href="ch-14-adventures-in-covariance.html#cb383-12" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>(dag)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-194-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We want to measure E’s effect on W, although by including E we will also open the backdoor to U, which we cannot control for as it is unknown. Thus we are going to add the instrument variable Q.</p>
<p>We simulate the effect so Education correltion on wages is 0.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="ch-14-adventures-in-covariance.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">73</span>)</span>
<span id="cb384-2"><a href="ch-14-adventures-in-covariance.html#cb384-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb384-3"><a href="ch-14-adventures-in-covariance.html#cb384-3" aria-hidden="true" tabindex="-1"></a>U_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N )</span>
<span id="cb384-4"><a href="ch-14-adventures-in-covariance.html#cb384-4" aria-hidden="true" tabindex="-1"></a>Q_sim <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> , <span class="at">size=</span>N , <span class="at">replace=</span><span class="cn">TRUE</span> )</span>
<span id="cb384-5"><a href="ch-14-adventures-in-covariance.html#cb384-5" aria-hidden="true" tabindex="-1"></a>E_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , U_sim <span class="sc">+</span> Q_sim ) <span class="co">#E = education</span></span>
<span id="cb384-6"><a href="ch-14-adventures-in-covariance.html#cb384-6" aria-hidden="true" tabindex="-1"></a>W_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , U_sim <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>E_sim ) <span class="co">#0 * E_sim = 500 zeros, W = wages</span></span>
<span id="cb384-7"><a href="ch-14-adventures-in-covariance.html#cb384-7" aria-hidden="true" tabindex="-1"></a>dat_sim <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb384-8"><a href="ch-14-adventures-in-covariance.html#cb384-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">W=</span><span class="fu">standardize</span>(W_sim) ,</span>
<span id="cb384-9"><a href="ch-14-adventures-in-covariance.html#cb384-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">E=</span><span class="fu">standardize</span>(E_sim) ,</span>
<span id="cb384-10"><a href="ch-14-adventures-in-covariance.html#cb384-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q=</span><span class="fu">standardize</span>(Q_sim) )</span></code></pre></div>
<p>Adding Q in the dag.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="ch-14-adventures-in-covariance.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb385-2"><a href="ch-14-adventures-in-covariance.html#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb385-3"><a href="ch-14-adventures-in-covariance.html#cb385-3" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">&quot;dag {</span></span>
<span id="cb385-4"><a href="ch-14-adventures-in-covariance.html#cb385-4" aria-hidden="true" tabindex="-1"></a><span class="st">  U [unobserved]</span></span>
<span id="cb385-5"><a href="ch-14-adventures-in-covariance.html#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="st">  E [exposure]</span></span>
<span id="cb385-6"><a href="ch-14-adventures-in-covariance.html#cb385-6" aria-hidden="true" tabindex="-1"></a><span class="st">  W [outcome]</span></span>
<span id="cb385-7"><a href="ch-14-adventures-in-covariance.html#cb385-7" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; E</span></span>
<span id="cb385-8"><a href="ch-14-adventures-in-covariance.html#cb385-8" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; W</span></span>
<span id="cb385-9"><a href="ch-14-adventures-in-covariance.html#cb385-9" aria-hidden="true" tabindex="-1"></a><span class="st">  E -&gt; W</span></span>
<span id="cb385-10"><a href="ch-14-adventures-in-covariance.html#cb385-10" aria-hidden="true" tabindex="-1"></a><span class="st">  Q -&gt; E</span></span>
<span id="cb385-11"><a href="ch-14-adventures-in-covariance.html#cb385-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb385-12"><a href="ch-14-adventures-in-covariance.html#cb385-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb385-13"><a href="ch-14-adventures-in-covariance.html#cb385-13" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>(dag)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-195-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We see that Q and U are completely unrelated to other variables. E is based on U and Q and and W is based on U.</p>
<p>The following presents three types of models, two wrong (misuses) and one good solution:</p>
<div id="only-including-e-we-add-confounding-effect-sideeffect-of-e" class="section level4" number="15.1.1.1">
<h4><span class="header-section-number">15.1.1.1</span> 1. Only including E (we add confounding effect sideeffect of E)</h4>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="ch-14-adventures-in-covariance.html#cb386-1" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb386-2"><a href="ch-14-adventures-in-covariance.html#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">alist</span>(</span>
<span id="cb386-3"><a href="ch-14-adventures-in-covariance.html#cb386-3" aria-hidden="true" tabindex="-1"></a>  W <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb386-4"><a href="ch-14-adventures-in-covariance.html#cb386-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> aW <span class="sc">+</span> bEW<span class="sc">*</span>E, <span class="co">#By adding E also U is leaking unwanted information</span></span>
<span id="cb386-5"><a href="ch-14-adventures-in-covariance.html#cb386-5" aria-hidden="true" tabindex="-1"></a>  aW <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.2</span> ),</span>
<span id="cb386-6"><a href="ch-14-adventures-in-covariance.html#cb386-6" aria-hidden="true" tabindex="-1"></a>  bEW <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb386-7"><a href="ch-14-adventures-in-covariance.html#cb386-7" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb386-8"><a href="ch-14-adventures-in-covariance.html#cb386-8" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>dat_sim , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="ch-14-adventures-in-covariance.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m14<span class="fl">.4</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0012022</td>
</tr>
<tr class="even">
<td align="right">0.3972923</td>
</tr>
<tr class="odd">
<td align="right">0.9188476</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0403765</td>
</tr>
<tr class="even">
<td align="right">0.0397395</td>
</tr>
<tr class="odd">
<td align="right">0.0311698</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.0634736</td>
</tr>
<tr class="even">
<td align="right">0.3354129</td>
</tr>
<tr class="odd">
<td align="right">0.8699631</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0660798</td>
</tr>
<tr class="even">
<td align="right">0.4583310</td>
</tr>
<tr class="odd">
<td align="right">0.9709725</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1706.487</td>
</tr>
<tr class="even">
<td align="right">1786.064</td>
</tr>
<tr class="odd">
<td align="right">1846.831</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0029059</td>
</tr>
<tr class="even">
<td align="right">1.0015440</td>
</tr>
<tr class="odd">
<td align="right">0.9990899</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that U is ruining the inference. Thus we might report that Education is increasing wages. Although it is in fact wrong. In this simulation we set the effect of E on W to be around 0.</p>
</div>
<div id="adding-instrument-q-the-wrong-way" class="section level4" number="15.1.1.2">
<h4><span class="header-section-number">15.1.1.2</span> 2. Adding instrument Q (the wrong way)</h4>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="ch-14-adventures-in-covariance.html#cb388-1" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb388-2"><a href="ch-14-adventures-in-covariance.html#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">alist</span>(</span>
<span id="cb388-3"><a href="ch-14-adventures-in-covariance.html#cb388-3" aria-hidden="true" tabindex="-1"></a>  W <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb388-4"><a href="ch-14-adventures-in-covariance.html#cb388-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> aW <span class="sc">+</span> bEW<span class="sc">*</span>E <span class="sc">+</span> bQW<span class="sc">*</span>Q, <span class="co">#Add the effect of Q</span></span>
<span id="cb388-5"><a href="ch-14-adventures-in-covariance.html#cb388-5" aria-hidden="true" tabindex="-1"></a>  aW <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.2</span> ),</span>
<span id="cb388-6"><a href="ch-14-adventures-in-covariance.html#cb388-6" aria-hidden="true" tabindex="-1"></a>  bEW <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb388-7"><a href="ch-14-adventures-in-covariance.html#cb388-7" aria-hidden="true" tabindex="-1"></a>  bQW <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb388-8"><a href="ch-14-adventures-in-covariance.html#cb388-8" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb388-9"><a href="ch-14-adventures-in-covariance.html#cb388-9" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>dat_sim , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="ch-14-adventures-in-covariance.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( m14<span class="fl">.5</span> )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.0007338</td>
</tr>
<tr class="even">
<td align="right">0.6352751</td>
</tr>
<tr class="odd">
<td align="right">-0.4040064</td>
</tr>
<tr class="even">
<td align="right">0.8574049</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0390265</td>
</tr>
<tr class="even">
<td align="right">0.0462069</td>
</tr>
<tr class="odd">
<td align="right">0.0466945</td>
</tr>
<tr class="even">
<td align="right">0.0262698</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.0627500</td>
</tr>
<tr class="even">
<td align="right">0.5607676</td>
</tr>
<tr class="odd">
<td align="right">-0.4800965</td>
</tr>
<tr class="even">
<td align="right">0.8164784</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0621576</td>
</tr>
<tr class="even">
<td align="right">0.7100575</td>
</tr>
<tr class="odd">
<td align="right">-0.3304081</td>
</tr>
<tr class="even">
<td align="right">0.9012749</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2060.013</td>
</tr>
<tr class="even">
<td align="right">1426.895</td>
</tr>
<tr class="odd">
<td align="right">1153.751</td>
</tr>
<tr class="even">
<td align="right">2309.213</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0001492</td>
</tr>
<tr class="even">
<td align="right">1.0026464</td>
</tr>
<tr class="odd">
<td align="right">1.0034973</td>
</tr>
<tr class="even">
<td align="right">0.9992567</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that by simply adding the effect of Q, we are <strong>still having a back door</strong> and this makes the effect of E on W look even higher, THAT IS WRONG!</p>
</div>
<div id="correct-use-of-the-instrument-variable" class="section level4" number="15.1.1.3">
<h4><span class="header-section-number">15.1.1.3</span> 3. Correct use of the instrument variable</h4>
<p>The answer is to go multi level (create a generative model). This implies writing 4 functions (4 sub models)</p>
<p><span class="math display">\[
\text{1. How wages are caused by education and U} \\
W_i \sim Normal(\mu_{w,i},\sigma_w) \\
\mu_{w,i} = \alpha_w + \beta_{EW}E_i + U_i \\
\text{2. How education levels are caused by quarter of birth Q} \\
E_i \sim Normal(\mu_{E,i},\sigma_E) \\
\mu_{E,i} = \alpha_E + \beta_{QE}Q_i+U_i \\
\text{3. The mode for Q (unif. dist.)} \\
Q_I \sim Categorical([0.25,0.25,0.25,0.25]) \\
\text{4. Specifying distribution for Q} \\
U_i \sim Normal(0,1)
\]</span></p>
<p>Notice that U could have had another distribution.</p>
<p>Now we can define this as a statistical model, defining the joint distribution of wage and education. This basically means that each W and E get their own linear models (y = a + bx) as we have two mean values.</p>
<p><span class="math display">\[
\begin{pmatrix}
W_i \\ E_i
\end{pmatrix}
\sim  MVNormal(
\begin{pmatrix}
\mu_{w,i} \\
\mu_{E,i}
\end{pmatrix}
, S
) \\
\mu_{w,i} = \alpha_W + \beta_{EW}E_i \\
\mu_{E,i} = \alpha_E + \beta_{QE}Q_i
\]</span></p>
<p>Notice that we have:</p>
<ol style="list-style-type: decimal">
<li>A linear model with education consists of some intercept and a slope for the education</li>
<li>A linear model for the quarter of birth (instrument variable)</li>
</ol>
<p>Thus we estimate two linear models and we deal with the confound by doing the MVNormal, where S (the correlation parameter) gives information about how strong the confound is. Thus we just care about the correlation matrix so we can adjust the effect of E according to the effect of Q</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="ch-14-adventures-in-covariance.html#cb391-1" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.6</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb391-2"><a href="ch-14-adventures-in-covariance.html#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="fu">alist</span>(</span>
<span id="cb391-3"><a href="ch-14-adventures-in-covariance.html#cb391-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(W,E) <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(muW,muE) , Rho , Sigma ),</span>
<span id="cb391-4"><a href="ch-14-adventures-in-covariance.html#cb391-4" aria-hidden="true" tabindex="-1"></a>  muW <span class="ot">&lt;-</span> aW <span class="sc">+</span> bEW<span class="sc">*</span>E, <span class="co">#Mean wage</span></span>
<span id="cb391-5"><a href="ch-14-adventures-in-covariance.html#cb391-5" aria-hidden="true" tabindex="-1"></a>  muE <span class="ot">&lt;-</span> aE <span class="sc">+</span> bQE<span class="sc">*</span>Q, <span class="co">#Mean education</span></span>
<span id="cb391-6"><a href="ch-14-adventures-in-covariance.html#cb391-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(aW,aE) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.2</span> ), <span class="co">#</span></span>
<span id="cb391-7"><a href="ch-14-adventures-in-covariance.html#cb391-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(bEW,bQE) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb391-8"><a href="ch-14-adventures-in-covariance.html#cb391-8" aria-hidden="true" tabindex="-1"></a>  Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>( <span class="dv">2</span> ),</span>
<span id="cb391-9"><a href="ch-14-adventures-in-covariance.html#cb391-9" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb391-10"><a href="ch-14-adventures-in-covariance.html#cb391-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat_sim , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="ch-14-adventures-in-covariance.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( m14<span class="fl">.6</span> , <span class="at">depth=</span><span class="dv">3</span> )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0005356</td>
</tr>
<tr class="even">
<td align="right">0.0000560</td>
</tr>
<tr class="odd">
<td align="right">0.5908850</td>
</tr>
<tr class="even">
<td align="right">-0.0446290</td>
</tr>
<tr class="odd">
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.5390221</td>
</tr>
<tr class="odd">
<td align="right">0.5390221</td>
</tr>
<tr class="even">
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1.0215317</td>
</tr>
<tr class="even">
<td align="right">0.8079289</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0362346</td>
</tr>
<tr class="even">
<td align="right">0.0457417</td>
</tr>
<tr class="odd">
<td align="right">0.0352491</td>
</tr>
<tr class="even">
<td align="right">0.0755883</td>
</tr>
<tr class="odd">
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">0.0523193</td>
</tr>
<tr class="odd">
<td align="right">0.0523193</td>
</tr>
<tr class="even">
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.0453258</td>
</tr>
<tr class="even">
<td align="right">0.0257300</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.0572324</td>
</tr>
<tr class="even">
<td align="right">-0.0741125</td>
</tr>
<tr class="odd">
<td align="right">0.5347942</td>
</tr>
<tr class="even">
<td align="right">-0.1647677</td>
</tr>
<tr class="odd">
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.4517490</td>
</tr>
<tr class="odd">
<td align="right">0.4517490</td>
</tr>
<tr class="even">
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">0.9517784</td>
</tr>
<tr class="even">
<td align="right">0.7686491</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0585893</td>
</tr>
<tr class="even">
<td align="right">0.0724464</td>
</tr>
<tr class="odd">
<td align="right">0.6475532</td>
</tr>
<tr class="even">
<td align="right">0.0786892</td>
</tr>
<tr class="odd">
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="right">0.6207480</td>
</tr>
<tr class="odd">
<td align="right">0.6207480</td>
</tr>
<tr class="even">
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="right">1.0952362</td>
</tr>
<tr class="even">
<td align="right">0.8513578</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1544.451</td>
</tr>
<tr class="even">
<td align="right">1512.802</td>
</tr>
<tr class="odd">
<td align="right">1334.902</td>
</tr>
<tr class="even">
<td align="right">1105.227</td>
</tr>
<tr class="odd">
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">1010.346</td>
</tr>
<tr class="odd">
<td align="right">1010.346</td>
</tr>
<tr class="even">
<td align="right">1311.056</td>
</tr>
<tr class="odd">
<td align="right">1143.368</td>
</tr>
<tr class="even">
<td align="right">1625.887</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0021929</td>
</tr>
<tr class="even">
<td align="right">0.9987730</td>
</tr>
<tr class="odd">
<td align="right">1.0005552</td>
</tr>
<tr class="even">
<td align="right">0.9990276</td>
</tr>
<tr class="odd">
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="right">0.9995543</td>
</tr>
<tr class="odd">
<td align="right">0.9995543</td>
</tr>
<tr class="even">
<td align="right">0.9979980</td>
</tr>
<tr class="odd">
<td align="right">0.9999386</td>
</tr>
<tr class="even">
<td align="right">1.0003926</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see that the slope for E is 0 (and the compatibility intercals on both sides of 0), while the interaction between E and Q has all the effect. Thus we have got rid of the confounding variable (unknown U). Now there are also a bunch of other parameters, but the slopes for E and QE are the most important.</p>
<p><strong><em>Key takeaway: in general it is not possibile to statistically prove if a variable is a good instrument. This is where domain knowledge is relevant!!</em></strong></p>
<blockquote>
<p>Notice that it is almost impossible to know the ground truth. Thus emphasizing that we must construct a meaningful DAG, in which we must reason for and believe in!!</p>
</blockquote>
</div>
</div>
<div id="other-designs" class="section level3" number="15.1.2">
<h3><span class="header-section-number">15.1.2</span> Other designs</h3>
<div id="front-door-criterion" class="section level4" number="15.1.2.1">
<h4><span class="header-section-number">15.1.2.1</span> Front-Door Criterion</h4>
<p>Lets suppose we have a scenario where we want to measure X effect on Y, although we have an unknown U, that is a confounding effect, as it affects both X and Y, hence exposure and outcome.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="ch-14-adventures-in-covariance.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb394-2"><a href="ch-14-adventures-in-covariance.html#cb394-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb394-3"><a href="ch-14-adventures-in-covariance.html#cb394-3" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>( <span class="st">&quot;dag {</span></span>
<span id="cb394-4"><a href="ch-14-adventures-in-covariance.html#cb394-4" aria-hidden="true" tabindex="-1"></a><span class="st">  U [unobserved]</span></span>
<span id="cb394-5"><a href="ch-14-adventures-in-covariance.html#cb394-5" aria-hidden="true" tabindex="-1"></a><span class="st">  X [exposure]</span></span>
<span id="cb394-6"><a href="ch-14-adventures-in-covariance.html#cb394-6" aria-hidden="true" tabindex="-1"></a><span class="st">  Y [outcome]</span></span>
<span id="cb394-7"><a href="ch-14-adventures-in-covariance.html#cb394-7" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; X</span></span>
<span id="cb394-8"><a href="ch-14-adventures-in-covariance.html#cb394-8" aria-hidden="true" tabindex="-1"></a><span class="st">  U -&gt; Y</span></span>
<span id="cb394-9"><a href="ch-14-adventures-in-covariance.html#cb394-9" aria-hidden="true" tabindex="-1"></a><span class="st">  X -&gt; Z</span></span>
<span id="cb394-10"><a href="ch-14-adventures-in-covariance.html#cb394-10" aria-hidden="true" tabindex="-1"></a><span class="st">  Z -&gt; Y</span></span>
<span id="cb394-11"><a href="ch-14-adventures-in-covariance.html#cb394-11" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span></span>
<span id="cb394-12"><a href="ch-14-adventures-in-covariance.html#cb394-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="Images/paste-A1694973.png" /></p>
<p>Another way to solve this is find a <code>Front-door</code> criterion, Z in this example, which is independent of U, as when only Z is introduced the effect of U is not included in the model. WHY? Recall that we have a pipe from X to Y and when we condition on Z we close the relationship between X and Y and thus also U.</p>
</div>
<div id="regression-discontinuity-rdd" class="section level4" number="15.1.2.2">
<h4><span class="header-section-number">15.1.2.2</span> Regression discontinuity (RDD)</h4>
<p>The example of regressing academic reward on future success, where many unobserved variables occur. See the example on page 461.</p>
</div>
</div>
</div>
<div id="gaussian-processes-continuous-categories-and-the-gaussian-process" class="section level2" number="15.2">
<h2><span class="header-section-number">15.2</span> (Gaussian Processes) Continuous categories and the Gaussian process</h2>
<p>This section is about including continuous variables, as <strong>up until now we have only been working with unordered categorical variables</strong>. Thus this also allows for continuous varying effects.</p>
<p>This is used to measure similarity bbased on a continuous scale, where we up until now only have looked at similarity in unordered categories such as tadpoles.</p>
<div id="example-spatial-autocorrelation-in-oceanic-tools" class="section level3" number="15.2.1">
<h3><span class="header-section-number">15.2.1</span> Example: Spatial autocorrelation in Oceanic tools</h3>
<p>This example use the tool counts for a set of islands and also includes latitude and longitude data to regress population and tool counts with respect to their geological position.</p>
<div id="loading-data-defining-model" class="section level4" number="15.2.1.1">
<h4><span class="header-section-number">15.2.1.1</span> Loading data + defining model</h4>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="ch-14-adventures-in-covariance.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the distance matrix</span></span>
<span id="cb395-2"><a href="ch-14-adventures-in-covariance.html#cb395-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb395-3"><a href="ch-14-adventures-in-covariance.html#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(islandsDistMatrix)</span>
<span id="cb395-4"><a href="ch-14-adventures-in-covariance.html#cb395-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display (measured in thousands of km)</span></span>
<span id="cb395-5"><a href="ch-14-adventures-in-covariance.html#cb395-5" aria-hidden="true" tabindex="-1"></a>Dmat <span class="ot">&lt;-</span> islandsDistMatrix</span>
<span id="cb395-6"><a href="ch-14-adventures-in-covariance.html#cb395-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Dmat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>,<span class="st">&quot;Ti&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;Ya&quot;</span>,<span class="st">&quot;Fi&quot;</span>,<span class="st">&quot;Tr&quot;</span>,<span class="st">&quot;Ch&quot;</span>,<span class="st">&quot;Mn&quot;</span>,<span class="st">&quot;To&quot;</span>,<span class="st">&quot;Ha&quot;</span>)</span>
<span id="cb395-7"><a href="ch-14-adventures-in-covariance.html#cb395-7" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Dmat,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##             Ml  Ti  SC  Ya  Fi  Tr  Ch  Mn  To  Ha
## Malekula   0.0 0.5 0.6 4.4 1.2 2.0 3.2 2.8 1.9 5.7
## Tikopia    0.5 0.0 0.3 4.2 1.2 2.0 2.9 2.7 2.0 5.3
## Santa Cruz 0.6 0.3 0.0 3.9 1.6 1.7 2.6 2.4 2.3 5.4
## Yap        4.4 4.2 3.9 0.0 5.4 2.5 1.6 1.6 6.1 7.2
## Lau Fiji   1.2 1.2 1.6 5.4 0.0 3.2 4.0 3.9 0.8 4.9
## Trobriand  2.0 2.0 1.7 2.5 3.2 0.0 1.8 0.8 3.9 6.7
## Chuuk      3.2 2.9 2.6 1.6 4.0 1.8 0.0 1.2 4.8 5.8
## Manus      2.8 2.7 2.4 1.6 3.9 0.8 1.2 0.0 4.6 6.7
## Tonga      1.9 2.0 2.3 6.1 0.8 3.9 4.8 4.6 0.0 5.0
## Hawaii     5.7 5.3 5.4 7.2 4.9 6.7 5.8 6.7 5.0 0.0</code></pre>
<p>We have a distance matrix and we see the flight distance between each island.</p>
<p>Notice that we want to use distance as a similarity in technology exposure.</p>
<p>We can define the model for number of tools with:</p>
<p><span class="math display">\[
T_I \sim Poisson(\lambda_i)\\
\lambda_i = \alpha P_i^\beta/\gamma
\]</span></p>
<p>Now we can adjust lambda with a varying intercept for each society. We also want the value to always be positive, hence we add exponential for each society. We add the index for each society, this will yield a multiple intercept model.</p>
<p><em>Thus the modified formula:</em></p>
<p><span class="math display">\[
T_I \sim Poisson(\lambda_i)\\
\lambda_i = exp(k_{societry[i]})\alpha P_i^\beta/\gamma
\]</span></p>
<p><em>Recall that exp(0) = 1</em></p>
<p>Thus we multply the original contents with the exponential category k. Thus we see that <span class="math inline">\(k_{societry[i]\)</span> is the varting intercept.</p>
<p>We need to define a prior for the varying intercepts, that is done by:</p>
<p><span class="math display">\[
\text{Prior for the varying intercepts:} \\
\begin{pmatrix}
k_1 \\ k_2 \\ k_3 \\ ... \\ k_10
\end{pmatrix}
\sim MVNormal
\begin{pmatrix}
\begin{pmatrix}
0 \\ 0 \\ 0 \\ ... \\ 0
\end{pmatrix}
,K
\end{pmatrix} \\
\text{Covariance matrix K:} \\
K_{ij} = \eta^2 exp(-\rho^2D^2_{ij})+\delta_{ij}\sigma^2
\]</span></p>
<p>We see that:</p>
<p>First expression is a 10-dimensional gaussian prior for the intercepts. There are 10 societies and thus one intercept for each society.</p>
<p>Notice that <span class="math inline">\(K_{ij}\)</span> is a matrix, as we have two variables. Thus the <span class="math inline">\(K_{ij}\)</span> is able to identify a correlation between two variables (islands). Ultimately it creates a matrix including numbers for the equation <span class="math inline">\(K_{ij}\)</span>, elaborated a bit in the following.</p>
<p>the K parameter is defined by three parameters - eta, rho and sigma. And the purpose of K is to set the covariance between societies as the distances between them change. The K parameter can be separated into three parts:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(exp(-\rho^2D^2_{ij})\)</span> Shape of K.</li>
<li><span class="math inline">\(D^2_{ij}\)</span> - It is the squared distance between i and j.</li>
<li><span class="math inline">\(\eta^2\)</span> - The maximum covariance between any two societies i and j.</li>
<li><span class="math inline">\(\delta_{ij}\sigma^2\)</span> - The additional variance, this can be turned on and off. where sigma squared is simply just the variance where delta is able to turn it on and off. (for some reason this we do not have to care too much abbout)</li>
</ol>
<hr />
<p><strong><em>More on the first part:</em></strong></p>
<p><strong>Shape of K</strong></p>
<ul>
<li>The shape of K is <span class="math inline">\(exp(-\rho^2D^2_{ij})\)</span>, where <span class="math inline">\(D^2_{ij}\)</span> is the distance between the i’th and j’th object (between two societies). We simply see that the larger the distance the lower is the correlation among the two islands. Two toy examples where rho is fixed:</li>
</ul>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="ch-14-adventures-in-covariance.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb397-2"><a href="ch-14-adventures-in-covariance.html#cb397-2" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb397-3"><a href="ch-14-adventures-in-covariance.html#cb397-3" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="dv">10</span> <span class="co">#D = distance</span></span>
<span id="cb397-4"><a href="ch-14-adventures-in-covariance.html#cb397-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>D<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.3678794</code></pre>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="ch-14-adventures-in-covariance.html#cb399-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb399-2"><a href="ch-14-adventures-in-covariance.html#cb399-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="dv">1</span> <span class="co">#two islands 10 times closer than the previous example</span></span>
<span id="cb399-3"><a href="ch-14-adventures-in-covariance.html#cb399-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>D<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.9900498</code></pre>
<p>We simply see that the closer the islands the larger the expected similarity.</p>
<p><strong>Parameter</strong> <span class="math inline">\(\rho\)</span>: The rate of decline. When it is large, the covariance declines rapidly with squared distance.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="ch-14-adventures-in-covariance.html#cb401-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb401-2"><a href="ch-14-adventures-in-covariance.html#cb401-2" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="dv">1</span> <span class="co">#two islands 10 times closer than the previous example</span></span>
<span id="cb401-3"><a href="ch-14-adventures-in-covariance.html#cb401-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>D<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb401-4"><a href="ch-14-adventures-in-covariance.html#cb401-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-5"><a href="ch-14-adventures-in-covariance.html#cb401-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb401-6"><a href="ch-14-adventures-in-covariance.html#cb401-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">=</span> <span class="dv">1</span> <span class="co">#two islands 10 times closer than the previous example</span></span>
<span id="cb401-7"><a href="ch-14-adventures-in-covariance.html#cb401-7" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>rho<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>D<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.9900498
## [1] 0.3678794</code></pre>
<p>Now we see that the smaller rho (declining similarity) that larger is the similarity given that distance is fixed.</p>
<p><strong>Why square the distance???:</strong> you don’t have to, they just do that.</p>
<p>We can plot two examples where one is squared and one is just the distance:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="ch-14-adventures-in-covariance.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># linear</span></span>
<span id="cb403-2"><a href="ch-14-adventures-in-covariance.html#cb403-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>( <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>x) , <span class="at">from=</span><span class="dv">0</span> , <span class="at">to=</span><span class="dv">4</span> , <span class="at">lty=</span><span class="dv">2</span> ,</span>
<span id="cb403-3"><a href="ch-14-adventures-in-covariance.html#cb403-3" aria-hidden="true" tabindex="-1"></a><span class="at">xlab=</span><span class="st">&quot;distance&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;correlation&quot;</span> )</span>
<span id="cb403-4"><a href="ch-14-adventures-in-covariance.html#cb403-4" aria-hidden="true" tabindex="-1"></a><span class="co"># squared</span></span>
<span id="cb403-5"><a href="ch-14-adventures-in-covariance.html#cb403-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>( <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>) , <span class="at">add=</span><span class="cn">TRUE</span> )</span>
<span id="cb403-6"><a href="ch-14-adventures-in-covariance.html#cb403-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="st">&quot;Solid = squared distances, striped = linear distances.&quot;</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-203-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we see that correlation decrease as distance increase between islands. Thus naturally we see that the islands correlation is 1 to itself and then declines from there.</p>
<p>Notice that this i kind of a half normal distribution.</p>
<p>Notice that the linear has some kind of linear decrease, where the squared example takes a while before decreasing, hence we do account for close islands to be collaborating, while the linear model will say that you quickly or almost immediately is different even from neighboring islands!</p>
<hr />
</div>
<div id="the-full-model" class="section level4" number="15.2.1.2">
<h4><span class="header-section-number">15.2.1.2</span> The full model</h4>
<p><span class="math display">\[
T_i \sim Poisson(\lambda_i) \\
\lambda_i = exp(k_{societry[i]})\alpha P_i^\beta/\gamma \\
k \sim MVNormal(0,...,0),K) \\
K_{ij} = \eta^2 exp(-\rho^2D^2_{ij})+\delta_{ij}\sigma^2\\
\text{The priors:} \\
\alpha \sim Exponential(1) \\
\beta \sim Exponential(1) \\
\eta^2 \sim Exponential(2) \\
\rho^2 \sim Exponential(0.5)
\]</span></p>
<p>Eta and rho must be positive for this example, hence we use the exponential distribution.</p>
<ul>
<li><p>k is a matrix based on the multivariate normal distribution, where,</p></li>
<li><p>Each K element is defined by a certain distribution.</p></li>
<li><p>Eta and rho squared does not have to be squared, but they are</p></li>
</ul>
<p><em>Notice that the code includes GPL2, that is simply Gaussian Process Prior for squared distance</em></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="ch-14-adventures-in-covariance.html#cb404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline2) <span class="co"># load the ordinary data, now with coordinates</span></span>
<span id="cb404-2"><a href="ch-14-adventures-in-covariance.html#cb404-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Kline2</span>
<span id="cb404-3"><a href="ch-14-adventures-in-covariance.html#cb404-3" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>society <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="co"># index observations</span></span>
<span id="cb404-4"><a href="ch-14-adventures-in-covariance.html#cb404-4" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb404-5"><a href="ch-14-adventures-in-covariance.html#cb404-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> d<span class="sc">$</span>total_tools,</span>
<span id="cb404-6"><a href="ch-14-adventures-in-covariance.html#cb404-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">P =</span> d<span class="sc">$</span>population,</span>
<span id="cb404-7"><a href="ch-14-adventures-in-covariance.html#cb404-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">society =</span> d<span class="sc">$</span>society,</span>
<span id="cb404-8"><a href="ch-14-adventures-in-covariance.html#cb404-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat=</span>islandsDistMatrix )</span>
<span id="cb404-9"><a href="ch-14-adventures-in-covariance.html#cb404-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-10"><a href="ch-14-adventures-in-covariance.html#cb404-10" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb404-11"><a href="ch-14-adventures-in-covariance.html#cb404-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb404-12"><a href="ch-14-adventures-in-covariance.html#cb404-12" aria-hidden="true" tabindex="-1"></a>  T <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb404-13"><a href="ch-14-adventures-in-covariance.html#cb404-13" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> (a<span class="sc">*</span>P<span class="sc">^</span>b<span class="sc">/</span>g)<span class="sc">*</span><span class="fu">exp</span>(k[society]),</span>
<span id="cb404-14"><a href="ch-14-adventures-in-covariance.html#cb404-14" aria-hidden="true" tabindex="-1"></a>  vector[<span class="dv">10</span>]<span class="sc">:</span>k <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="dv">0</span> , SIGMA ),</span>
<span id="cb404-15"><a href="ch-14-adventures-in-covariance.html#cb404-15" aria-hidden="true" tabindex="-1"></a>  matrix[<span class="dv">10</span>,<span class="dv">10</span>]<span class="sc">:</span>SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL2</span>( Dmat , etasq , rhosq , <span class="fl">0.01</span> ),</span>
<span id="cb404-16"><a href="ch-14-adventures-in-covariance.html#cb404-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(a,b,g) <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb404-17"><a href="ch-14-adventures-in-covariance.html#cb404-17" aria-hidden="true" tabindex="-1"></a>  etasq <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">2</span> ), <span class="co">#for eta squared</span></span>
<span id="cb404-18"><a href="ch-14-adventures-in-covariance.html#cb404-18" aria-hidden="true" tabindex="-1"></a>  rhosq <span class="sc">~</span> <span class="fu">dexp</span>( <span class="fl">0.5</span> ) <span class="co">#for rho squared</span></span>
<span id="cb404-19"><a href="ch-14-adventures-in-covariance.html#cb404-19" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> , <span class="at">iter=</span><span class="dv">2000</span> )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="ch-14-adventures-in-covariance.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m14<span class="fl">.8</span>,<span class="at">depth =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.1597404</td>
</tr>
<tr class="even">
<td align="right">-0.0081989</td>
</tr>
<tr class="odd">
<td align="right">-0.0574348</td>
</tr>
<tr class="even">
<td align="right">0.3693217</td>
</tr>
<tr class="odd">
<td align="right">0.0910797</td>
</tr>
<tr class="even">
<td align="right">-0.3768972</td>
</tr>
<tr class="odd">
<td align="right">0.1590307</td>
</tr>
<tr class="even">
<td align="right">-0.2009949</td>
</tr>
<tr class="odd">
<td align="right">0.2821525</td>
</tr>
<tr class="even">
<td align="right">-0.1460112</td>
</tr>
<tr class="odd">
<td align="right">0.6033752</td>
</tr>
<tr class="even">
<td align="right">0.2759142</td>
</tr>
<tr class="odd">
<td align="right">1.4188937</td>
</tr>
<tr class="even">
<td align="right">0.1828687</td>
</tr>
<tr class="odd">
<td align="right">1.3984071</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.2896103</td>
</tr>
<tr class="even">
<td align="right">0.2793731</td>
</tr>
<tr class="odd">
<td align="right">0.2680856</td>
</tr>
<tr class="even">
<td align="right">0.2504507</td>
</tr>
<tr class="odd">
<td align="right">0.2481793</td>
</tr>
<tr class="even">
<td align="right">0.2558091</td>
</tr>
<tr class="odd">
<td align="right">0.2422138</td>
</tr>
<tr class="even">
<td align="right">0.2486070</td>
</tr>
<tr class="odd">
<td align="right">0.2340778</td>
</tr>
<tr class="even">
<td align="right">0.3296204</td>
</tr>
<tr class="odd">
<td align="right">0.5987057</td>
</tr>
<tr class="even">
<td align="right">0.0824483</td>
</tr>
<tr class="odd">
<td align="right">1.1000008</td>
</tr>
<tr class="even">
<td align="right">0.1782422</td>
</tr>
<tr class="odd">
<td align="right">1.6649221</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.6120088</td>
</tr>
<tr class="even">
<td align="right">-0.4358372</td>
</tr>
<tr class="odd">
<td align="right">-0.4739379</td>
</tr>
<tr class="even">
<td align="right">0.0022704</td>
</tr>
<tr class="odd">
<td align="right">-0.2841544</td>
</tr>
<tr class="even">
<td align="right">-0.7944999</td>
</tr>
<tr class="odd">
<td align="right">-0.2140414</td>
</tr>
<tr class="even">
<td align="right">-0.5821251</td>
</tr>
<tr class="odd">
<td align="right">-0.0611343</td>
</tr>
<tr class="even">
<td align="right">-0.6788603</td>
</tr>
<tr class="odd">
<td align="right">0.0687307</td>
</tr>
<tr class="even">
<td align="right">0.1514212</td>
</tr>
<tr class="odd">
<td align="right">0.2289676</td>
</tr>
<tr class="even">
<td align="right">0.0305899</td>
</tr>
<tr class="odd">
<td align="right">0.0932570</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.3005815</td>
</tr>
<tr class="even">
<td align="right">0.4359577</td>
</tr>
<tr class="odd">
<td align="right">0.3699686</td>
</tr>
<tr class="even">
<td align="right">0.7744077</td>
</tr>
<tr class="odd">
<td align="right">0.4903225</td>
</tr>
<tr class="even">
<td align="right">0.0050948</td>
</tr>
<tr class="odd">
<td align="right">0.5415994</td>
</tr>
<tr class="even">
<td align="right">0.1763924</td>
</tr>
<tr class="odd">
<td align="right">0.6573243</td>
</tr>
<tr class="even">
<td align="right">0.3503978</td>
</tr>
<tr class="odd">
<td align="right">1.6841055</td>
</tr>
<tr class="even">
<td align="right">0.4166303</td>
</tr>
<tr class="odd">
<td align="right">3.4330089</td>
</tr>
<tr class="even">
<td align="right">0.4992089</td>
</tr>
<tr class="odd">
<td align="right">4.6126826</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1152.765</td>
</tr>
<tr class="even">
<td align="right">1091.713</td>
</tr>
<tr class="odd">
<td align="right">1065.910</td>
</tr>
<tr class="even">
<td align="right">1172.896</td>
</tr>
<tr class="odd">
<td align="right">1104.527</td>
</tr>
<tr class="even">
<td align="right">1333.654</td>
</tr>
<tr class="odd">
<td align="right">1076.464</td>
</tr>
<tr class="even">
<td align="right">1145.790</td>
</tr>
<tr class="odd">
<td align="right">1036.562</td>
</tr>
<tr class="even">
<td align="right">1048.215</td>
</tr>
<tr class="odd">
<td align="right">1887.105</td>
</tr>
<tr class="even">
<td align="right">1392.449</td>
</tr>
<tr class="odd">
<td align="right">2124.661</td>
</tr>
<tr class="even">
<td align="right">1364.828</td>
</tr>
<tr class="odd">
<td align="right">2134.975</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.000283</td>
</tr>
<tr class="even">
<td align="right">1.001192</td>
</tr>
<tr class="odd">
<td align="right">1.000922</td>
</tr>
<tr class="even">
<td align="right">1.000571</td>
</tr>
<tr class="odd">
<td align="right">1.001655</td>
</tr>
<tr class="even">
<td align="right">1.000964</td>
</tr>
<tr class="odd">
<td align="right">1.000455</td>
</tr>
<tr class="even">
<td align="right">1.000703</td>
</tr>
<tr class="odd">
<td align="right">1.000547</td>
</tr>
<tr class="even">
<td align="right">1.002470</td>
</tr>
<tr class="odd">
<td align="right">1.000475</td>
</tr>
<tr class="even">
<td align="right">1.002043</td>
</tr>
<tr class="odd">
<td align="right">1.000081</td>
</tr>
<tr class="even">
<td align="right">1.000869</td>
</tr>
<tr class="odd">
<td align="right">1.000430</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="ch-14-adventures-in-covariance.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m14<span class="fl">.8</span>,<span class="at">depth =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.6033752</td>
</tr>
<tr class="even">
<td align="right">0.2759142</td>
</tr>
<tr class="odd">
<td align="right">1.4188937</td>
</tr>
<tr class="even">
<td align="right">0.1828687</td>
</tr>
<tr class="odd">
<td align="right">1.3984071</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.5987057</td>
</tr>
<tr class="even">
<td align="right">0.0824483</td>
</tr>
<tr class="odd">
<td align="right">1.1000008</td>
</tr>
<tr class="even">
<td align="right">0.1782422</td>
</tr>
<tr class="odd">
<td align="right">1.6649221</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0687307</td>
</tr>
<tr class="even">
<td align="right">0.1514212</td>
</tr>
<tr class="odd">
<td align="right">0.2289676</td>
</tr>
<tr class="even">
<td align="right">0.0305899</td>
</tr>
<tr class="odd">
<td align="right">0.0932570</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.6841055</td>
</tr>
<tr class="even">
<td align="right">0.4166303</td>
</tr>
<tr class="odd">
<td align="right">3.4330089</td>
</tr>
<tr class="even">
<td align="right">0.4992089</td>
</tr>
<tr class="odd">
<td align="right">4.6126826</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1887.105</td>
</tr>
<tr class="even">
<td align="right">1392.449</td>
</tr>
<tr class="odd">
<td align="right">2124.661</td>
</tr>
<tr class="even">
<td align="right">1364.828</td>
</tr>
<tr class="odd">
<td align="right">2134.975</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.000475</td>
</tr>
<tr class="even">
<td align="right">1.002043</td>
</tr>
<tr class="odd">
<td align="right">1.000081</td>
</tr>
<tr class="even">
<td align="right">1.000869</td>
</tr>
<tr class="odd">
<td align="right">1.000430</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="gaussian-process-posterior" class="section level4" number="15.2.1.3">
<h4><span class="header-section-number">15.2.1.3</span> Gaussian Process Posterior</h4>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="ch-14-adventures-in-covariance.html#cb408-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m14<span class="fl">.8</span>)</span>
<span id="cb408-2"><a href="ch-14-adventures-in-covariance.html#cb408-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the posterior median covariance function</span></span>
<span id="cb408-3"><a href="ch-14-adventures-in-covariance.html#cb408-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span> , <span class="at">xlab=</span><span class="st">&quot;distance (thousand km)&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;covariance&quot;</span> ,</span>
<span id="cb408-4"><a href="ch-14-adventures-in-covariance.html#cb408-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="at">main =</span> <span class="st">&quot;Posterior covariance function&quot;</span>)</span>
<span id="cb408-5"><a href="ch-14-adventures-in-covariance.html#cb408-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute posterior mean covariance</span></span>
<span id="cb408-6"><a href="ch-14-adventures-in-covariance.html#cb408-6" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">0</span> , <span class="at">to=</span><span class="dv">10</span> , <span class="at">length.out=</span><span class="dv">100</span> )</span>
<span id="cb408-7"><a href="ch-14-adventures-in-covariance.html#cb408-7" aria-hidden="true" tabindex="-1"></a>pmcov <span class="ot">&lt;-</span> <span class="fu">sapply</span>( x_seq , <span class="cf">function</span>(x) post<span class="sc">$</span>etasq<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>post<span class="sc">$</span>rhosq<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>) )</span>
<span id="cb408-8"><a href="ch-14-adventures-in-covariance.html#cb408-8" aria-hidden="true" tabindex="-1"></a>pmcov_mu <span class="ot">&lt;-</span> <span class="fu">apply</span>( pmcov , <span class="dv">2</span> , mean )</span>
<span id="cb408-9"><a href="ch-14-adventures-in-covariance.html#cb408-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>( x_seq , pmcov_mu , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb408-10"><a href="ch-14-adventures-in-covariance.html#cb408-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 60 functions sampled from posterior</span></span>
<span id="cb408-11"><a href="ch-14-adventures-in-covariance.html#cb408-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span> )</span>
<span id="cb408-12"><a href="ch-14-adventures-in-covariance.html#cb408-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>( post<span class="sc">$</span>etasq[i]<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>post<span class="sc">$</span>rhosq[i]<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>) , <span class="at">add=</span><span class="cn">TRUE</span> ,</span>
<span id="cb408-13"><a href="ch-14-adventures-in-covariance.html#cb408-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.3</span>) )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.41-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><em>This is a covariance prior simulation.</em></p>
<p>We see that the lower the distance the larger the covariance. That is expected as that is what we defined in the K parameter.</p>
<p>The covariances are on the log scale. <strong><em>JUST AS ANYTHING ELSE IN A POISSON GLM!!!</em></strong>.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="ch-14-adventures-in-covariance.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute posterior median covariance among societies</span></span>
<span id="cb409-2"><a href="ch-14-adventures-in-covariance.html#cb409-2" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow=</span><span class="dv">10</span>,<span class="at">ncol=</span><span class="dv">10</span>)</span>
<span id="cb409-3"><a href="ch-14-adventures-in-covariance.html#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb409-4"><a href="ch-14-adventures-in-covariance.html#cb409-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb409-5"><a href="ch-14-adventures-in-covariance.html#cb409-5" aria-hidden="true" tabindex="-1"></a>    K[i,j] <span class="ot">&lt;-</span> <span class="fu">median</span>(post<span class="sc">$</span>etasq) <span class="sc">*</span> <span class="fu">exp</span>( <span class="sc">-</span><span class="fu">median</span>(post<span class="sc">$</span>rhosq) <span class="sc">*</span> islandsDistMatrix[i,j]<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb409-6"><a href="ch-14-adventures-in-covariance.html#cb409-6" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K) <span class="ot">&lt;-</span> <span class="fu">median</span>(post<span class="sc">$</span>etasq) <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb409-7"><a href="ch-14-adventures-in-covariance.html#cb409-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-8"><a href="ch-14-adventures-in-covariance.html#cb409-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert K to a correlation matrix</span></span>
<span id="cb409-9"><a href="ch-14-adventures-in-covariance.html#cb409-9" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to correlation matrix</span></span>
<span id="cb409-10"><a href="ch-14-adventures-in-covariance.html#cb409-10" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">round</span>( <span class="fu">cov2cor</span>(K) , <span class="dv">2</span> )</span>
<span id="cb409-11"><a href="ch-14-adventures-in-covariance.html#cb409-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add row/col names for convenience</span></span>
<span id="cb409-12"><a href="ch-14-adventures-in-covariance.html#cb409-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Rho) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>,<span class="st">&quot;Ti&quot;</span>,<span class="st">&quot;SC&quot;</span>,<span class="st">&quot;Ya&quot;</span>,<span class="st">&quot;Fi&quot;</span>,<span class="st">&quot;Tr&quot;</span>,<span class="st">&quot;Ch&quot;</span>,<span class="st">&quot;Mn&quot;</span>,<span class="st">&quot;To&quot;</span>,<span class="st">&quot;Ha&quot;</span>)</span>
<span id="cb409-13"><a href="ch-14-adventures-in-covariance.html#cb409-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Rho) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(Rho)</span>
<span id="cb409-14"><a href="ch-14-adventures-in-covariance.html#cb409-14" aria-hidden="true" tabindex="-1"></a>Rho</span></code></pre></div>
<pre><code>##      Ml   Ti   SC   Ya   Fi   Tr   Ch   Mn   To Ha
## Ml 1.00 0.77 0.67 0.00 0.27 0.03 0.00 0.00 0.06  0
## Ti 0.77 1.00 0.86 0.00 0.27 0.04 0.00 0.00 0.04  0
## SC 0.67 0.86 1.00 0.00 0.13 0.09 0.00 0.01 0.01  0
## Ya 0.00 0.00 0.00 1.00 0.00 0.01 0.13 0.11 0.00  0
## Fi 0.27 0.27 0.13 0.00 1.00 0.00 0.00 0.00 0.58  0
## Tr 0.03 0.04 0.09 0.01 0.00 1.00 0.07 0.52 0.00  0
## Ch 0.00 0.00 0.00 0.13 0.00 0.07 1.00 0.28 0.00  0
## Mn 0.00 0.00 0.01 0.11 0.00 0.52 0.28 1.00 0.00  0
## To 0.06 0.04 0.01 0.00 0.58 0.00 0.00 0.00 1.00  0
## Ha 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00  1</code></pre>
<ul>
<li><p>Malekula (Ml), Tikopia (Ti), and Santa Cruz (SC)—are highly correlated, all above 0.8 with one another.</p>
<ul>
<li>We see that these islands are close and have similar tool totals.</li>
</ul></li>
<li><p>Correlations with Hawaii is 0 with all islands.</p></li>
<li><p>All other societies have some relationship to the other societies in some way.</p></li>
</ul>
<p>This can be plotted:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="ch-14-adventures-in-covariance.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scale point size to logpop</span></span>
<span id="cb411-2"><a href="ch-14-adventures-in-covariance.html#cb411-2" aria-hidden="true" tabindex="-1"></a>psize <span class="ot">&lt;-</span> d<span class="sc">$</span>logpop <span class="sc">/</span> <span class="fu">max</span>(d<span class="sc">$</span>logpop)</span>
<span id="cb411-3"><a href="ch-14-adventures-in-covariance.html#cb411-3" aria-hidden="true" tabindex="-1"></a>psize <span class="ot">&lt;-</span> <span class="fu">exp</span>(psize<span class="sc">*</span><span class="fl">1.5</span>)<span class="sc">-</span><span class="dv">2</span></span>
<span id="cb411-4"><a href="ch-14-adventures-in-covariance.html#cb411-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raw data and labels</span></span>
<span id="cb411-5"><a href="ch-14-adventures-in-covariance.html#cb411-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>lon2 , d<span class="sc">$</span>lat , <span class="at">xlab=</span><span class="st">&quot;longitude&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;latitude&quot;</span> ,</span>
<span id="cb411-6"><a href="ch-14-adventures-in-covariance.html#cb411-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span>rangi2 , <span class="at">cex=</span>psize , <span class="at">pch=</span><span class="dv">16</span> , <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>,<span class="dv">30</span>) )</span>
<span id="cb411-7"><a href="ch-14-adventures-in-covariance.html#cb411-7" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">as.character</span>(d<span class="sc">$</span>culture)</span>
<span id="cb411-8"><a href="ch-14-adventures-in-covariance.html#cb411-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( d<span class="sc">$</span>lon2 , d<span class="sc">$</span>lat , <span class="at">labels=</span>labels , <span class="at">cex=</span><span class="fl">0.7</span> , <span class="at">pos=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>) )</span>
<span id="cb411-9"><a href="ch-14-adventures-in-covariance.html#cb411-9" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay lines shaded by Rho</span></span>
<span id="cb411-10"><a href="ch-14-adventures-in-covariance.html#cb411-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb411-11"><a href="ch-14-adventures-in-covariance.html#cb411-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb411-12"><a href="ch-14-adventures-in-covariance.html#cb411-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ( i <span class="sc">&lt;</span> j )</span>
<span id="cb411-13"><a href="ch-14-adventures-in-covariance.html#cb411-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>( <span class="fu">c</span>( d<span class="sc">$</span>lon2[i],d<span class="sc">$</span>lon2[j] ) , <span class="fu">c</span>( d<span class="sc">$</span>lat[i],d<span class="sc">$</span>lat[j] ) ,</span>
<span id="cb411-14"><a href="ch-14-adventures-in-covariance.html#cb411-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd=</span><span class="dv">2</span> , <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,Rho[i,j]<span class="sc">^</span><span class="dv">2</span>) )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.44-1.png" width="720" style="display: block; margin: auto;" /></p>
<ul>
<li>We see that the triad that had high correlations are closely arranged together.</li>
<li>Darker lines = greater correlation</li>
<li>No line = no correlation</li>
</ul>
<p>Now we can plot the islands with respect to the log population and the total no. of tools, while encoding as the population size. We are also suppesed to plot the median difference and the 80% percentage intervals.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="ch-14-adventures-in-covariance.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute posterior median relationship, ignoring distance</span></span>
<span id="cb412-2"><a href="ch-14-adventures-in-covariance.html#cb412-2" aria-hidden="true" tabindex="-1"></a>logpop.seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">6</span> , <span class="at">to=</span><span class="dv">14</span> , <span class="at">length.out=</span><span class="dv">30</span> )</span>
<span id="cb412-3"><a href="ch-14-adventures-in-covariance.html#cb412-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-4"><a href="ch-14-adventures-in-covariance.html#cb412-4" aria-hidden="true" tabindex="-1"></a><span class="do">#### FOR SOME REASON THIS IS MISCALCULATED!!!</span></span>
<span id="cb412-5"><a href="ch-14-adventures-in-covariance.html#cb412-5" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">sapply</span>( logpop.seq , <span class="cf">function</span>(lp) <span class="fu">exp</span>( post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b<span class="sc">*</span>lp ) )</span>
<span id="cb412-6"><a href="ch-14-adventures-in-covariance.html#cb412-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-7"><a href="ch-14-adventures-in-covariance.html#cb412-7" aria-hidden="true" tabindex="-1"></a>lambda.median <span class="ot">&lt;-</span> <span class="fu">apply</span>( lambda , <span class="dv">2</span> , median )</span>
<span id="cb412-8"><a href="ch-14-adventures-in-covariance.html#cb412-8" aria-hidden="true" tabindex="-1"></a>lambda.PI80 <span class="ot">&lt;-</span> <span class="fu">apply</span>( lambda , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.80</span> )</span>
<span id="cb412-9"><a href="ch-14-adventures-in-covariance.html#cb412-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-10"><a href="ch-14-adventures-in-covariance.html#cb412-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raw data and labels</span></span>
<span id="cb412-11"><a href="ch-14-adventures-in-covariance.html#cb412-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>logpop , d<span class="sc">$</span>total_tools , <span class="at">col=</span>rangi2 , <span class="at">cex=</span>psize , <span class="at">pch=</span><span class="dv">16</span> </span>
<span id="cb412-12"><a href="ch-14-adventures-in-covariance.html#cb412-12" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">xlab=</span><span class="st">&quot;log population&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;total tools&quot;</span> )</span>
<span id="cb412-13"><a href="ch-14-adventures-in-covariance.html#cb412-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( d<span class="sc">$</span>logpop , d<span class="sc">$</span>total_tools , <span class="at">labels=</span>labels , <span class="at">cex=</span><span class="fl">0.7</span> </span>
<span id="cb412-14"><a href="ch-14-adventures-in-covariance.html#cb412-14" aria-hidden="true" tabindex="-1"></a>      ,<span class="at">pos=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>) )</span>
<span id="cb412-15"><a href="ch-14-adventures-in-covariance.html#cb412-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-16"><a href="ch-14-adventures-in-covariance.html#cb412-16" aria-hidden="true" tabindex="-1"></a><span class="co"># display posterior predictions</span></span>
<span id="cb412-17"><a href="ch-14-adventures-in-covariance.html#cb412-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>( logpop.seq , lambda.median , <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb412-18"><a href="ch-14-adventures-in-covariance.html#cb412-18" aria-hidden="true" tabindex="-1"></a><span class="co"># lines( logpop.seq , lambda.PI80[1,] , lty=2 )</span></span>
<span id="cb412-19"><a href="ch-14-adventures-in-covariance.html#cb412-19" aria-hidden="true" tabindex="-1"></a><span class="co"># lines( logpop.seq , lambda.PI80[2,] , lty=2 )</span></span>
<span id="cb412-20"><a href="ch-14-adventures-in-covariance.html#cb412-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-21"><a href="ch-14-adventures-in-covariance.html#cb412-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb412-22"><a href="ch-14-adventures-in-covariance.html#cb412-22" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay correlations</span></span>
<span id="cb412-23"><a href="ch-14-adventures-in-covariance.html#cb412-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb412-24"><a href="ch-14-adventures-in-covariance.html#cb412-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> )</span>
<span id="cb412-25"><a href="ch-14-adventures-in-covariance.html#cb412-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ( i <span class="sc">&lt;</span> j )</span>
<span id="cb412-26"><a href="ch-14-adventures-in-covariance.html#cb412-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>( <span class="fu">c</span>( d<span class="sc">$</span>logpop[i],d<span class="sc">$</span>logpop[j] ) ,</span>
<span id="cb412-27"><a href="ch-14-adventures-in-covariance.html#cb412-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>( d<span class="sc">$</span>total_tools[i],d<span class="sc">$</span>total_tools[j] ) ,</span>
<span id="cb412-28"><a href="ch-14-adventures-in-covariance.html#cb412-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd=</span><span class="dv">2</span> , <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,Rho[i,j]<span class="sc">^</span><span class="dv">2</span>) )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.45-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>In the book it looks the following:</p>
<p><img src="Images/paste-717E98E9.png" /></p>
<p>We see that the center line is the average prediction while the out bounds are the 80% compatibility intervals. We clearly see that there is a correlation and we see that some islands are above and others below the expected number of tools given their population size.</p>
</div>
</div>
<div id="example-phylogenetic-distance-not-in-the-curriculum" class="section level3" number="15.2.2">
<h3><span class="header-section-number">15.2.2</span> Example: Phylogenetic distance (not in the curriculum)</h3>
<p>This is yet another example where we measure distance, not in geographical way but we apply the distance of different monkey species (namely phylogenetic distance) and see if there is a correlation between the distance and the species. The end result is that there is very little covariance (when looking at the posterior distribution), thus implying that covariance is very little at any phylogenetic distance.</p>
<p>The overall approach to get these results are similar and we do create a parameter K, including eta squared and exponential distribution, taking inputs from rho squared and the distance matrix.</p>
<p>The section introduce some processes and methods, of which I don’t know if they have any relevance. Such as:</p>
<ul>
<li><p>Brownian motion</p></li>
<li><p>Pagel’s Lambda</p></li>
<li><p>Ornstain-Uhlenbeck Process</p></li>
</ul>
</div>
</div>
<div id="exercises-8" class="section level2" number="15.3">
<h2><span class="header-section-number">15.3</span> Exercises</h2>
<div id="m3-3" class="section level3" number="15.3.1">
<h3><span class="header-section-number">15.3.1</span> M3</h3>
<p>re-estiamte the varying slopes model for the UCBBadmit data, now using a non-centered parameterization. Compare the efficiency of the forms of the model, using n_eff. Which is better? Which chain sampled faster?</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="ch-14-adventures-in-covariance.html#cb413-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Loading the data</span></span>
<span id="cb413-2"><a href="ch-14-adventures-in-covariance.html#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb413-3"><a href="ch-14-adventures-in-covariance.html#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(UCBadmit)</span>
<span id="cb413-4"><a href="ch-14-adventures-in-covariance.html#cb413-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> UCBadmit</span>
<span id="cb413-5"><a href="ch-14-adventures-in-covariance.html#cb413-5" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb413-6"><a href="ch-14-adventures-in-covariance.html#cb413-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">admit =</span> d<span class="sc">$</span>admit,</span>
<span id="cb413-7"><a href="ch-14-adventures-in-covariance.html#cb413-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">applications =</span> d<span class="sc">$</span>applications,</span>
<span id="cb413-8"><a href="ch-14-adventures-in-covariance.html#cb413-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">gid =</span> <span class="fu">ifelse</span>( d<span class="sc">$</span>applicant.gender<span class="sc">==</span><span class="st">&quot;male&quot;</span> , <span class="dv">1</span> , <span class="dv">2</span> ),</span>
<span id="cb413-9"><a href="ch-14-adventures-in-covariance.html#cb413-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dep =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="at">each=</span><span class="dv">2</span>)</span>
<span id="cb413-10"><a href="ch-14-adventures-in-covariance.html#cb413-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Previously we had the following model:</p>
<p>The non centered model we will add adaptive priors.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="ch-14-adventures-in-covariance.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="co">#From chapter 11</span></span>
<span id="cb414-2"><a href="ch-14-adventures-in-covariance.html#cb414-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb414-3"><a href="ch-14-adventures-in-covariance.html#cb414-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb414-4"><a href="ch-14-adventures-in-covariance.html#cb414-4" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>(applications, p),</span>
<span id="cb414-5"><a href="ch-14-adventures-in-covariance.html#cb414-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[gid],</span>
<span id="cb414-6"><a href="ch-14-adventures-in-covariance.html#cb414-6" aria-hidden="true" tabindex="-1"></a>    a[gid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb414-7"><a href="ch-14-adventures-in-covariance.html#cb414-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb414-8"><a href="ch-14-adventures-in-covariance.html#cb414-8" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dat_list,<span class="at">chains =</span> <span class="dv">1</span>,<span class="at">cores =</span> <span class="dv">1</span></span>
<span id="cb414-9"><a href="ch-14-adventures-in-covariance.html#cb414-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;ff9c585b744194e1c435a1847ea630ad&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 1.9e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.19 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
## Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
## Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
## Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
## Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
## Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
## Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
## Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
## Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
## Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
## Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
## Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.011038 seconds (Warm-up)
## Chain 1:                0.008412 seconds (Sampling)
## Chain 1:                0.01945 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="ch-14-adventures-in-covariance.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb416-2"><a href="ch-14-adventures-in-covariance.html#cb416-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb416-3"><a href="ch-14-adventures-in-covariance.html#cb416-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb416-4"><a href="ch-14-adventures-in-covariance.html#cb416-4" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications , p ) ,</span>
<span id="cb416-5"><a href="ch-14-adventures-in-covariance.html#cb416-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> delta[dept_id] <span class="sc">+</span> bm[dept_id]<span class="sc">*</span>male,</span>
<span id="cb416-6"><a href="ch-14-adventures-in-covariance.html#cb416-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(delta,bbm)</span>
<span id="cb416-7"><a href="ch-14-adventures-in-covariance.html#cb416-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-8"><a href="ch-14-adventures-in-covariance.html#cb416-8" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb416-9"><a href="ch-14-adventures-in-covariance.html#cb416-9" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data=</span>dat_list </span>
<span id="cb416-10"><a href="ch-14-adventures-in-covariance.html#cb416-10" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains=</span><span class="dv">1</span> </span>
<span id="cb416-11"><a href="ch-14-adventures-in-covariance.html#cb416-11" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores=</span><span class="dv">1</span></span>
<span id="cb416-12"><a href="ch-14-adventures-in-covariance.html#cb416-12" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">log_lik=</span><span class="cn">TRUE</span> </span>
<span id="cb416-13"><a href="ch-14-adventures-in-covariance.html#cb416-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We see that the sampler is not super efficient, although it is okay.</p>
<p>Rhat should approach 1, that is looking okay.</p>
</div>
<div id="m4-3" class="section level3" number="15.3.2">
<h3><span class="header-section-number">15.3.2</span> M4</h3>
<p>The result of this exercise will compare three different models and expecrience that the more complex model is superior to the two other models.</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="ch-14-adventures-in-covariance.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb417-2"><a href="ch-14-adventures-in-covariance.html#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline2)</span>
<span id="cb417-3"><a href="ch-14-adventures-in-covariance.html#cb417-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Kline2</span>
<span id="cb417-4"><a href="ch-14-adventures-in-covariance.html#cb417-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>society <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="co">#Index observations</span></span>
<span id="cb417-5"><a href="ch-14-adventures-in-covariance.html#cb417-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>contact_id <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(d<span class="sc">$</span>contact <span class="sc">==</span> <span class="st">&#39;high&#39;</span>,<span class="dv">2</span>,<span class="dv">1</span>) <span class="co">#If the contact was high</span></span>
<span id="cb417-6"><a href="ch-14-adventures-in-covariance.html#cb417-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<div class="kable-table">
<table>
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="8%" />
<col width="12%" />
<col width="8%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="9%" />
<col width="8%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">culture</th>
<th align="right">population</th>
<th align="left">contact</th>
<th align="right">total_tools</th>
<th align="right">mean_TU</th>
<th align="right">lat</th>
<th align="right">lon</th>
<th align="right">lon2</th>
<th align="right">logpop</th>
<th align="right">society</th>
<th align="right">contact_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Malekula</td>
<td align="right">1100</td>
<td align="left">low</td>
<td align="right">13</td>
<td align="right">3.2</td>
<td align="right">-16.3</td>
<td align="right">167.5</td>
<td align="right">-12.5</td>
<td align="right">7.003065</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Tikopia</td>
<td align="right">1500</td>
<td align="left">low</td>
<td align="right">22</td>
<td align="right">4.7</td>
<td align="right">-12.3</td>
<td align="right">168.8</td>
<td align="right">-11.2</td>
<td align="right">7.313220</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Santa Cruz</td>
<td align="right">3600</td>
<td align="left">low</td>
<td align="right">24</td>
<td align="right">4.0</td>
<td align="right">-10.7</td>
<td align="right">166.0</td>
<td align="right">-14.0</td>
<td align="right">8.188689</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Yap</td>
<td align="right">4791</td>
<td align="left">high</td>
<td align="right">43</td>
<td align="right">5.0</td>
<td align="right">9.5</td>
<td align="right">138.1</td>
<td align="right">-41.9</td>
<td align="right">8.474494</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Lau Fiji</td>
<td align="right">7400</td>
<td align="left">high</td>
<td align="right">33</td>
<td align="right">5.0</td>
<td align="right">-17.7</td>
<td align="right">178.1</td>
<td align="right">-1.9</td>
<td align="right">8.909235</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Trobriand</td>
<td align="right">8000</td>
<td align="left">high</td>
<td align="right">19</td>
<td align="right">4.0</td>
<td align="right">-8.7</td>
<td align="right">150.9</td>
<td align="right">-29.1</td>
<td align="right">8.987197</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see the different islands, their population, the contact level, the total tools. Their position, log op population, and the two variables society and contact id that we created</p>
<p>We are also going to load in the islands dastiance matrix</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="ch-14-adventures-in-covariance.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;islandsDistMatrix&quot;</span>)</span>
<span id="cb418-2"><a href="ch-14-adventures-in-covariance.html#cb418-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(islandsDistMatrix)</span></code></pre></div>
<pre><code>##            Malekula Tikopia Santa Cruz   Yap Lau Fiji Trobriand Chuuk Manus
## Malekula      0.000   0.475      0.631 4.363    1.234     2.036 3.178 2.794
## Tikopia       0.475   0.000      0.315 4.173    1.236     2.007 2.877 2.670
## Santa Cruz    0.631   0.315      0.000 3.859    1.550     1.708 2.588 2.356
## Yap           4.363   4.173      3.859 0.000    5.391     2.462 1.555 1.616
## Lau Fiji      1.234   1.236      1.550 5.391    0.000     3.219 4.027 3.906
## Trobriand     2.036   2.007      1.708 2.462    3.219     0.000 1.801 0.850
##            Tonga Hawaii
## Malekula   1.860  5.678
## Tikopia    1.965  5.283
## Santa Cruz 2.279  5.401
## Yap        6.136  7.178
## Lau Fiji   0.763  4.884
## Trobriand  3.893  6.653</code></pre>
<p>Naturally we see that it is 0 on the diagonal, as the distance from an island to itself is 0.</p>
<p>Now we can construct the dataset.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="ch-14-adventures-in-covariance.html#cb420-1" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb420-2"><a href="ch-14-adventures-in-covariance.html#cb420-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> d<span class="sc">$</span>total_tools,</span>
<span id="cb420-3"><a href="ch-14-adventures-in-covariance.html#cb420-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">P =</span> d<span class="sc">$</span>population,</span>
<span id="cb420-4"><a href="ch-14-adventures-in-covariance.html#cb420-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">society =</span> d<span class="sc">$</span>society,</span>
<span id="cb420-5"><a href="ch-14-adventures-in-covariance.html#cb420-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dmat =</span> islandsDistMatrix</span>
<span id="cb420-6"><a href="ch-14-adventures-in-covariance.html#cb420-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb420-7"><a href="ch-14-adventures-in-covariance.html#cb420-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-8"><a href="ch-14-adventures-in-covariance.html#cb420-8" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb420-9"><a href="ch-14-adventures-in-covariance.html#cb420-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">T =</span> d<span class="sc">$</span>total_tools,</span>
<span id="cb420-10"><a href="ch-14-adventures-in-covariance.html#cb420-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">P =</span> d<span class="sc">$</span>population,</span>
<span id="cb420-11"><a href="ch-14-adventures-in-covariance.html#cb420-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cid =</span> d<span class="sc">$</span>contact_id</span>
<span id="cb420-12"><a href="ch-14-adventures-in-covariance.html#cb420-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb420-13"><a href="ch-14-adventures-in-covariance.html#cb420-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat_list)</span></code></pre></div>
<pre><code>## $T
##  [1] 13 22 24 43 33 19 40 28 55 71
## 
## $P
##  [1]   1100   1500   3600   4791   7400   8000   9200  13000  17500 275000
## 
## $society
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $Dmat
##            Malekula Tikopia Santa Cruz   Yap Lau Fiji Trobriand Chuuk Manus
## Malekula      0.000   0.475      0.631 4.363    1.234     2.036 3.178 2.794
## Tikopia       0.475   0.000      0.315 4.173    1.236     2.007 2.877 2.670
## Santa Cruz    0.631   0.315      0.000 3.859    1.550     1.708 2.588 2.356
## Yap           4.363   4.173      3.859 0.000    5.391     2.462 1.555 1.616
## Lau Fiji      1.234   1.236      1.550 5.391    0.000     3.219 4.027 3.906
## Trobriand     2.036   2.007      1.708 2.462    3.219     0.000 1.801 0.850
## Chuuk         3.178   2.877      2.588 1.555    4.027     1.801 0.000 1.213
## Manus         2.794   2.670      2.356 1.616    3.906     0.850 1.213 0.000
## Tonga         1.860   1.965      2.279 6.136    0.763     3.893 4.789 4.622
## Hawaii        5.678   5.283      5.401 7.178    4.884     6.653 5.787 6.722
##            Tonga Hawaii
## Malekula   1.860  5.678
## Tikopia    1.965  5.283
## Santa Cruz 2.279  5.401
## Yap        6.136  7.178
## Lau Fiji   0.763  4.884
## Trobriand  3.893  6.653
## Chuuk      4.789  5.787
## Manus      4.622  6.722
## Tonga      0.000  5.037
## Hawaii     5.037  0.000</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="ch-14-adventures-in-covariance.html#cb422-1" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.11</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb422-2"><a href="ch-14-adventures-in-covariance.html#cb422-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb422-3"><a href="ch-14-adventures-in-covariance.html#cb422-3" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> <span class="fu">dpois</span>( lambda ), <span class="co">#T = total number of tools</span></span>
<span id="cb422-4"><a href="ch-14-adventures-in-covariance.html#cb422-4" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(a[cid])<span class="sc">*</span>P<span class="sc">^</span>b[cid]<span class="sc">/</span>g, <span class="co">#P = population size</span></span>
<span id="cb422-5"><a href="ch-14-adventures-in-covariance.html#cb422-5" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb422-6"><a href="ch-14-adventures-in-covariance.html#cb422-6" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb422-7"><a href="ch-14-adventures-in-covariance.html#cb422-7" aria-hidden="true" tabindex="-1"></a>    g <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb422-8"><a href="ch-14-adventures-in-covariance.html#cb422-8" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat2 , <span class="at">chains=</span><span class="dv">1</span> , <span class="at">iter=</span><span class="dv">2000</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;58422f20040c774e9740e486280fe76b&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 2.4e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.24 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.332709 seconds (Warm-up)
## Chain 1:                0.286882 seconds (Sampling)
## Chain 1:                0.619591 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="ch-14-adventures-in-covariance.html#cb424-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-2"><a href="ch-14-adventures-in-covariance.html#cb424-2" aria-hidden="true" tabindex="-1"></a><span class="co">#In this model we simply have an exponential function for alpha as well</span></span>
<span id="cb424-3"><a href="ch-14-adventures-in-covariance.html#cb424-3" aria-hidden="true" tabindex="-1"></a>m11<span class="fl">.12</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb424-4"><a href="ch-14-adventures-in-covariance.html#cb424-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb424-5"><a href="ch-14-adventures-in-covariance.html#cb424-5" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> <span class="fu">dpois</span>( lambda ),</span>
<span id="cb424-6"><a href="ch-14-adventures-in-covariance.html#cb424-6" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> a[cid]<span class="sc">*</span>P<span class="sc">^</span>b[cid]<span class="sc">/</span>g,</span>
<span id="cb424-7"><a href="ch-14-adventures-in-covariance.html#cb424-7" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb424-8"><a href="ch-14-adventures-in-covariance.html#cb424-8" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb424-9"><a href="ch-14-adventures-in-covariance.html#cb424-9" aria-hidden="true" tabindex="-1"></a>    g <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb424-10"><a href="ch-14-adventures-in-covariance.html#cb424-10" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat2 , <span class="at">chains=</span><span class="dv">1</span> , <span class="at">iter=</span><span class="dv">2000</span> , <span class="at">log_lik=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;2df9af959b40e14e7671c593bf1229d1&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 2.2e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.22 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.308024 seconds (Warm-up)
## Chain 1:                0.302042 seconds (Sampling)
## Chain 1:                0.610066 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="ch-14-adventures-in-covariance.html#cb426-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-2"><a href="ch-14-adventures-in-covariance.html#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="co">#In this model we will include the distance matrix to measure similarity</span></span>
<span id="cb426-3"><a href="ch-14-adventures-in-covariance.html#cb426-3" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.8</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb426-4"><a href="ch-14-adventures-in-covariance.html#cb426-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb426-5"><a href="ch-14-adventures-in-covariance.html#cb426-5" aria-hidden="true" tabindex="-1"></a>    T <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb426-6"><a href="ch-14-adventures-in-covariance.html#cb426-6" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> (a<span class="sc">*</span>P<span class="sc">^</span>b<span class="sc">/</span>g)<span class="sc">*</span><span class="fu">exp</span>(k[society]),</span>
<span id="cb426-7"><a href="ch-14-adventures-in-covariance.html#cb426-7" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">10</span>]<span class="sc">:</span>k <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="dv">0</span> , SIGMA ), <span class="co">#Multivariate normal distribution for the distance matrix</span></span>
<span id="cb426-8"><a href="ch-14-adventures-in-covariance.html#cb426-8" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">10</span>,<span class="dv">10</span>]<span class="sc">:</span>SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL2</span>( Dmat , etasq , rhosq , <span class="fl">0.01</span> ),</span>
<span id="cb426-9"><a href="ch-14-adventures-in-covariance.html#cb426-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a,b,g) <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ), <span class="co">#g = the Gaussian process varying intercepts for each society</span></span>
<span id="cb426-10"><a href="ch-14-adventures-in-covariance.html#cb426-10" aria-hidden="true" tabindex="-1"></a>    etasq <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">2</span> ),</span>
<span id="cb426-11"><a href="ch-14-adventures-in-covariance.html#cb426-11" aria-hidden="true" tabindex="-1"></a>    rhosq <span class="sc">~</span> <span class="fu">dexp</span>( <span class="fl">0.5</span> )</span>
<span id="cb426-12"><a href="ch-14-adventures-in-covariance.html#cb426-12" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">1</span> , <span class="at">iter=</span><span class="dv">2000</span>, <span class="at">log_lik=</span><span class="cn">TRUE</span>  )</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;88f2ad7a384c819633238280368dab9f&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 7.9e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.79 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 2.02199 seconds (Warm-up)
## Chain 1:                1.94882 seconds (Sampling)
## Chain 1:                3.9708 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="ch-14-adventures-in-covariance.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m11<span class="fl">.11</span>,m11<span class="fl">.12</span>,m14<span class="fl">.8</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">68.53786</td>
</tr>
<tr class="even">
<td align="right">80.10445</td>
</tr>
<tr class="odd">
<td align="right">81.23926</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2.707832</td>
</tr>
<tr class="even">
<td align="right">11.267383</td>
</tr>
<tr class="odd">
<td align="right">11.533889</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.00000</td>
</tr>
<tr class="even">
<td align="right">11.56659</td>
</tr>
<tr class="odd">
<td align="right">12.70140</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">11.22271</td>
</tr>
<tr class="odd">
<td align="right">11.55810</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4.527584</td>
</tr>
<tr class="even">
<td align="right">4.856916</td>
</tr>
<tr class="odd">
<td align="right">5.468303</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9951991</td>
</tr>
<tr class="even">
<td align="right">0.0030638</td>
</tr>
<tr class="odd">
<td align="right">0.0017371</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that model 14.8 is the best model looking at the out of sample estimate. Also it has the fewest effective parameters, despite being the model with most absolute parameters. That is because we have a varying effects model, and due to the pooling effects, we are able to have less effective parameters. As by observing one society we also get to know a bit for another society.</p>
</div>
<div id="h2-6" class="section level3" number="15.3.3">
<h3><span class="header-section-number">15.3.3</span> H2</h3>
<p>We are going to draw the following DAG.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="ch-14-adventures-in-covariance.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb429-2"><a href="ch-14-adventures-in-covariance.html#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb429-3"><a href="ch-14-adventures-in-covariance.html#cb429-3" aria-hidden="true" tabindex="-1"></a>dag_6M1 <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{</span></span>
<span id="cb429-4"><a href="ch-14-adventures-in-covariance.html#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="st">    A -&gt; C</span></span>
<span id="cb429-5"><a href="ch-14-adventures-in-covariance.html#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="st">    A -&gt; K -&gt; C </span></span>
<span id="cb429-6"><a href="ch-14-adventures-in-covariance.html#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="st">    }&quot;</span>)</span>
<span id="cb429-7"><a href="ch-14-adventures-in-covariance.html#cb429-7" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag_6M1) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb429-8"><a href="ch-14-adventures-in-covariance.html#cb429-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">K=</span><span class="dv">2</span>,<span class="at">C=</span><span class="dv">1</span>),</span>
<span id="cb429-9"><a href="ch-14-adventures-in-covariance.html#cb429-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y=</span><span class="fu">c</span>(<span class="at">A=</span><span class="dv">0</span>,<span class="at">K=</span><span class="dv">0</span>, <span class="at">C=</span><span class="dv">1</span>) )</span>
<span id="cb429-10"><a href="ch-14-adventures-in-covariance.html#cb429-10" aria-hidden="true" tabindex="-1"></a><span class="fu">drawdag</span>(dag_6M1)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-213-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We want to predict the number of kids (C). By including A we will also include some infromation about K as there is causality from age to K, that e.g., if you are old you dont want more kids, thus you start using contraception.</p>
<p>Thus we need two models:</p>
<ol style="list-style-type: decimal">
<li>One for the effect of A on C</li>
<li>One for the effect of A through K.</li>
</ol>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="ch-14-adventures-in-covariance.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb430-2"><a href="ch-14-adventures-in-covariance.html#cb430-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(bangladesh)</span>
<span id="cb430-3"><a href="ch-14-adventures-in-covariance.html#cb430-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> bangladesh</span>
<span id="cb430-4"><a href="ch-14-adventures-in-covariance.html#cb430-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-5"><a href="ch-14-adventures-in-covariance.html#cb430-5" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb430-6"><a href="ch-14-adventures-in-covariance.html#cb430-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> d<span class="sc">$</span>use.contraception,</span>
<span id="cb430-7"><a href="ch-14-adventures-in-covariance.html#cb430-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">did =</span> <span class="fu">as.integer</span>( <span class="fu">as.factor</span>(d<span class="sc">$</span>district) ),</span>
<span id="cb430-8"><a href="ch-14-adventures-in-covariance.html#cb430-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">urban =</span> d<span class="sc">$</span>urban )</span>
<span id="cb430-9"><a href="ch-14-adventures-in-covariance.html#cb430-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-10"><a href="ch-14-adventures-in-covariance.html#cb430-10" aria-hidden="true" tabindex="-1"></a>dat_list<span class="sc">$</span>children <span class="ot">&lt;-</span> <span class="fu">standardize</span>( d<span class="sc">$</span>living.children ) </span>
<span id="cb430-11"><a href="ch-14-adventures-in-covariance.html#cb430-11" aria-hidden="true" tabindex="-1"></a>dat_list<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">standardize</span>( d<span class="sc">$</span>age.centered )</span>
<span id="cb430-12"><a href="ch-14-adventures-in-covariance.html#cb430-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-13"><a href="ch-14-adventures-in-covariance.html#cb430-13" aria-hidden="true" tabindex="-1"></a>m14H2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb430-14"><a href="ch-14-adventures-in-covariance.html#cb430-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb430-15"><a href="ch-14-adventures-in-covariance.html#cb430-15" aria-hidden="true" tabindex="-1"></a>    C <span class="sc">~</span> <span class="fu">bernoulli</span>( p ),</span>
<span id="cb430-16"><a href="ch-14-adventures-in-covariance.html#cb430-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> a[did] <span class="sc">+</span> b[did]<span class="sc">*</span>urban <span class="sc">+</span> bA<span class="sc">*</span>age,</span>
<span id="cb430-17"><a href="ch-14-adventures-in-covariance.html#cb430-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a,b)[did] <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(abar,bbar) , Rho , Sigma ),</span>
<span id="cb430-18"><a href="ch-14-adventures-in-covariance.html#cb430-18" aria-hidden="true" tabindex="-1"></a>    abar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb430-19"><a href="ch-14-adventures-in-covariance.html#cb430-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(bbar,bA) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb430-20"><a href="ch-14-adventures-in-covariance.html#cb430-20" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>),</span>
<span id="cb430-21"><a href="ch-14-adventures-in-covariance.html#cb430-21" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb430-22"><a href="ch-14-adventures-in-covariance.html#cb430-22" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>dat_list , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> , <span class="at">iter=</span><span class="dv">1000</span> )</span></code></pre></div>
</div>
<div id="h4-varying-intercepts-varying-slopes" class="section level3" number="15.3.4">
<h3><span class="header-section-number">15.3.4</span> H4 Varying intercepts Varying slopes</h3>
<p>Predict height using age clustered by subject (Person). We are going to do a varying intercepts and varying slopes model</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="ch-14-adventures-in-covariance.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Oxboys)</span>
<span id="cb431-2"><a href="ch-14-adventures-in-covariance.html#cb431-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Oxboys</span>
<span id="cb431-3"><a href="ch-14-adventures-in-covariance.html#cb431-3" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb431-4"><a href="ch-14-adventures-in-covariance.html#cb431-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject =</span> d<span class="sc">$</span>Subject,</span>
<span id="cb431-5"><a href="ch-14-adventures-in-covariance.html#cb431-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> d<span class="sc">$</span>age,</span>
<span id="cb431-6"><a href="ch-14-adventures-in-covariance.html#cb431-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> d<span class="sc">$</span>height</span>
<span id="cb431-7"><a href="ch-14-adventures-in-covariance.html#cb431-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb431-8"><a href="ch-14-adventures-in-covariance.html#cb431-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">Subject</th>
<th align="right">age</th>
<th align="right">height</th>
<th align="right">Occasion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">-1.0000</td>
<td align="right">140.5</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-0.7479</td>
<td align="right">143.4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">-0.4630</td>
<td align="right">144.8</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">-0.1643</td>
<td align="right">147.1</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">-0.0027</td>
<td align="right">147.7</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.2466</td>
<td align="right">150.2</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="ch-14-adventures-in-covariance.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb432-2"><a href="ch-14-adventures-in-covariance.html#cb432-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Oxboys)</span>
<span id="cb432-3"><a href="ch-14-adventures-in-covariance.html#cb432-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Oxboys</span>
<span id="cb432-4"><a href="ch-14-adventures-in-covariance.html#cb432-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>A <span class="ot">&lt;-</span> <span class="fu">standardize</span>( d<span class="sc">$</span>age )</span>
<span id="cb432-5"><a href="ch-14-adventures-in-covariance.html#cb432-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="fu">coerce_index</span>( d<span class="sc">$</span>Subject )</span>
<span id="cb432-6"><a href="ch-14-adventures-in-covariance.html#cb432-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-7"><a href="ch-14-adventures-in-covariance.html#cb432-7" aria-hidden="true" tabindex="-1"></a>m14H4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb432-8"><a href="ch-14-adventures-in-covariance.html#cb432-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb432-9"><a href="ch-14-adventures-in-covariance.html#cb432-9" aria-hidden="true" tabindex="-1"></a>        height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb432-10"><a href="ch-14-adventures-in-covariance.html#cb432-10" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> a_bar <span class="sc">+</span> a[id] <span class="sc">+</span> (b_bar <span class="sc">+</span> b[id])<span class="sc">*</span>A,</span>
<span id="cb432-11"><a href="ch-14-adventures-in-covariance.html#cb432-11" aria-hidden="true" tabindex="-1"></a>        a_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">150</span>,<span class="dv">10</span>), <span class="co">#mean height</span></span>
<span id="cb432-12"><a href="ch-14-adventures-in-covariance.html#cb432-12" aria-hidden="true" tabindex="-1"></a>        b_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="co">#mean slope for all persons</span></span>
<span id="cb432-13"><a href="ch-14-adventures-in-covariance.html#cb432-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c</span>(a,b)[id] <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="dv">0</span> , Rho_id , sigma_id ), <span class="co">#Correlation matrix</span></span>
<span id="cb432-14"><a href="ch-14-adventures-in-covariance.html#cb432-14" aria-hidden="true" tabindex="-1"></a>        sigma_id <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>), <span class="co">#standard deciation for each person</span></span>
<span id="cb432-15"><a href="ch-14-adventures-in-covariance.html#cb432-15" aria-hidden="true" tabindex="-1"></a>        Rho_id <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">2</span>), <span class="co">#the onion distribution for slope / intercepts correlation</span></span>
<span id="cb432-16"><a href="ch-14-adventures-in-covariance.html#cb432-16" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>) <span class="co">#standard deviation</span></span>
<span id="cb432-17"><a href="ch-14-adventures-in-covariance.html#cb432-17" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">data=</span>d , <span class="at">chains=</span><span class="dv">1</span> , <span class="at">cores=</span><span class="dv">1</span> , <span class="at">iter=</span><span class="dv">4000</span> )</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL &#39;fe0fd9bb3f480cc772124ed1119cf20e&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 0.000199 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.99 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 4000 [  0%]  (Warmup)
## Chain 1: Iteration:  400 / 4000 [ 10%]  (Warmup)
## Chain 1: Iteration:  800 / 4000 [ 20%]  (Warmup)
## Chain 1: Iteration: 1200 / 4000 [ 30%]  (Warmup)
## Chain 1: Iteration: 1600 / 4000 [ 40%]  (Warmup)
## Chain 1: Iteration: 2000 / 4000 [ 50%]  (Warmup)
## Chain 1: Iteration: 2001 / 4000 [ 50%]  (Sampling)
## Chain 1: Iteration: 2400 / 4000 [ 60%]  (Sampling)
## Chain 1: Iteration: 2800 / 4000 [ 70%]  (Sampling)
## Chain 1: Iteration: 3200 / 4000 [ 80%]  (Sampling)
## Chain 1: Iteration: 3600 / 4000 [ 90%]  (Sampling)
## Chain 1: Iteration: 4000 / 4000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 15.3363 seconds (Warm-up)
## Chain 1:                15.7947 seconds (Sampling)
## Chain 1:                31.131 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="ch-14-adventures-in-covariance.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( m14H4<span class="fl">.1</span> , <span class="at">depth=</span><span class="dv">2</span> , <span class="at">pars=</span><span class="fu">c</span>(<span class="st">&quot;a_bar&quot;</span>,<span class="st">&quot;b_bar&quot;</span>,<span class="st">&quot;sigma_id&quot;</span>) )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">149.589744</td>
</tr>
<tr class="even">
<td align="right">4.224061</td>
</tr>
<tr class="odd">
<td align="right">7.269658</td>
</tr>
<tr class="even">
<td align="right">1.055018</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.2786225</td>
</tr>
<tr class="even">
<td align="right">0.1943985</td>
</tr>
<tr class="odd">
<td align="right">0.8412816</td>
</tr>
<tr class="even">
<td align="right">0.1464204</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">147.3818161</td>
</tr>
<tr class="even">
<td align="right">3.9100682</td>
</tr>
<tr class="odd">
<td align="right">6.0363687</td>
</tr>
<tr class="even">
<td align="right">0.8474578</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">151.552963</td>
</tr>
<tr class="even">
<td align="right">4.549907</td>
</tr>
<tr class="odd">
<td align="right">8.723843</td>
</tr>
<tr class="even">
<td align="right">1.313094</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">83.66149</td>
</tr>
<tr class="even">
<td align="right">125.44741</td>
</tr>
<tr class="odd">
<td align="right">1464.79695</td>
</tr>
<tr class="even">
<td align="right">1130.66298</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0012601</td>
</tr>
<tr class="even">
<td align="right">1.0084685</td>
</tr>
<tr class="odd">
<td align="right">0.9995069</td>
</tr>
<tr class="even">
<td align="right">0.9995083</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>What do we see from the model?:</p>
<ul>
<li>Notice that the data is on the standardized scale, hence one unit of x is one standard deviation.</li>
<li>We have a noncentered model as the mean is taken out of the intercepts, that being a_bar</li>
<li>Mu consists of mean height (a_bar), the intercept for each person and then b_bar is a mean change of height given standard deviation in age (thus a slope for height given the change in age), this is accompanied with a slope for each person.</li>
<li>All persons are on average 149 cm, that is with a standard deviation of 1.4</li>
<li>On average one standard deviation of age increase leads to a person being 4.21 cm taller</li>
<li>Notice very inefficient sampling in a_bar and b_bar</li>
</ul>
<p>Now we can plot the heights given the standardized x (demeaned and divided by one standard deviation).</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="ch-14-adventures-in-covariance.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( height <span class="sc">~</span> age , <span class="at">type=</span><span class="st">&quot;n&quot;</span> , <span class="at">data=</span>d ) </span>
<span id="cb435-2"><a href="ch-14-adventures-in-covariance.html#cb435-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span> ) {</span>
<span id="cb435-3"><a href="ch-14-adventures-in-covariance.html#cb435-3" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> d<span class="sc">$</span>height[ d<span class="sc">$</span>Subject<span class="sc">==</span>i ]</span>
<span id="cb435-4"><a href="ch-14-adventures-in-covariance.html#cb435-4" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> d<span class="sc">$</span>age[ d<span class="sc">$</span>Subject<span class="sc">==</span>i ]</span>
<span id="cb435-5"><a href="ch-14-adventures-in-covariance.html#cb435-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( a , h , <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;slateblue&quot;</span>,<span class="fl">0.5</span>) , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb435-6"><a href="ch-14-adventures-in-covariance.html#cb435-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-217-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now what we can do instead is to predict the heights for the persons given their age. Thus we use the link function. Notice as we have a linear model we will have linear correlations, although we have several predictions, one for each person, thus we are able to distinguish between two persons and say given his current height, some may end up being 140 tall while other higher than 170 when growing one standard deviation in age.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="ch-14-adventures-in-covariance.html#cb436-1" aria-hidden="true" tabindex="-1"></a>m14H4<span class="fl">.1</span>_link <span class="ot">&lt;-</span> <span class="fu">link</span>(m14H4<span class="fl">.1</span>)</span>
<span id="cb436-2"><a href="ch-14-adventures-in-covariance.html#cb436-2" aria-hidden="true" tabindex="-1"></a>h_pred <span class="ot">&lt;-</span> <span class="fu">apply</span>(m14H4<span class="fl">.1</span>_link, <span class="dv">2</span>, mean) <span class="co"># 2 for columns</span></span>
<span id="cb436-3"><a href="ch-14-adventures-in-covariance.html#cb436-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(d, h_pred) <span class="co">#Add the predictions to the the dataframe</span></span>
<span id="cb436-4"><a href="ch-14-adventures-in-covariance.html#cb436-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb436-5"><a href="ch-14-adventures-in-covariance.html#cb436-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( height <span class="sc">~</span> age , <span class="at">type=</span><span class="st">&quot;n&quot;</span> , <span class="at">data=</span>d ) </span>
<span id="cb436-6"><a href="ch-14-adventures-in-covariance.html#cb436-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">26</span> ) {</span>
<span id="cb436-7"><a href="ch-14-adventures-in-covariance.html#cb436-7" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> d<span class="sc">$</span>h_pred[ d<span class="sc">$</span>Subject<span class="sc">==</span>i ]</span>
<span id="cb436-8"><a href="ch-14-adventures-in-covariance.html#cb436-8" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> d<span class="sc">$</span>age[ d<span class="sc">$</span>Subject<span class="sc">==</span>i ]</span>
<span id="cb436-9"><a href="ch-14-adventures-in-covariance.html#cb436-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( a , h , <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;slateblue&quot;</span>,<span class="fl">0.5</span>) , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb436-10"><a href="ch-14-adventures-in-covariance.html#cb436-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-218-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><strong><em>Notice that there are varying intercepts and varying slopes</em></strong> that is visible in the way that some slopes are steeper than others and they all have different intercepts.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-14-advuntetures-in-coviaraince.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
