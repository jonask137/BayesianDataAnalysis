<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Chapter 9 - Markov Chain Monte Carlo | Bayesian Data Analysis Notes</title>
  <meta name="description" content="10 Chapter 9 - Markov Chain Monte Carlo | Bayesian Data Analysis Notes" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Chapter 9 - Markov Chain Monte Carlo | Bayesian Data Analysis Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Chapter 9 - Markov Chain Monte Carlo | Bayesian Data Analysis Notes" />
  
  
  

<meta name="author" content="Jonas Ringive Korsholm" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-8-model-comparison.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="chapter-1-golems-of-prague.html"><a href="chapter-1-golems-of-prague.html"><i class="fa fa-check"></i><b>1</b> Chapter 1 - Golems of Prague</a></li>
<li class="chapter" data-level="2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Chapter 2 - Small worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#models-and-estimation"><i class="fa fa-check"></i><b>2.1</b> Models and Estimation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#engines-motors-to-estimate-the-models"><i class="fa fa-check"></i><b>2.1.1</b> Engines / Motors to estimate the models</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.1.1.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.1.1.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.1.1.3" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.1.1.3</b> Markov Chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#exercises"><i class="fa fa-check"></i><b>2.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.2.1</b> 2M1</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.2.2</b> 2M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Chapter 3 - Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-boundaries"><i class="fa fa-check"></i><b>3.2.1</b> Defined Boundaries</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-probability-mass"><i class="fa fa-check"></i><b>3.2.2</b> Defined Probability Mass</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i><b>3.2.3</b> Point Estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i><b>3.3.1</b> Dummy Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.2</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m1-1"><i class="fa fa-check"></i><b>3.4.1</b> 3M1</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m2-1"><i class="fa fa-check"></i><b>3.4.2</b> 3M2</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m3"><i class="fa fa-check"></i><b>3.4.3</b> 3M3</a></li>
<li class="chapter" data-level="3.4.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m4"><i class="fa fa-check"></i><b>3.4.4</b> 3M4</a></li>
<li class="chapter" data-level="3.4.5" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m5"><i class="fa fa-check"></i><b>3.4.5</b> 3M5</a></li>
<li class="chapter" data-level="3.4.6" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h1"><i class="fa fa-check"></i><b>3.4.6</b> 3H1</a></li>
<li class="chapter" data-level="3.4.7" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h2"><i class="fa fa-check"></i><b>3.4.7</b> 3H2</a></li>
<li class="chapter" data-level="3.4.8" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h3"><i class="fa fa-check"></i><b>3.4.8</b> 3H3</a></li>
<li class="chapter" data-level="3.4.9" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h4"><i class="fa fa-check"></i><b>3.4.9</b> 3H4</a></li>
<li class="chapter" data-level="3.4.10" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h5"><i class="fa fa-check"></i><b>3.4.10</b> 3H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why Normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model"><i class="fa fa-check"></i><b>4.3.1</b> The model</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>4.3.3</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap"><i class="fa fa-check"></i><b>4.3.4</b> Finding the posterior distribution with quap</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap"><i class="fa fa-check"></i><b>4.3.5</b> Sampling from a quap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-lienar-mdoel-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The lienar mdoel strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution</a>
<ul>
<li class="chapter" data-level="4.4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#tables-fo-marginal-distributions"><i class="fa fa-check"></i><b>4.4.3.1</b> Tables fo marginal distributions</a></li>
<li class="chapter" data-level="4.4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-posterior-inference-against-the-data"><i class="fa fa-check"></i><b>4.4.3.2</b> Plotting posterior inference against the data</a></li>
<li class="chapter" data-level="4.4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#adding-uncertainty-around-the-mean"><i class="fa fa-check"></i><b>4.4.3.3</b> Adding uncertainty around the mean</a></li>
<li class="chapter" data-level="4.4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-regression-intervlas-and-contours"><i class="fa fa-check"></i><b>4.4.3.4</b> Plotting regression intervlas and contours</a></li>
<li class="chapter" data-level="4.4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#prediction-intevals"><i class="fa fa-check"></i><b>4.4.3.5</b> Prediction intevals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-form-lines"><i class="fa fa-check"></i><b>4.5</b> Curves form lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i><b>4.5.2</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#exercises-2"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-models.html"><a href="geocentric-models.html#m1-2"><i class="fa fa-check"></i><b>4.6.1</b> 4M1</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-models.html"><a href="geocentric-models.html#m8"><i class="fa fa-check"></i><b>4.6.2</b> 4M8</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-models.html"><a href="geocentric-models.html#h1-1"><i class="fa fa-check"></i><b>4.6.3</b> 4H1</a></li>
<li class="chapter" data-level="4.6.4" data-path="geocentric-models.html"><a href="geocentric-models.html#h2-1"><i class="fa fa-check"></i><b>4.6.4</b> 4H2</a></li>
<li class="chapter" data-level="4.6.5" data-path="geocentric-models.html"><a href="geocentric-models.html#h3-1"><i class="fa fa-check"></i><b>4.6.5</b> 4H3</a></li>
<li class="chapter" data-level="4.6.6" data-path="geocentric-models.html"><a href="geocentric-models.html#h6"><i class="fa fa-check"></i><b>4.6.6</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lecture-notes-wrap-up-chapters-geocentric-models.html"><a href="lecture-notes-wrap-up-chapters-geocentric-models.html"><i class="fa fa-check"></i><b>5</b> Lecture notes - wrap up chapters geocentric models</a></li>
<li class="chapter" data-level="6" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>6.1</b> Spurious Associations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#defining-a-multiple-regression"><i class="fa fa-check"></i><b>6.1.1</b> Defining a multiple regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#approximating-the-posterior"><i class="fa fa-check"></i><b>6.1.2</b> Approximating the posterior</a></li>
<li class="chapter" data-level="6.1.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#the-flow"><i class="fa fa-check"></i><b>6.1.3</b> The flow</a>
<ul>
<li class="chapter" data-level="6.1.3.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>6.1.3.1</b> Posterior Prediction Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>6.2</b> Masked Relationship</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>6.3</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#lecture-notes---not-integrated-in-the-notes"><i class="fa fa-check"></i><b>6.4</b> Lecture notes - not integrated in the notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>7.1</b> Multicollinearity</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post Treatment Bias</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>7.4</b> Confronting Confounding</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#exercises-3"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m1-3"><i class="fa fa-check"></i><b>7.5.1</b> 6M1</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m3-1"><i class="fa fa-check"></i><b>7.5.2</b> 6M3</a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h"><i class="fa fa-check"></i><b>7.5.3</b> 6H</a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h3-2"><i class="fa fa-check"></i><b>7.5.4</b> 6H3</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h4-1"><i class="fa fa-check"></i><b>7.5.5</b> 6H4</a></li>
<li class="chapter" data-level="7.5.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h5-1"><i class="fa fa-check"></i><b>7.5.6</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#lecture-notes---not-integrated-in-the-text"><i class="fa fa-check"></i><b>7.6</b> Lecture notes - not integrated in the text</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model comparison</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The problem with parameters</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem Taming: Regularization</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>8.4</b> Predicting predictive accuracy</a></li>
<li class="chapter" data-level="8.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#model-comparison"><i class="fa fa-check"></i><b>8.5</b> Model Comparison</a></li>
<li class="chapter" data-level="8.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#exercies"><i class="fa fa-check"></i><b>8.6</b> Exercies</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#medium-exercises"><i class="fa fa-check"></i><b>8.6.1</b> Medium exercises</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#hard-exercises"><i class="fa fa-check"></i><b>8.6.2</b> Hard exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html"><i class="fa fa-check"></i><b>9</b> Chapter 8 - Model comparison</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>9.1.1</b> Adding an indicator variable isn’t enough.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#continuous-interactions"><i class="fa fa-check"></i><b>9.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#a-winter-flower"><i class="fa fa-check"></i><b>9.3.1</b> A Winter Flower</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#the-models"><i class="fa fa-check"></i><b>9.3.2</b> The models</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#exercises-4"><i class="fa fa-check"></i><b>9.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#m4-1"><i class="fa fa-check"></i><b>9.4.1</b> 8M4</a>
<ul>
<li class="chapter" data-level="9.4.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#interaction-model"><i class="fa fa-check"></i><b>9.4.1.1</b> Interaction model</a></li>
<li class="chapter" data-level="9.4.1.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#conclusion"><i class="fa fa-check"></i><b>9.4.1.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#h3-3"><i class="fa fa-check"></i><b>9.4.2</b> 8H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>10</b> Chapter 9 - Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algorithms</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#easy-hmc-ulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: ulam</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-quap"><i class="fa fa-check"></i><b>10.4.1</b> Fitting using quap</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-hmc"><i class="fa fa-check"></i><b>10.4.2</b> Fitting using HMC</a>
<ul>
<li class="chapter" data-level="10.4.2.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#preparing-data"><i class="fa fa-check"></i><b>10.4.2.1</b> Preparing data</a></li>
<li class="chapter" data-level="10.4.2.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-from-the-posterior-1"><i class="fa fa-check"></i><b>10.4.2.2</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="10.4.2.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>10.4.2.3</b> Sampling again, in parallel</a></li>
<li class="chapter" data-level="10.4.2.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>10.4.2.4</b> Visualization</a></li>
<li class="chapter" data-level="10.4.2.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.2.5</b> Checking the chain</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>10.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="10.5.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>10.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="10.5.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#taming-a-wild-chain"><i class="fa fa-check"></i><b>10.5.3</b> Taming a wild chain</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#exercises-5"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e4"><i class="fa fa-check"></i><b>10.6.1</b> E4</a></li>
<li class="chapter" data-level="10.6.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e5"><i class="fa fa-check"></i><b>10.6.2</b> E5</a></li>
<li class="chapter" data-level="10.6.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e6"><i class="fa fa-check"></i><b>10.6.3</b> E6</a></li>
<li class="chapter" data-level="10.6.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e7"><i class="fa fa-check"></i><b>10.6.4</b> E7</a></li>
<li class="chapter" data-level="10.6.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#m1-4"><i class="fa fa-check"></i><b>10.6.5</b> M1</a></li>
<li class="chapter" data-level="10.6.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#h2-2"><i class="fa fa-check"></i><b>10.6.6</b> H2</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#lecture-notes"><i class="fa fa-check"></i><b>10.7</b> Lecture notes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-9---markov-chain-monte-carlo" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Chapter 9 - Markov Chain Monte Carlo</h1>
<div id="good-king-markov-and-his-island-kingdom" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Good King Markov and his island kingdom</h2>
</div>
<div id="metropolis-algorithms" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Metropolis algorithms</h2>
<p>it is sampling randomly starting from the ending point of the previous accepted sample.</p>
<p>This is inefficient, as the randomness will take time to find samples that are acceptet. Hence we rarely use this today.</p>
<p>HMC is dealing with this flaw, notice that Metropolis Hastings will always converge, but it will just take time.</p>
</div>
<div id="hamiltonian-monte-carlo" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Hamiltonian Monte Carlo</h2>
<p>This is a more effect approach for sampling. It is two hyper parametersÆ</p>
<ol style="list-style-type: decimal">
<li>Leapfrog steps (number of steps to take / time to run)</li>
<li>Stepsize, that is how long the steps are</li>
</ol>
<p>We see that it is will start from where it ended, and then it is running for the n number of leapfrogs, where the gravity will force it towards a dense region.</p>
<p>We see that HMC is able to make a chain that is going in circles. The folllowing is an example. This is not very effective. Although over time it will converge to a stable model. We want a scenario as in the left window. The right window is having U-Turns, we dont want these.</p>
<p><img src="Images/paste-2D934792.png" /></p>
<p>The problem with U-Turns is that the step size and the number of steps that is taken, is unfortunate letting the model end the same place as it started. Hence for HMC to be effective, one must really tune these parameters correctly.</p>
<p><strong><em>Then how are we dealing with U-Turns?</em></strong></p>
<p>We see that <code>Ulam</code> is able to find appropriate step sizes and number of steps (leapfrog steps), through a warmup phase. <em>Notice that these do not account as samples, although the samples drawn with the tuned hyperparameters are.</em></p>
<p>This is an example of a sampler that is inefficient: <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=RandomWalkMH&amp;target=banana" class="uri">&lt;https://chi-feng.github.io/mcmc-demo/app.html?algorithm=RandomWalkMH&amp;target=banana&gt;</a> (needs to be seet to HMC, standard dist, and increase leapfrog steps)</p>
<p><img src="Images/paste-CCD495FC.png" /></p>
<p><strong>Fancy models:</strong> scientist has invented an adaptive model chain, where it will end if it sees a U-Turn, this is called (NUTS - No U-Turn sampler). This is essentially pointing in both directions. to find out if the sampler started going backwards.</p>
</div>
<div id="easy-hmc-ulam" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Easy HMC: ulam</h2>
<div id="fitting-using-quap" class="section level3" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Fitting using quap</h3>
<p>The following is an example of how the <code>ulam</code> function works. We are going to use the example from chapter 8 about predicting log GDP based on ruggedness of a nation.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb213-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged)</span>
<span id="cb213-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> rugged</span>
<span id="cb213-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>log_gdp <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>rgdppc_2000)</span>
<span id="cb213-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-5" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d[ <span class="fu">complete.cases</span>(d<span class="sc">$</span>rgdppc_2000) , ]</span>
<span id="cb213-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-6" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>log_gdp_std <span class="ot">&lt;-</span> dd<span class="sc">$</span>log_gdp <span class="sc">/</span> <span class="fu">mean</span>(dd<span class="sc">$</span>log_gdp)</span>
<span id="cb213-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-7" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>rugged_std <span class="ot">&lt;-</span> dd<span class="sc">$</span>rugged <span class="sc">/</span> <span class="fu">max</span>(dd<span class="sc">$</span>rugged)</span>
<span id="cb213-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb213-8" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>cid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( dd<span class="sc">$</span>cont_africa<span class="sc">==</span><span class="dv">1</span> , <span class="dv">1</span> , <span class="dv">2</span> )</span></code></pre></div>
<p>The following is an example of how to specify the model and fit it using the <code>quap</code> method.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-1" aria-hidden="true" tabindex="-1"></a>m8<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>( </span>
<span id="cb214-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb214-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb214-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a[cid] <span class="sc">+</span> b[cid]<span class="sc">*</span>( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ) ,</span>
<span id="cb214-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-5" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">1</span> , <span class="fl">0.1</span> ) ,</span>
<span id="cb214-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-6" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="fl">0.3</span> ) ,</span>
<span id="cb214-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb214-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb214-9"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-9" aria-hidden="true" tabindex="-1"></a>  , <span class="at">data=</span>dd )</span>
<span id="cb214-10"><a href="chapter-9-markov-chain-monte-carlo.html#cb214-10" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( m8<span class="fl">.3</span> , <span class="at">depth=</span><span class="dv">2</span> )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8865639</td>
</tr>
<tr class="even">
<td align="right">1.0505696</td>
</tr>
<tr class="odd">
<td align="right">0.1325055</td>
</tr>
<tr class="even">
<td align="right">-0.1425763</td>
</tr>
<tr class="odd">
<td align="right">0.1094900</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0156751</td>
</tr>
<tr class="even">
<td align="right">0.0099362</td>
</tr>
<tr class="odd">
<td align="right">0.0742018</td>
</tr>
<tr class="even">
<td align="right">0.0547474</td>
</tr>
<tr class="odd">
<td align="right">0.0059347</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8615121</td>
</tr>
<tr class="even">
<td align="right">1.0346896</td>
</tr>
<tr class="odd">
<td align="right">0.0139167</td>
</tr>
<tr class="even">
<td align="right">-0.2300732</td>
</tr>
<tr class="odd">
<td align="right">0.1000051</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9116158</td>
</tr>
<tr class="even">
<td align="right">1.0664496</td>
</tr>
<tr class="odd">
<td align="right">0.2510943</td>
</tr>
<tr class="even">
<td align="right">-0.0550794</td>
</tr>
<tr class="odd">
<td align="right">0.1189748</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that we have an index model instead of indicator variables, thus one alpha and beta for each category. Where 1 = Africa and 2 = all other countries.</p>
<p>Thus we see that alpha parameter (intercept) is positive for both countries, we also set the mean to be positive. And we see that the coefficient for the ruggedness is positive for Africa and negative for the rest of the world.</p>
<p><strong>We will also fit this model using Hamiltonian Monte Carlo</strong></p>
</div>
<div id="fitting-using-hmc" class="section level3" number="10.4.2">
<h3><span class="header-section-number">10.4.2</span> Fitting using HMC</h3>
<p>This section will be separated in two parts:</p>
<div id="preparing-data" class="section level4" number="10.4.2.1">
<h4><span class="header-section-number">10.4.2.1</span> Preparing data</h4>
<p>To do this, one must transform the variables just as we did with the <code>quap</code> method.</p>
<p>Although for this method, we will arrange the data in a list. The benfit is that the different does not have to be of the same length, when arranged in lists.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-1" aria-hidden="true" tabindex="-1"></a>dat_slim <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb215-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_gdp_std =</span> dd<span class="sc">$</span>log_gdp_std,</span>
<span id="cb215-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rugged_std =</span> dd<span class="sc">$</span>rugged_std,</span>
<span id="cb215-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cid =</span> <span class="fu">as.integer</span>(dd<span class="sc">$</span>cid)</span>
<span id="cb215-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb215-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dat_slim)</span></code></pre></div>
<pre><code>## List of 3
##  $ log_gdp_std: num [1:170] 0.88 0.965 1.166 1.104 0.915 ...
##  $ rugged_std : num [1:170] 0.138 0.553 0.124 0.125 0.433 ...
##  $ cid        : int [1:170] 1 2 2 2 2 2 2 2 2 1 ...</code></pre>
</div>
<div id="sampling-from-the-posterior-1" class="section level4" number="10.4.2.2">
<h4><span class="header-section-number">10.4.2.2</span> Sampling from the posterior</h4>
<p>Now we are going to fit the model using ulam, which relies on the stan engine.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-1" aria-hidden="true" tabindex="-1"></a>m9<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb217-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb217-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb217-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a[cid] <span class="sc">+</span> b[cid] <span class="sc">*</span> (rugged_std <span class="sc">-</span> <span class="fl">0.215</span>),</span>
<span id="cb217-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-5" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>,<span class="fl">0.1</span>),</span>
<span id="cb217-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-6" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb217-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb217-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb217-9"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-9" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dat_slim</span>
<span id="cb217-10"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-10" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">1</span> <span class="co">#no of independent chains to sample from</span></span>
<span id="cb217-11"><a href="chapter-9-markov-chain-monte-carlo.html#cb217-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1
## 
## SAMPLING FOR MODEL &#39;f3314e777e4c586121dcc9de98266129&#39; NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 3.6e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.36 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:   1 / 1000 [  0%]  (Warmup)
## Chain 1: Iteration: 100 / 1000 [ 10%]  (Warmup)
## Chain 1: Iteration: 200 / 1000 [ 20%]  (Warmup)
## Chain 1: Iteration: 300 / 1000 [ 30%]  (Warmup)
## Chain 1: Iteration: 400 / 1000 [ 40%]  (Warmup)
## Chain 1: Iteration: 500 / 1000 [ 50%]  (Warmup)
## Chain 1: Iteration: 501 / 1000 [ 50%]  (Sampling)
## Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
## Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
## Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
## Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
## Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0.057177 seconds (Warm-up)
## Chain 1:                0.03605 seconds (Sampling)
## Chain 1:                0.093227 seconds (Total)
## Chain 1:</code></pre>
<p>We see that there is a warmup, that is something about calibrating the model to find the distribution that it should draw from, and then it starts drawing samples.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m9<span class="fl">.1</span>,<span class="at">depth =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8858647</td>
</tr>
<tr class="even">
<td align="right">1.0509446</td>
</tr>
<tr class="odd">
<td align="right">0.1306847</td>
</tr>
<tr class="even">
<td align="right">-0.1426126</td>
</tr>
<tr class="odd">
<td align="right">0.1115789</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0146656</td>
</tr>
<tr class="even">
<td align="right">0.0098105</td>
</tr>
<tr class="odd">
<td align="right">0.0742874</td>
</tr>
<tr class="even">
<td align="right">0.0595235</td>
</tr>
<tr class="odd">
<td align="right">0.0063499</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8628451</td>
</tr>
<tr class="even">
<td align="right">1.0355854</td>
</tr>
<tr class="odd">
<td align="right">0.0112044</td>
</tr>
<tr class="even">
<td align="right">-0.2403829</td>
</tr>
<tr class="odd">
<td align="right">0.1016925</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9092368</td>
</tr>
<tr class="even">
<td align="right">1.0668772</td>
</tr>
<tr class="odd">
<td align="right">0.2464492</td>
</tr>
<tr class="even">
<td align="right">-0.0512215</td>
</tr>
<tr class="odd">
<td align="right">0.1218014</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">498.1959</td>
</tr>
<tr class="even">
<td align="right">662.9343</td>
</tr>
<tr class="odd">
<td align="right">426.8011</td>
</tr>
<tr class="even">
<td align="right">523.4390</td>
</tr>
<tr class="odd">
<td align="right">525.4982</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9981420</td>
</tr>
<tr class="even">
<td align="right">0.9993469</td>
</tr>
<tr class="odd">
<td align="right">0.9986134</td>
</tr>
<tr class="even">
<td align="right">1.0007405</td>
</tr>
<tr class="odd">
<td align="right">0.9979981</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>Now we see that the outcome is the same, although we have two new outputs:</p>
<ol style="list-style-type: decimal">
<li>n_eff: crude estimate of the number of independent samples you managed to get. Due to anti-correlation, we are able to get more effective number of samples than actual samples. With MC, the samples will be correlated in the way, that it is not just taking samples randomly, hence we will always take a sample in a new region. A low n_eff means that the chain is having a hard time exploring the distriubtion.</li>
<li>Rhat4: An indicator of the convergence of the Markov Chains to the target distribution. ‘4’ is just the version of the Rhat (<span class="math inline">\(\hat{R}\)</span>). It is the in chain variation compared to the between chain variation.</li>
</ol>
</div>
<div id="sampling-again-in-parallel" class="section level4" number="10.4.2.3">
<h4><span class="header-section-number">10.4.2.3</span> Sampling again, in parallel</h4>
<p>You can sample different chains in the same time, one for each core in your computer.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-1" aria-hidden="true" tabindex="-1"></a>m9<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb220-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb220-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb220-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a[cid] <span class="sc">+</span> b[cid] <span class="sc">*</span> (rugged_std <span class="sc">-</span> <span class="fl">0.215</span>),</span>
<span id="cb220-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-5" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>,<span class="fl">0.1</span>),</span>
<span id="cb220-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-6" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb220-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb220-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb220-9"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-9" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dat_slim</span>
<span id="cb220-10"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-10" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">4</span> <span class="co">#no of independent chains to sample from</span></span>
<span id="cb220-11"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-11" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores =</span> <span class="dv">4</span> <span class="co">#We use four cores</span></span>
<span id="cb220-12"><a href="chapter-9-markov-chain-monte-carlo.html#cb220-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
</div>
<div id="visualization" class="section level4" number="10.4.2.4">
<h4><span class="header-section-number">10.4.2.4</span> Visualization</h4>
<p>you can plot the sampling, to see the distributions that you find.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(m9<span class="fl">.1</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-118-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Here we see the distribution of the parameters.</p>
</div>
<div id="checking-the-chain" class="section level4" number="10.4.2.5">
<h4><span class="header-section-number">10.4.2.5</span> Checking the chain</h4>
<p>We have two visual tools:</p>
<ol style="list-style-type: decimal">
<li><p>traceplots: here we look for:</p>
<ol style="list-style-type: decimal">
<li><p>Stationarity: we want the line to show no trend and stay within the same boundaries over time</p></li>
<li><p>good mixing: that the chain rapidly explores the full region and not being stuck in regions.</p></li>
<li><p>convergence: that multiple independent chains stick around the same region. When you plot multiple chains it starts getting difficult to see how each chain compares to the others. That is what trank plots is dealing with.</p></li>
</ol></li>
<li><p>trankplots (trace rank plots): We want to see the histograms of the independent chains overlapping each other.</p></li>
</ol>
</div>
</div>
</div>
<div id="care-and-feeding-of-your-markov-chain" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> Care and feeding of your Markov chain</h2>
<p>This section has some illustrations of bad chains. Basically that is just when we see that the probability region is not explored efficiently.</p>
<div id="how-many-samples-do-you-need" class="section level3" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> How many samples do you need?</h3>
<p>Terminalogy (with defaults):</p>
<ul>
<li><p>iter = total number of samples</p></li>
<li><p>warmup = iter/2</p></li>
</ul>
<p>Then how many samples do you need to estimate the posterior? It is all about the effective number of samples. If the chain is autocorrelated, then the n_eff will be lower than the number of iterations, although if it is anti-correlated, then you can have more effective samples than the number of iterations, that is merely due to the fact that some methods are able to outperform randomness of drawing samples.</p>
<p>Now you must ask yourself, do you want to estimate something around the mean or toward the tails of a distribution. If towards the mean, then you dont need many samples (rule of thumb a 100 or a couple 100), but if you want to explore the tails, then you need a lot of samples, as these are more difficult to explore. Thus there is no good rule of thumb in general terms. Also the shape of the posterior distribution that you are trying to map is affecting, if it is simple, then it is easier to map than if it is complex.</p>
<p><em>Notice that stan will let you know if it is uncertain around the tails, thus you need more samples.</em></p>
</div>
<div id="how-many-chains-do-you-need" class="section level3" number="10.5.2">
<h3><span class="header-section-number">10.5.2</span> How many chains do you need?</h3>
<p>Always start with one chain when building the model, as the stan will only return error messages and not just errors, when running 1 chain.</p>
<p>Then run multiple independent chains to cross validate the chains and see how they converge. Typically 3 or 4 chains are sufficient.</p>
</div>
<div id="taming-a-wild-chain" class="section level3" number="10.5.3">
<h3><span class="header-section-number">10.5.3</span> Taming a wild chain</h3>
<p>Basically flat priors or almost flat priors will lead to crazy sampling, as it can explore any region, also totally unrealistic regions. Hence we want to regularize this.</p>
<p>If you have no idea of the priors then go for weakly informative priors, instead of stupid priors, as the likelihood will always outperform these priors.</p>
</div>
</div>
<div id="exercises-5" class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span> Exercises</h2>
<div id="e4" class="section level3" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> E4</h3>
<p><strong>Explain the difference between the effective number of samples, n_eff as calculated by Stan, and the actual number of samples.</strong></p>
<p>n_eff is the effective number of independent samples, hence samples that are not autocorrelated. We see that very efficient samples can get more effective samples than the actual number of samples being drawn.</p>
</div>
<div id="e5" class="section level3" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> E5</h3>
<p>Which value should Rhat approach, when a chain is sampling the posterior distribution correctly? </p>
<p>It should approach 1.</p>
</div>
<div id="e6" class="section level3" number="10.6.3">
<h3><span class="header-section-number">10.6.3</span> E6</h3>
<p>Sketch a good trace plot for a Markov chain, one that is effectively sampling from the posterior distribution. What is good about its shape? Then sketch a trace plot for a malfunctioning Markov chain. What about its shape indicates malfunction? </p>
<p><img src="Images/paste-080982B1.png" /></p>
<p>You want it to be stationary and quickly explore the whole region.</p>
<p>Notice that you should run multiple independent chains and then compare their progress, they should be similar otherwise there is something wrong, perhaps you need to regularize the model.</p>
</div>
<div id="e7" class="section level3" number="10.6.4">
<h3><span class="header-section-number">10.6.4</span> E7</h3>
<p>The same as above, just with a good and a bad traceplot</p>
<p><strong>Bad example:</strong></p>
<p><img src="Images/paste-ECAAEB6A.png" /></p>
<p>We see that they are not overlapping at all. we want them to overlap (them = independent chains) also they must stay within the same area.</p>
<p><strong>Good example:</strong></p>
<p><img src="Images/paste-8C35546D.png" /></p>
<p>Now we see an example where the chains visit the same regions and overlap each other.</p>
</div>
<div id="m1-4" class="section level3" number="10.6.5">
<h3><span class="header-section-number">10.6.5</span> M1</h3>
<p>Reestimate the terrain ruggedness model from the chapter, but now using a uniform prior for the standard deviation, sigma. The uniform prior should be dunif(0,1). Use ulam to estimate the posterior. Does the different prior have any detectible influence on the posterior distribution of sigma? Why or why not?</p>
<p>New sigma prior</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb223-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(<span class="fu">dunif</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">min =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">max =</span> <span class="dv">10</span>),<span class="at">type =</span> <span class="st">&#39;l&#39;</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-119-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Loading the data</span></span>
<span id="cb224-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb224-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged)</span>
<span id="cb224-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> rugged</span>
<span id="cb224-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>log_gdp <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>rgdppc_2000)</span>
<span id="cb224-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-6" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> d[ <span class="fu">complete.cases</span>(d<span class="sc">$</span>rgdppc_2000) , ]</span>
<span id="cb224-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-7" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>log_gdp_std <span class="ot">&lt;-</span> dd<span class="sc">$</span>log_gdp <span class="sc">/</span> <span class="fu">mean</span>(dd<span class="sc">$</span>log_gdp)</span>
<span id="cb224-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-8" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>rugged_std <span class="ot">&lt;-</span> dd<span class="sc">$</span>rugged <span class="sc">/</span> <span class="fu">max</span>(dd<span class="sc">$</span>rugged)</span>
<span id="cb224-9"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-9" aria-hidden="true" tabindex="-1"></a>dd<span class="sc">$</span>cid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( dd<span class="sc">$</span>cont_africa<span class="sc">==</span><span class="dv">1</span> , <span class="dv">1</span> , <span class="dv">2</span> )</span>
<span id="cb224-10"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-11" aria-hidden="true" tabindex="-1"></a><span class="do">### Arrange data in lists</span></span>
<span id="cb224-12"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-12" aria-hidden="true" tabindex="-1"></a>dat_slim <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb224-13"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_gdp_std =</span> dd<span class="sc">$</span>log_gdp_std,</span>
<span id="cb224-14"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">rugged_std =</span> dd<span class="sc">$</span>rugged_std,</span>
<span id="cb224-15"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cid =</span> <span class="fu">as.integer</span>(dd<span class="sc">$</span>cid)</span>
<span id="cb224-16"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-17"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-17" aria-hidden="true" tabindex="-1"></a><span class="co">#str(dat_slim)</span></span>
<span id="cb224-18"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-19"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-20"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-20" aria-hidden="true" tabindex="-1"></a><span class="do">### Fitting the model</span></span>
<span id="cb224-21"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-21" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb224-22"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb224-23"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-23" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb224-24"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-24" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a[cid] <span class="sc">+</span> b[cid] <span class="sc">*</span> (rugged_std <span class="sc">-</span> <span class="fl">0.215</span>),</span>
<span id="cb224-25"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-25" aria-hidden="true" tabindex="-1"></a>    a[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>,<span class="fl">0.1</span>),</span>
<span id="cb224-26"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-26" aria-hidden="true" tabindex="-1"></a>    b[cid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb224-27"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-27" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">1</span>)<span class="co">#dexp(1), this is made uniform now</span></span>
<span id="cb224-28"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb224-29"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-29" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dat_slim</span>
<span id="cb224-30"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-30" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">4</span> <span class="co">#no of independent chains to sample from</span></span>
<span id="cb224-31"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-31" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb224-32"><a href="chapter-9-markov-chain-monte-carlo.html#cb224-32" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m,<span class="at">depth =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8867281</td>
</tr>
<tr class="even">
<td align="right">1.0507249</td>
</tr>
<tr class="odd">
<td align="right">0.1337386</td>
</tr>
<tr class="even">
<td align="right">-0.1433178</td>
</tr>
<tr class="odd">
<td align="right">0.1115693</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.0163498</td>
</tr>
<tr class="even">
<td align="right">0.0103520</td>
</tr>
<tr class="odd">
<td align="right">0.0749311</td>
</tr>
<tr class="even">
<td align="right">0.0553765</td>
</tr>
<tr class="odd">
<td align="right">0.0059534</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.8605278</td>
</tr>
<tr class="even">
<td align="right">1.0340765</td>
</tr>
<tr class="odd">
<td align="right">0.0144557</td>
</tr>
<tr class="even">
<td align="right">-0.2310253</td>
</tr>
<tr class="odd">
<td align="right">0.1021695</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9128546</td>
</tr>
<tr class="even">
<td align="right">1.0674648</td>
</tr>
<tr class="odd">
<td align="right">0.2539857</td>
</tr>
<tr class="even">
<td align="right">-0.0551698</td>
</tr>
<tr class="odd">
<td align="right">0.1213322</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2701.643</td>
</tr>
<tr class="even">
<td align="right">2985.644</td>
</tr>
<tr class="odd">
<td align="right">3016.168</td>
</tr>
<tr class="even">
<td align="right">3128.892</td>
</tr>
<tr class="odd">
<td align="right">2489.884</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9994830</td>
</tr>
<tr class="even">
<td align="right">0.9996878</td>
</tr>
<tr class="odd">
<td align="right">0.9993892</td>
</tr>
<tr class="even">
<td align="right">0.9986548</td>
</tr>
<tr class="odd">
<td align="right">1.0000279</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(m)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-121-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">traceplot</span>(m)</span></code></pre></div>
<pre><code>## [1] 1000
## [1] 1
## [1] 1000</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">trankplot</span>(m)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-121-2.png" width="720" style="display: block; margin: auto;" /><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-121-3.png" width="720" style="display: block; margin: auto;" /></p>
<p>It is difficult to see from the traceplot, as the y scale is so large, hence we inspect the trank plot. We see that sigma in the trank plot is controlled randomness, as it is stationary. Based on the n_eff, we also have an indication of a healthy chain.</p>
</div>
<div id="h2-2" class="section level3" number="10.6.6">
<h3><span class="header-section-number">10.6.6</span> H2</h3>
<p>Recall the divorce rate example from Chapter 5. Repeat that analysis, using ulam this time, fitting models m5.1, m5.2, and m5.3. Use compare to compare the models on the basis of WAIC or PSIS. To use WAIC or PSIS with ulam, you need add the argument log_log=TRUE. Explain the model comparison results.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load data and copy</span></span>
<span id="cb231-2"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb231-3"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce)</span>
<span id="cb231-4"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span>WaffleDivorce</span>
<span id="cb231-5"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-6"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-6" aria-hidden="true" tabindex="-1"></a><span class="co"># standardize variables</span></span>
<span id="cb231-7"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-7" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>D <span class="ot">&lt;-</span><span class="fu">standardize</span>(d<span class="sc">$</span>Divorce)</span>
<span id="cb231-8"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-8" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>M <span class="ot">&lt;-</span><span class="fu">standardize</span>(d<span class="sc">$</span>Marriage)</span>
<span id="cb231-9"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-9" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>A <span class="ot">&lt;-</span><span class="fu">standardize</span>(d<span class="sc">$</span>MedianAgeMarriage)</span>
<span id="cb231-10"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-11"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-11" aria-hidden="true" tabindex="-1"></a>dl <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb231-12"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> d<span class="sc">$</span>D,</span>
<span id="cb231-13"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> d<span class="sc">$</span>M,</span>
<span id="cb231-14"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> d<span class="sc">$</span>A</span>
<span id="cb231-15"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb231-16"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-17"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Models</span></span>
<span id="cb231-18"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-18" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.1</span> <span class="ot">&lt;-</span><span class="fu">ulam</span>(</span>
<span id="cb231-19"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb231-20"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-20" aria-hidden="true" tabindex="-1"></a>      D <span class="sc">~</span> <span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb231-21"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-21" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a<span class="sc">+</span>bA<span class="sc">*</span>A,</span>
<span id="cb231-22"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-22" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),</span>
<span id="cb231-23"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-23" aria-hidden="true" tabindex="-1"></a>      bA <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb231-24"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-24" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb231-25"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-26"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-26" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dl</span>
<span id="cb231-27"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-27" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb231-28"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-28" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb231-29"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-29" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb231-30"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-31"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-32"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-32" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb231-33"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb231-34"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-34" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span><span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb231-35"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-35" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>a<span class="sc">+</span>bM<span class="sc">*</span>M,</span>
<span id="cb231-36"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-36" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),</span>
<span id="cb231-37"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-37" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb231-38"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-38" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span><span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb231-39"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-40"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-40" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dl</span>
<span id="cb231-41"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-41" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb231-42"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-42" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb231-43"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-43" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb231-44"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-45"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-46"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-46" aria-hidden="true" tabindex="-1"></a>m5<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb231-47"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb231-48"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-48" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span><span class="fu">dnorm</span>(mu,sigma),</span>
<span id="cb231-49"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-49" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span>a<span class="sc">+</span>bM<span class="sc">*</span>M<span class="sc">+</span>bA<span class="sc">*</span>A,</span>
<span id="cb231-50"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-50" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.2</span>),</span>
<span id="cb231-51"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-51" aria-hidden="true" tabindex="-1"></a>    bM <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb231-52"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-52" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">~</span><span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb231-53"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-53" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span><span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb231-54"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb231-55"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-55" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data =</span> dl</span>
<span id="cb231-56"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-56" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb231-57"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-57" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb231-58"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-58" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb231-59"><a href="chapter-9-markov-chain-monte-carlo.html#cb231-59" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(m5<span class="fl">.1</span>,m5<span class="fl">.2</span>,m5<span class="fl">.3</span>,<span class="at">func =</span> WAIC)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">125.4488</td>
</tr>
<tr class="even">
<td align="right">127.2186</td>
</tr>
<tr class="odd">
<td align="right">139.5741</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">12.541435</td>
</tr>
<tr class="even">
<td align="right">12.461849</td>
</tr>
<tr class="odd">
<td align="right">9.941827</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="right">1.769792</td>
</tr>
<tr class="odd">
<td align="right">14.125334</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">0.7826801</td>
</tr>
<tr class="odd">
<td align="right">9.1954176</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">3.502556</td>
</tr>
<tr class="even">
<td align="right">4.553221</td>
</tr>
<tr class="odd">
<td align="right">3.089915</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.7074069</td>
</tr>
<tr class="even">
<td align="right">0.2919872</td>
</tr>
<tr class="odd">
<td align="right">0.0006059</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that if we had to bet money on a model, then 73% of the time m5.1 will win. Although m5.1 and m5.3 is very close to each other.</p>
<p>We can plot this, to get some more information.</p>
<p>We see in the following that the difference between the two bebst models is not overlapping, there is evidance for m5.1 being the best model.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">compare</span>(m5<span class="fl">.1</span>,m5<span class="fl">.2</span>,m5<span class="fl">.3</span>,<span class="at">func =</span> WAIC))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-124-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>We can also infer m5.3 with precis:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="chapter-9-markov-chain-monte-carlo.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m5<span class="fl">.3</span>)</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.0003419</td>
</tr>
<tr class="even">
<td align="right">-0.0620352</td>
</tr>
<tr class="odd">
<td align="right">-0.6047266</td>
</tr>
<tr class="even">
<td align="right">0.8267152</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.1038669</td>
</tr>
<tr class="even">
<td align="right">0.1529105</td>
</tr>
<tr class="odd">
<td align="right">0.1582625</td>
</tr>
<tr class="even">
<td align="right">0.0851038</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.1681428</td>
</tr>
<tr class="even">
<td align="right">-0.3156486</td>
</tr>
<tr class="odd">
<td align="right">-0.8589818</td>
</tr>
<tr class="even">
<td align="right">0.7063440</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.1593920</td>
</tr>
<tr class="even">
<td align="right">0.1727689</td>
</tr>
<tr class="odd">
<td align="right">-0.3556521</td>
</tr>
<tr class="even">
<td align="right">0.9758495</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1798.5895</td>
</tr>
<tr class="even">
<td align="right">912.0222</td>
</tr>
<tr class="odd">
<td align="right">985.7789</td>
</tr>
<tr class="even">
<td align="right">1177.4471</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.9991294</td>
</tr>
<tr class="even">
<td align="right">1.0005127</td>
</tr>
<tr class="odd">
<td align="right">0.9995050</td>
</tr>
<tr class="even">
<td align="right">0.9988082</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p>We see that <code>marriage</code> has a mean of -0.07 and the standard deviation is on both sides of 0, hence <code>marriage</code> does not include any information, as all information is in the <code>age</code> variable.</p>
</div>
</div>
<div id="lecture-notes" class="section level2" number="10.7">
<h2><span class="header-section-number">10.7</span> Lecture notes</h2>
<p>Why Markov Chains?</p>
<ul>
<li>We see that markov chains is not only used in bayesian data analysis, but also for frequentist statistics.</li>
</ul>
<p>Recap:</p>
<p><img src="Images/paste-7B8AD3B8.png" /></p>
<p>Why cant we use quadratic approximation: it is effective for simple models, we see that with flat priors it is the same as classical statistics. Although, when it gets more complicated, this approach will not be feasibile.</p>
<p>Case with Markov Chains:</p>
<ul>
<li><p>Will always find the posterior distribution after time. Although it only works on the long run. But the MCMC method may need to run in a long long long time, hence that is a drawback of MCMC.</p></li>
<li><p>This is also called the metropolis algorithm. That is from the researcher Nicholas Metropolis, this originates in the research of making fusion bombs.</p></li>
</ul>
<p>What is a chain? It is a simulation of chained events. WHere Markov Chain is a sequential simulation, where you can go to different outcomes, based on the current state and not the passed states. Hence it has no memory, this is often an advantage.</p>
<p>Monte Carlo is coming from the city, where people gamble, hence there is not too much about this.</p>
<p>MCMC is an engine of making integration. Hence it takes something very hard make simplify it.</p>
<p><strong>Different strategies of MCMC:</strong></p>
<ol style="list-style-type: decimal">
<li>Metropolis</li>
<li>Metropolis Hastings</li>
<li>Gibbs sampling: an efficient version of bullet 2, although in a Silow dimensional setting</li>
<li>Hamiltonian Monte Carlo (HMC): This does not guess and check. This is more efficient even with very complicated models.</li>
</ol>
<p><em>Metropolis and Gibbs: is a guess and check method. This is now a thing of the past</em></p>
<p>This is an example, where MH sampling is not working well: <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=RandomWalkMH&amp;target=banana" class="uri">https://chi-feng.github.io/mcmc-demo/app.html?algorithm=RandomWalkMH&amp;target=banana</a></p>
<p>The site also have different examples. Key tuning parameter is the step size, we see that the larger the step size, the more different places it will suggest.</p>
<p>We see that the HMC runs a physical simulation, where it is trying to map the probability distribution. How:</p>
<ul>
<li>It is set randomly, and the follows the slope of the probability mass. Then it is being flicked, and then it follows the slope again.</li>
</ul>
<p>HMC has the following tuning parameters:</p>
<ol style="list-style-type: decimal">
<li>Momentum, is random</li>
<li>Step size, must be tuned.</li>
<li>Adaptive speed, when it goes downwards, then the velocity is decreasing and when it goes upwards, then the velocity is decreasing. See a video on how this works here: <a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=HamiltonianMC&amp;target=banana" class="uri">https://chi-feng.github.io/mcmc-demo/app.html?algorithm=HamiltonianMC&amp;target=banana</a> we see that the direction may be set, although the ‘gravitation’ will bend the direction. It is calculating the gradient in each point, to estimate the slope, thus it is mathematically more complicated, although it means that all proposals are acceptet.</li>
<li>It will run for some fixed time! This is also a tuning parameter. This is called a leapfrog step. We define how many jumps the algorithm can take before the sample proposal is drawn.</li>
</ol>
<p>Hence HMC, is flicking the particle, that will roll according to the slope, where the momentum is random each time.</p>
<p>We see that each step takes more time to compute in HMC compared to the random samplers, such as Gibbs. Although it requires way less observations.</p>
<p><strong>HMC is basically a gradient descent method to end in a region with a probability mass, where it should always tend towards the probability mass.</strong></p>
<p>HMC problems:</p>
<p>The U-turn phenomenon:</p>
<p><img src="Images/paste-62BF6BC6.png" /></p>
<p>We see that we end up in the same place as we started in the right scenario. Try to follow this link:<a href="https://chi-feng.github.io/mcmc-demo/app.html?algorithm=NaiveNUTS&amp;target=banana" class="uri">https://chi-feng.github.io/mcmc-demo/app.html?algorithm=NaiveNUTS&amp;target=banana</a>, select the standard distribution and increase the leopfrog steps(about 65) .</p>
<p>There is a NUTS (no u turn) method. This method is going back and forwards and seeing when it starts turning. Then it stops and takes a sample. This means that we dont need to define the no. of leapfrog steps, hence it is adaptive to where it starts.</p>
<p>The problem of no u turn sampler, is if we have a multimodal distribution (multiple hills), it has a tendency to get stuck in one of the hills. As it needs enough speed to break lose the gravity around probability mass.</p>
<p>For diagnosis, see the slides, there are some examples and notes.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-8-model-comparison.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
