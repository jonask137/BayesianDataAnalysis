<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Ch 14 - Advuntetures in Coviaraince | Bayesian Data Analysis Notes</title>
  <meta name="description" content="14 Ch 14 - Advuntetures in Coviaraince | Bayesian Data Analysis Notes" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Ch 14 - Advuntetures in Coviaraince | Bayesian Data Analysis Notes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Ch 14 - Advuntetures in Coviaraince | Bayesian Data Analysis Notes" />
  
  
  

<meta name="author" content="Jonas Ringive Korsholm" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ch-13-models-with-memory.html"/>
<link rel="next" href="ch-14-adventures-in-covariance.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="chapter-1-golems-of-prague.html"><a href="chapter-1-golems-of-prague.html"><i class="fa fa-check"></i><b>1</b> Chapter 1 - Golems of Prague</a></li>
<li class="chapter" data-level="2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html"><i class="fa fa-check"></i><b>2</b> Chapter 2 - Small worlds and Large Worlds</a>
<ul>
<li class="chapter" data-level="2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#models-and-estimation"><i class="fa fa-check"></i><b>2.1</b> Models and Estimation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#engines-motors-to-estimate-the-models"><i class="fa fa-check"></i><b>2.1.1</b> Engines / Motors to estimate the models</a>
<ul>
<li class="chapter" data-level="2.1.1.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#grid-approximation"><i class="fa fa-check"></i><b>2.1.1.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.1.1.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#quadratic-approximation"><i class="fa fa-check"></i><b>2.1.1.2</b> Quadratic approximation</a></li>
<li class="chapter" data-level="2.1.1.3" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.1.1.3</b> Markov Chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#exercises"><i class="fa fa-check"></i><b>2.2</b> Exercises</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m1"><i class="fa fa-check"></i><b>2.2.1</b> 2M1</a></li>
<li class="chapter" data-level="2.2.2" data-path="chapter-2-small-worlds-and-large-worlds.html"><a href="chapter-2-small-worlds-and-large-worlds.html#m2"><i class="fa fa-check"></i><b>2.2.2</b> 2M2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html"><i class="fa fa-check"></i><b>3</b> Chapter 3 - Sampling the Imaginary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>3.1</b> Sampling from a grid-approximate posterior</a></li>
<li class="chapter" data-level="3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-summarize"><i class="fa fa-check"></i><b>3.2</b> Sampling to summarize</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-boundaries"><i class="fa fa-check"></i><b>3.2.1</b> Defined Boundaries</a></li>
<li class="chapter" data-level="3.2.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#defined-probability-mass"><i class="fa fa-check"></i><b>3.2.2</b> Defined Probability Mass</a></li>
<li class="chapter" data-level="3.2.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#point-estimates"><i class="fa fa-check"></i><b>3.2.3</b> Point Estimates</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#sampling-to-simulate-prediction"><i class="fa fa-check"></i><b>3.3</b> Sampling to simulate prediction</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#dummy-data"><i class="fa fa-check"></i><b>3.3.1</b> Dummy Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#model-checking"><i class="fa fa-check"></i><b>3.3.2</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m1-1"><i class="fa fa-check"></i><b>3.4.1</b> 3M1</a></li>
<li class="chapter" data-level="3.4.2" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m2-1"><i class="fa fa-check"></i><b>3.4.2</b> 3M2</a></li>
<li class="chapter" data-level="3.4.3" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m3"><i class="fa fa-check"></i><b>3.4.3</b> 3M3</a></li>
<li class="chapter" data-level="3.4.4" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m4"><i class="fa fa-check"></i><b>3.4.4</b> 3M4</a></li>
<li class="chapter" data-level="3.4.5" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#m5"><i class="fa fa-check"></i><b>3.4.5</b> 3M5</a></li>
<li class="chapter" data-level="3.4.6" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h1"><i class="fa fa-check"></i><b>3.4.6</b> 3H1</a></li>
<li class="chapter" data-level="3.4.7" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h2"><i class="fa fa-check"></i><b>3.4.7</b> 3H2</a></li>
<li class="chapter" data-level="3.4.8" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h3"><i class="fa fa-check"></i><b>3.4.8</b> 3H3</a></li>
<li class="chapter" data-level="3.4.9" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h4"><i class="fa fa-check"></i><b>3.4.9</b> 3H4</a></li>
<li class="chapter" data-level="3.4.10" data-path="chapter-3-sampling-the-imaginary.html"><a href="chapter-3-sampling-the-imaginary.html#h5"><i class="fa fa-check"></i><b>3.4.10</b> 3H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="geocentric-models.html"><a href="geocentric-models.html"><i class="fa fa-check"></i><b>4</b> Geocentric Models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>4.1</b> Why Normal distributions are normal</a></li>
<li class="chapter" data-level="4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>4.2</b> A language for describing models</a></li>
<li class="chapter" data-level="4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>4.3</b> Gaussian model of height</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-model"><i class="fa fa-check"></i><b>4.3.1</b> The model</a></li>
<li class="chapter" data-level="4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#grid-approximation-of-the-posterior-distribution"><i class="fa fa-check"></i><b>4.3.2</b> Grid approximation of the posterior distribution</a></li>
<li class="chapter" data-level="4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-the-posterior"><i class="fa fa-check"></i><b>4.3.3</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution-with-quap"><i class="fa fa-check"></i><b>4.3.4</b> Finding the posterior distribution with quap</a></li>
<li class="chapter" data-level="4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#sampling-from-a-quap"><i class="fa fa-check"></i><b>4.3.5</b> Sampling from a quap</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="geocentric-models.html"><a href="geocentric-models.html#linear-prediction"><i class="fa fa-check"></i><b>4.4</b> Linear prediction</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-lienar-mdoel-strategy"><i class="fa fa-check"></i><b>4.4.1</b> The lienar mdoel strategy</a></li>
<li class="chapter" data-level="4.4.2" data-path="geocentric-models.html"><a href="geocentric-models.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.2</b> Finding the posterior distribution</a></li>
<li class="chapter" data-level="4.4.3" data-path="geocentric-models.html"><a href="geocentric-models.html#interpreting-the-posterior-distribution"><i class="fa fa-check"></i><b>4.4.3</b> Interpreting the posterior distribution</a>
<ul>
<li class="chapter" data-level="4.4.3.1" data-path="geocentric-models.html"><a href="geocentric-models.html#tables-fo-marginal-distributions"><i class="fa fa-check"></i><b>4.4.3.1</b> Tables fo marginal distributions</a></li>
<li class="chapter" data-level="4.4.3.2" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-posterior-inference-against-the-data"><i class="fa fa-check"></i><b>4.4.3.2</b> Plotting posterior inference against the data</a></li>
<li class="chapter" data-level="4.4.3.3" data-path="geocentric-models.html"><a href="geocentric-models.html#adding-uncertainty-around-the-mean"><i class="fa fa-check"></i><b>4.4.3.3</b> Adding uncertainty around the mean</a></li>
<li class="chapter" data-level="4.4.3.4" data-path="geocentric-models.html"><a href="geocentric-models.html#plotting-regression-intervlas-and-contours"><i class="fa fa-check"></i><b>4.4.3.4</b> Plotting regression intervlas and contours</a></li>
<li class="chapter" data-level="4.4.3.5" data-path="geocentric-models.html"><a href="geocentric-models.html#prediction-intevals"><i class="fa fa-check"></i><b>4.4.3.5</b> Prediction intevals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="geocentric-models.html"><a href="geocentric-models.html#curves-form-lines"><i class="fa fa-check"></i><b>4.5</b> Curves form lines</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#polynomial-regression"><i class="fa fa-check"></i><b>4.5.1</b> Polynomial regression</a></li>
<li class="chapter" data-level="4.5.2" data-path="geocentric-models.html"><a href="geocentric-models.html#splines"><i class="fa fa-check"></i><b>4.5.2</b> Splines</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="geocentric-models.html"><a href="geocentric-models.html#exercises-2"><i class="fa fa-check"></i><b>4.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="geocentric-models.html"><a href="geocentric-models.html#m1-2"><i class="fa fa-check"></i><b>4.6.1</b> 4M1</a></li>
<li class="chapter" data-level="4.6.2" data-path="geocentric-models.html"><a href="geocentric-models.html#m8"><i class="fa fa-check"></i><b>4.6.2</b> 4M8</a></li>
<li class="chapter" data-level="4.6.3" data-path="geocentric-models.html"><a href="geocentric-models.html#h1-1"><i class="fa fa-check"></i><b>4.6.3</b> 4H1</a></li>
<li class="chapter" data-level="4.6.4" data-path="geocentric-models.html"><a href="geocentric-models.html#h2-1"><i class="fa fa-check"></i><b>4.6.4</b> 4H2</a></li>
<li class="chapter" data-level="4.6.5" data-path="geocentric-models.html"><a href="geocentric-models.html#h3-1"><i class="fa fa-check"></i><b>4.6.5</b> 4H3</a>
<ul>
<li class="chapter" data-level="4.6.5.1" data-path="geocentric-models.html"><a href="geocentric-models.html#the-same-but-using-log-of-weight"><i class="fa fa-check"></i><b>4.6.5.1</b> The same but using log of weight</a></li>
</ul></li>
<li class="chapter" data-level="4.6.6" data-path="geocentric-models.html"><a href="geocentric-models.html#h6"><i class="fa fa-check"></i><b>4.6.6</b> 4H6</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lecture-notes-wrap-up-chapters-geocentric-models.html"><a href="lecture-notes-wrap-up-chapters-geocentric-models.html"><i class="fa fa-check"></i><b>5</b> Lecture notes - wrap up chapters geocentric models</a></li>
<li class="chapter" data-level="6" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html"><i class="fa fa-check"></i><b>6</b> Chapter 5 - The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#spurious-associations"><i class="fa fa-check"></i><b>6.1</b> Spurious Associations</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#defining-a-multiple-regression"><i class="fa fa-check"></i><b>6.1.1</b> Defining a multiple regression</a></li>
<li class="chapter" data-level="6.1.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#approximating-the-posterior"><i class="fa fa-check"></i><b>6.1.2</b> Approximating the posterior</a></li>
<li class="chapter" data-level="6.1.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#the-flow"><i class="fa fa-check"></i><b>6.1.3</b> The flow</a>
<ul>
<li class="chapter" data-level="6.1.3.1" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#posterior-prediction-plots"><i class="fa fa-check"></i><b>6.1.3.1</b> Posterior Prediction Plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#masked-relationship"><i class="fa fa-check"></i><b>6.2</b> Masked Relationship</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#categorical-variables"><i class="fa fa-check"></i><b>6.3</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-5-the-many-variables-the-spurious-waffles.html"><a href="chapter-5-the-many-variables-the-spurious-waffles.html#lecture-notes---not-integrated-in-the-notes"><i class="fa fa-check"></i><b>6.4</b> Lecture notes - not integrated in the notes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html"><i class="fa fa-check"></i><b>7</b> Chapter 6 - The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#multicollinearity"><i class="fa fa-check"></i><b>7.1</b> Multicollinearity</a></li>
<li class="chapter" data-level="7.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post Treatment Bias</a></li>
<li class="chapter" data-level="7.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias</a></li>
<li class="chapter" data-level="7.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#confronting-confounding"><i class="fa fa-check"></i><b>7.4</b> Confronting Confounding</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#exercises-3"><i class="fa fa-check"></i><b>7.5</b> Exercises</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m1-3"><i class="fa fa-check"></i><b>7.5.1</b> 6M1</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#m3-1"><i class="fa fa-check"></i><b>7.5.2</b> 6M3</a></li>
<li class="chapter" data-level="7.5.3" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h"><i class="fa fa-check"></i><b>7.5.3</b> 6H</a></li>
<li class="chapter" data-level="7.5.4" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h3-2"><i class="fa fa-check"></i><b>7.5.4</b> 6H3</a></li>
<li class="chapter" data-level="7.5.5" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h4-1"><i class="fa fa-check"></i><b>7.5.5</b> 6H4</a></li>
<li class="chapter" data-level="7.5.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#h5-1"><i class="fa fa-check"></i><b>7.5.6</b> 6H5</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-6-the-haunted-dag-the-causal-terror.html"><a href="chapter-6-the-haunted-dag-the-causal-terror.html#lecture-notes---not-integrated-in-the-text"><i class="fa fa-check"></i><b>7.6</b> Lecture notes - not integrated in the text</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html"><i class="fa fa-check"></i><b>8</b> Chapter 7 - Model comparison</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The problem with parameters</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy</a></li>
<li class="chapter" data-level="8.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem Taming: Regularization</a></li>
<li class="chapter" data-level="8.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#predicting-predictive-accuracy"><i class="fa fa-check"></i><b>8.4</b> Predicting predictive accuracy</a></li>
<li class="chapter" data-level="8.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#model-comparison"><i class="fa fa-check"></i><b>8.5</b> Model Comparison</a></li>
<li class="chapter" data-level="8.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#exercies"><i class="fa fa-check"></i><b>8.6</b> Exercies</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m3-2"><i class="fa fa-check"></i><b>8.6.1</b> 7M3</a></li>
<li class="chapter" data-level="8.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m4-1"><i class="fa fa-check"></i><b>8.6.2</b> 7M4</a></li>
<li class="chapter" data-level="8.6.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m5-1"><i class="fa fa-check"></i><b>8.6.3</b> 7M5</a></li>
<li class="chapter" data-level="8.6.4" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#m6"><i class="fa fa-check"></i><b>8.6.4</b> 7M6</a></li>
<li class="chapter" data-level="8.6.5" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h1-2"><i class="fa fa-check"></i><b>8.6.5</b> 7H1</a></li>
<li class="chapter" data-level="8.6.6" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h2-2"><i class="fa fa-check"></i><b>8.6.6</b> 7H2</a>
<ul>
<li class="chapter" data-level="8.6.6.1" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#identify-the-outlier"><i class="fa fa-check"></i><b>8.6.6.1</b> (1) Identify the outlier</a></li>
<li class="chapter" data-level="8.6.6.2" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#inspect-model-predictions"><i class="fa fa-check"></i><b>8.6.6.2</b> (2) Inspect model predictions</a></li>
<li class="chapter" data-level="8.6.6.3" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#using-students-t-distribution"><i class="fa fa-check"></i><b>8.6.6.3</b> (3) Using students t distribution</a></li>
</ul></li>
<li class="chapter" data-level="8.6.7" data-path="chapter-7-model-comparison.html"><a href="chapter-7-model-comparison.html#h5-2"><i class="fa fa-check"></i><b>8.6.7</b> 7H5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html"><i class="fa fa-check"></i><b>9</b> Chapter 8 - Model comparison</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an interaction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#adding-an-indicator-variable-isnt-enough."><i class="fa fa-check"></i><b>9.1.1</b> Adding an indicator variable isn’t enough.</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symmetry of interactions</a></li>
<li class="chapter" data-level="9.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#continuous-interactions"><i class="fa fa-check"></i><b>9.3</b> Continuous interactions</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#a-winter-flower"><i class="fa fa-check"></i><b>9.3.1</b> A Winter Flower</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#the-models"><i class="fa fa-check"></i><b>9.3.2</b> The models</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting posterior predictions</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting prior predictions</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#exercises-4"><i class="fa fa-check"></i><b>9.4</b> Exercises</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#m4-2"><i class="fa fa-check"></i><b>9.4.1</b> 8M4</a>
<ul>
<li class="chapter" data-level="9.4.1.1" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#interaction-model"><i class="fa fa-check"></i><b>9.4.1.1</b> Interaction model</a></li>
<li class="chapter" data-level="9.4.1.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#conclusion"><i class="fa fa-check"></i><b>9.4.1.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-8-model-comparison.html"><a href="chapter-8-model-comparison.html#h3-3"><i class="fa fa-check"></i><b>9.4.2</b> 8H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html"><i class="fa fa-check"></i><b>10</b> Chapter 9 - Markov Chain Monte Carlo</a>
<ul>
<li class="chapter" data-level="10.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#good-king-markov-and-his-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> Good King Markov and his island kingdom</a></li>
<li class="chapter" data-level="10.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#metropolis-algorithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algorithms</a></li>
<li class="chapter" data-level="10.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="10.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#easy-hmc-ulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: ulam</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-quap"><i class="fa fa-check"></i><b>10.4.1</b> Fitting using quap</a></li>
<li class="chapter" data-level="10.4.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#fitting-using-hmc"><i class="fa fa-check"></i><b>10.4.2</b> Fitting using HMC</a>
<ul>
<li class="chapter" data-level="10.4.2.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#preparing-data"><i class="fa fa-check"></i><b>10.4.2.1</b> Preparing data</a></li>
<li class="chapter" data-level="10.4.2.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-from-the-posterior-1"><i class="fa fa-check"></i><b>10.4.2.2</b> Sampling from the posterior</a></li>
<li class="chapter" data-level="10.4.2.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#sampling-again-in-parallel"><i class="fa fa-check"></i><b>10.4.2.3</b> Sampling again, in parallel</a></li>
<li class="chapter" data-level="10.4.2.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#visualization"><i class="fa fa-check"></i><b>10.4.2.4</b> Visualization</a></li>
<li class="chapter" data-level="10.4.2.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.2.5</b> Checking the chain</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov chain</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-samples-do-you-need"><i class="fa fa-check"></i><b>10.5.1</b> How many samples do you need?</a></li>
<li class="chapter" data-level="10.5.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#how-many-chains-do-you-need"><i class="fa fa-check"></i><b>10.5.2</b> How many chains do you need?</a></li>
<li class="chapter" data-level="10.5.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#taming-a-wild-chain"><i class="fa fa-check"></i><b>10.5.3</b> Taming a wild chain</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#exercises-5"><i class="fa fa-check"></i><b>10.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e4"><i class="fa fa-check"></i><b>10.6.1</b> E4</a></li>
<li class="chapter" data-level="10.6.2" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e5"><i class="fa fa-check"></i><b>10.6.2</b> E5</a></li>
<li class="chapter" data-level="10.6.3" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e6"><i class="fa fa-check"></i><b>10.6.3</b> E6</a></li>
<li class="chapter" data-level="10.6.4" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#e7"><i class="fa fa-check"></i><b>10.6.4</b> E7</a></li>
<li class="chapter" data-level="10.6.5" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#m1-4"><i class="fa fa-check"></i><b>10.6.5</b> M1</a></li>
<li class="chapter" data-level="10.6.6" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#h2-3"><i class="fa fa-check"></i><b>10.6.6</b> H2</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="chapter-9-markov-chain-monte-carlo.html"><a href="chapter-9-markov-chain-monte-carlo.html#lecture-notes"><i class="fa fa-check"></i><b>10.7</b> Lecture notes</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html"><i class="fa fa-check"></i><b>11</b> Big Entropy and the Generalized Linear Model</a>
<ul>
<li class="chapter" data-level="11.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#binomial"><i class="fa fa-check"></i><b>11.1.1</b> Binomial</a>
<ul>
<li class="chapter" data-level="11.1.1.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#example-from-the-lecture"><i class="fa fa-check"></i><b>11.1.1.1</b> Example from the lecture</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear models</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the family</a></li>
<li class="chapter" data-level="11.2.2" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="big-entropy-and-the-generalized-linear-model.html"><a href="big-entropy-and-the-generalized-linear-model.html#maximum-entropy-priors"><i class="fa fa-check"></i><b>11.3</b> Maximum entropy priors</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html"><i class="fa fa-check"></i><b>12</b> God Spiked the Integers</a>
<ul>
<li class="chapter" data-level="12.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression</a>
<ul>
<li class="chapter" data-level="12.1.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.0.1</b> Logistic regression: Prosocial chimpanzees:</a></li>
<li class="chapter" data-level="12.1.0.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.0.2</b> Relative shark and absolute deer</a></li>
<li class="chapter" data-level="12.1.0.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-chimpanzees-again-condensed."><i class="fa fa-check"></i><b>12.1.0.3</b> Aggregated binomial: Chimpanzees again, condensed.</a></li>
<li class="chapter" data-level="12.1.0.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.0.4</b> Aggregated binomial: Graduate school admissions</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression</a>
<ul>
<li class="chapter" data-level="12.2.0.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#negative-binomial-gamma-poisson-models."><i class="fa fa-check"></i><b>12.2.0.1</b> Negative binomial (gamma-poisson) models.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#multinomial-regression"><i class="fa fa-check"></i><b>12.3</b> Multinomial Regression</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#example-from-the-lecture-1"><i class="fa fa-check"></i><b>12.3.1</b> Example from the lecture</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#exercies-1"><i class="fa fa-check"></i><b>12.4</b> Exercies</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e1"><i class="fa fa-check"></i><b>12.4.1</b> E1</a></li>
<li class="chapter" data-level="12.4.2" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e2"><i class="fa fa-check"></i><b>12.4.2</b> E2</a></li>
<li class="chapter" data-level="12.4.3" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#e3"><i class="fa fa-check"></i><b>12.4.3</b> E3</a></li>
<li class="chapter" data-level="12.4.4" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#m7"><i class="fa fa-check"></i><b>12.4.4</b> M7</a></li>
<li class="chapter" data-level="12.4.5" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h1-3"><i class="fa fa-check"></i><b>12.4.5</b> H1</a></li>
<li class="chapter" data-level="12.4.6" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h2-4"><i class="fa fa-check"></i><b>12.4.6</b> H2</a></li>
<li class="chapter" data-level="12.4.7" data-path="god-spiked-the-integers.html"><a href="god-spiked-the-integers.html#h3-4"><i class="fa fa-check"></i><b>12.4.7</b> H3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html"><i class="fa fa-check"></i><b>13</b> Ch 13 - Models with Memory</a>
<ul>
<li class="chapter" data-level="13.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#example-multilevel-tadpoles"><i class="fa fa-check"></i><b>13.1</b> Example: Multilevel tadpoles</a></li>
<li class="chapter" data-level="13.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-effects-and-the-underfitting-overfitting-trade-off"><i class="fa fa-check"></i><b>13.2</b> Varying effects and the underfitting / overfitting trade-off</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-model-1"><i class="fa fa-check"></i><b>13.2.1</b> The model</a></li>
<li class="chapter" data-level="13.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#assign-values-to-the-parameters"><i class="fa fa-check"></i><b>13.2.2</b> Assign values to the parameters</a></li>
<li class="chapter" data-level="13.2.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#simulate-survivors"><i class="fa fa-check"></i><b>13.2.3</b> Simulate survivors</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>13.3</b> More than one type of cluster</a></li>
<li class="chapter" data-level="13.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>13.4</b> Divergent transitions and non-centered priors</a>
<ul>
<li class="chapter" data-level="13.4.0.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#the-devils-funnel-example"><i class="fa fa-check"></i><b>13.4.0.1</b> The Devil’s Funnel: (example)</a></li>
<li class="chapter" data-level="13.4.0.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#non-centered-chimpanzees-example"><i class="fa fa-check"></i><b>13.4.0.2</b> Non-centered chimpanzees (example)</a>
<ul>
<li class="chapter" data-level="13.4.0.2.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-1-centered-parameterization-increasing-acceptance-rate"><i class="fa fa-check"></i><b>13.4.0.2.1</b> Solution 1: Centered parameterization (Increasing acceptance rate)</a></li>
<li class="chapter" data-level="13.4.0.2.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#solution-2-non-centered-version-reparameterize"><i class="fa fa-check"></i><b>13.4.0.2.2</b> Solution 2: Non-centered version (reparameterize)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>13.5</b> Multilevel posterior predictions</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>13.5.1</b> Posterior prediction for same clusters</a></li>
<li class="chapter" data-level="13.5.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#posterior-prediction-for-new-clusters"><i class="fa fa-check"></i><b>13.5.2</b> Posterior prediction for new clusters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#exercises-6"><i class="fa fa-check"></i><b>13.6</b> Exercises</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e1-1"><i class="fa fa-check"></i><b>13.6.1</b> E1</a></li>
<li class="chapter" data-level="13.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e2-1"><i class="fa fa-check"></i><b>13.6.2</b> E2</a></li>
<li class="chapter" data-level="13.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e3-1"><i class="fa fa-check"></i><b>13.6.3</b> E3</a></li>
<li class="chapter" data-level="13.6.4" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#e4-1"><i class="fa fa-check"></i><b>13.6.4</b> E4</a></li>
<li class="chapter" data-level="13.6.5" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#m1-5"><i class="fa fa-check"></i><b>13.6.5</b> M1</a></li>
<li class="chapter" data-level="13.6.6" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#h1-4"><i class="fa fa-check"></i><b>13.6.6</b> H1</a>
<ul>
<li class="chapter" data-level="13.6.6.1" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#fixed-effects-model"><i class="fa fa-check"></i><b>13.6.6.1</b> Fixed effects model:</a></li>
<li class="chapter" data-level="13.6.6.2" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#varying-intercepts-model"><i class="fa fa-check"></i><b>13.6.6.2</b> Varying intercepts model:</a></li>
<li class="chapter" data-level="13.6.6.3" data-path="ch-13-models-with-memory.html"><a href="ch-13-models-with-memory.html#extract-samples"><i class="fa fa-check"></i><b>13.6.6.3</b> Extract samples</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html"><i class="fa fa-check"></i><b>14</b> Ch 14 - Advuntetures in Coviaraince</a>
<ul>
<li class="chapter" data-level="14.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>14.1</b> Varying slopes by construction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-the-population"><i class="fa fa-check"></i><b>14.1.1</b> Simulate the population</a></li>
<li class="chapter" data-level="14.1.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#simulate-observations"><i class="fa fa-check"></i><b>14.1.2</b> Simulate observations</a></li>
<li class="chapter" data-level="14.1.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>14.1.3</b> The varying slopes model</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>14.2</b> Advanced varying slopes</a>
<ul>
<li class="chapter" data-level="14.2.0.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#inference"><i class="fa fa-check"></i><b>14.2.0.1</b> Inference!</a></li>
<li class="chapter" data-level="14.2.0.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#conclusions---multilevel-horoscopes"><i class="fa fa-check"></i><b>14.2.0.2</b> Conclusions - multilevel horoscopes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#exercises-7"><i class="fa fa-check"></i><b>14.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e1-2"><i class="fa fa-check"></i><b>14.3.1</b> E1</a></li>
<li class="chapter" data-level="14.3.2" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#e3-2"><i class="fa fa-check"></i><b>14.3.2</b> E3</a></li>
<li class="chapter" data-level="14.3.3" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h1-5"><i class="fa fa-check"></i><b>14.3.3</b> H1</a></li>
<li class="chapter" data-level="14.3.4" data-path="ch-14-advuntetures-in-coviaraince.html"><a href="ch-14-advuntetures-in-coviaraince.html#h2-5"><i class="fa fa-check"></i><b>14.3.4</b> H2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html"><i class="fa fa-check"></i><b>15</b> Ch 14 - Adventures in Covariance</a>
<ul>
<li class="chapter" data-level="15.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#ch-14.3---instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.1</b> Ch 14.3 - Instruments and causal designs</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#instrumental-variables"><i class="fa fa-check"></i><b>15.1.1</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.1.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#only-including-e-we-add-confounding-effect-sideeffect-of-e"><i class="fa fa-check"></i><b>15.1.1.1</b> 1. Only including E (we add confounding effect sideeffect of E)</a></li>
<li class="chapter" data-level="15.1.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#adding-instrument-q-the-wrong-way"><i class="fa fa-check"></i><b>15.1.1.2</b> 2. Adding instrument Q (the wrong way)</a></li>
<li class="chapter" data-level="15.1.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#correct-use-of-the-instrument-variable"><i class="fa fa-check"></i><b>15.1.1.3</b> 3. Correct use of the instrument variable</a></li>
</ul></li>
<li class="chapter" data-level="15.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#other-designs"><i class="fa fa-check"></i><b>15.1.2</b> Other designs</a>
<ul>
<li class="chapter" data-level="15.1.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#front-door-criterion"><i class="fa fa-check"></i><b>15.1.2.1</b> Front-Door Criterion</a></li>
<li class="chapter" data-level="15.1.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#regression-discontinuity-rdd"><i class="fa fa-check"></i><b>15.1.2.2</b> Regression discontinuity (RDD)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-processes-continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.2</b> (Gaussian Processes) Continuous categories and the Gaussian process</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-spatial-autocorrelation-in-oceanic-tools"><i class="fa fa-check"></i><b>15.2.1</b> Example: Spatial autocorrelation in Oceanic tools</a>
<ul>
<li class="chapter" data-level="15.2.1.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#loading-data-defining-model"><i class="fa fa-check"></i><b>15.2.1.1</b> Loading data + defining model</a></li>
<li class="chapter" data-level="15.2.1.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#the-full-model"><i class="fa fa-check"></i><b>15.2.1.2</b> The full model</a></li>
<li class="chapter" data-level="15.2.1.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#gaussian-process-posterior"><i class="fa fa-check"></i><b>15.2.1.3</b> Gaussian Process Posterior</a></li>
</ul></li>
<li class="chapter" data-level="15.2.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#example-phylogenetic-distance-not-in-the-curriculum"><i class="fa fa-check"></i><b>15.2.2</b> Example: Phylogenetic distance (not in the curriculum)</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#exercises-8"><i class="fa fa-check"></i><b>15.3</b> Exercises</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m3-3"><i class="fa fa-check"></i><b>15.3.1</b> M3</a></li>
<li class="chapter" data-level="15.3.2" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#m4-3"><i class="fa fa-check"></i><b>15.3.2</b> M4</a></li>
<li class="chapter" data-level="15.3.3" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h2-6"><i class="fa fa-check"></i><b>15.3.3</b> H2</a></li>
<li class="chapter" data-level="15.3.4" data-path="ch-14-adventures-in-covariance.html"><a href="ch-14-adventures-in-covariance.html#h4-varying-intercepts-varying-slopes"><i class="fa fa-check"></i><b>15.3.4</b> H4 Varying intercepts Varying slopes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Data Analysis Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ch-14---advuntetures-in-coviaraince" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Ch 14 - Advuntetures in Coviaraince</h1>
<blockquote>
<p><strong>Important note</strong> Jesper and Richard use brackets for vectors and paranthesis for matrices.</p>
</blockquote>
<p>in the previous chapter we saw how varying intercepts can help the model distinguish between different groups in the data. Now we are going to explore how varying slopes also can come in hand.</p>
<p>Thus with varying intercepts we are basically able to have a model with different means for the given groups. And with the slopes we are able to build ‘massive interaction machines.’</p>
<p>Up until now we have only worked with unordered categorical variables, although in this chapter we will also take on variables of continous categories, that will be done with gaussian processes (whatever that is).</p>
<p>We are also going to do inference on instrumental variables, that is inferring cause without closing the backdoor paths.</p>
<p>Why multilevel models with varying slopes? We see that only focusing on averages and even varying intercepts we see that we are generalizing and hence loosing information. Thus including varying intercepts we may end up with a conclusion where we can conclude one thing for a part of the data and another for another part of the data.</p>
<div id="varying-slopes-by-construction" class="section level2" number="14.1">
<h2><span class="header-section-number">14.1</span> Varying slopes by construction</h2>
<p>We need a 2-dimensional Gaussian distribution to represent the slope and the intercept.</p>
<p>Then we also need a correlation matrix, as we need sigmas for each parameter, as they can practically have their own spread.</p>
<p><img src="Images/paste-DCA25A95.png" /></p>
<p>The varying slopes model, we see the following model:</p>
<p><img src="Images/paste-DBBCDD03.png" width="264" /></p>
<p>We see that:</p>
<ul>
<li><p>mu = is the linear model with the varying intercepts and the varying slopes</p></li>
<li><p>The matrix = the mutlivariate prior. one for each cafe and one for if it is in the afternoon.</p></li>
<li><p>S = the covariance matrix, see the slides for an example of how that is found. The pc should find the result of this itself.</p></li>
<li><p>The rest (alpha to sigma beta) = is just fixed (non-adaptive) priors.</p>
<ul>
<li><p>Alpha mean = 5, hence we expect to wait five minutes on average with an sd of 2.</p></li>
<li><p>Beta (coefficient for afternoon) = -1 hence we expect to wait less than average in the afternoon. that is with an sd of 0.5.</p></li>
</ul></li>
<li><p>R = correlation matrix prior. We use LKJ prior. That is a nice family of priors. It is simply a distirbution and named after researcher names. This is the correlation between intecepts and slopes, hence we specify the relationship between slopes and intercepts.</p></li>
</ul>
<p>More on the LKJ prior (the onion prior). It looks the following:</p>
<p><img src="Images/paste-0C16324B.png" /></p>
<p>We can adjust eta. When:</p>
<ul>
<li><p>Eta = 1 : we have a uniform correlation matrix.</p></li>
<li><p>Eta &lt; 1 : then it is sceptical according to correlation between slopes and intercepts.</p></li>
<li><p>Eta &gt; 1 : it elevates extreme correlations.</p></li>
</ul>
<div id="simulate-the-population" class="section level3" number="14.1.1">
<h3><span class="header-section-number">14.1.1</span> Simulate the population</h3>
<p>We start with m14.1, where we have random intercepts and slopes.</p>
<p>We start by simulating the cafés that the robot is going to visit in the next subsection.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb356-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">3.5</span> <span class="co"># average morning wait time</span></span>
<span id="cb356-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb356-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="co"># average difference afternoon wait time</span></span>
<span id="cb356-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb356-3" aria-hidden="true" tabindex="-1"></a>sigma_a <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># std dev in intercepts</span></span>
<span id="cb356-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb356-4" aria-hidden="true" tabindex="-1"></a>sigma_b <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># std dev in slopes</span></span>
<span id="cb356-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb356-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> (<span class="sc">-</span><span class="fl">0.7</span>) <span class="co"># correlation between intercepts and slopes</span></span></code></pre></div>
<p>Now we create a vector of means for alpha and beta. Mean for alpha = general wait time in the morning and beta = wait time in the afternoon.</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb357-1" aria-hidden="true" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">c</span>( a , b )</span>
<span id="cb357-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb357-2" aria-hidden="true" tabindex="-1"></a>Mu</span></code></pre></div>
<pre><code>## [1]  3.5 -1.0</code></pre>
<p>We see that in the afternoon the waits tend to be less.</p>
<p>Now we can build the covariance matrix.</p>
<p>We can build matrices in two ways:</p>
<ol style="list-style-type: decimal">
<li>By using matrix:</li>
</ol>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb359-1" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sigma_a<span class="sc">*</span>sigma_b<span class="sc">*</span>rho</span>
<span id="cb359-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb359-2" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(sigma_a<span class="sc">^</span><span class="dv">2</span>,cov_ab,cov_ab,sigma_b<span class="sc">^</span><span class="dv">2</span>) , <span class="at">ncol=</span><span class="dv">2</span> )</span>
<span id="cb359-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb359-3" aria-hidden="true" tabindex="-1"></a>Sigma</span></code></pre></div>
<pre><code>##       [,1]  [,2]
## [1,]  1.00 -0.35
## [2,] -0.35  0.25</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>By do it more manually</li>
</ol>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb361-1" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_a,sigma_b) <span class="co"># standard deviations</span></span>
<span id="cb361-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb361-2" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>,rho,rho,<span class="dv">1</span>) , <span class="at">nrow=</span><span class="dv">2</span> ) <span class="co"># correlation matrix</span></span>
<span id="cb361-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb361-3" aria-hidden="true" tabindex="-1"></a><span class="co"># now matrix multiply to get covariance matrix</span></span>
<span id="cb361-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb361-4" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span></code></pre></div>
<p>We see that the result is the same.</p>
<p><strong>Now we can simulate</strong> this is just done by randomly sampling from the multivariate Gaussian distribution as we already have Mu and Sigma.</p>
<p>Notice that we will get two vectors, the intecept and the slopes and the matrix we end up having represent the cafés, one for each café.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb362-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb362-2" aria-hidden="true" tabindex="-1"></a>N_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb362-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>) <span class="co"># used to replicate example</span></span>
<span id="cb362-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb362-4" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="at">n =</span> N_cafes , Mu , Sigma )</span>
<span id="cb362-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb362-5" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Each row is a cafe, V1 = intercept, V2 = slope, it is plotted in a following chunk&quot;</span>)</span></code></pre></div>
<pre><code>## Each row is a cafe, V1 = intercept, V2 = slope, it is plotted in a following chunk</code></pre>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vary_effects)</span></code></pre></div>
<pre><code>##          [,1]       [,2]
## [1,] 4.223962 -1.6093565
## [2,] 2.010498 -0.7517704
## [3,] 4.565811 -1.9482646
## [4,] 3.343635 -1.1926539
## [5,] 1.700971 -0.5855618
## [6,] 4.134373 -1.1444539</code></pre>
<p>Now we can take the vectors and store them in a more meaningful object.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb366-1" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">&lt;-</span> vary_effects[,<span class="dv">1</span>]</span>
<span id="cb366-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb366-2" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">&lt;-</span> vary_effects[,<span class="dv">2</span>]</span></code></pre></div>
<p>Now we can plot the intercepts and slopes, we see that the simulated data has a negative correlation. We see that x = intercepts and y = the slopes.</p>
<p>Notice that we use ellipses in the plot, these show the quantiles of the data, in a later plot the actual values are presented. But in general the closer you are to the centrum the more observations we are expected to see. Thus in general the intercepts tends towards 3 - 4 and a slope around -1. Recall that we we:</p>
<ul>
<li>set the mean of alpha = 3.5 and slope to -1 with,</li>
<li>with standard deviations of respectively 1 and 0.5, hence the result is very much expected.</li>
<li>We also explicitly set rho (correlation between slope and intercept) to be -0.7, hence the result is again very much as expected.</li>
<li>If you count the points, you will see that there are 20, one for each café.</li>
</ul>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( a_cafe , b_cafe , <span class="at">col=</span>rangi2 ,</span>
<span id="cb367-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="at">xlab=</span><span class="st">&quot;intercepts (a_cafe)&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;slopes (b_cafe)&quot;</span> )</span>
<span id="cb367-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-3" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay population distribution</span></span>
<span id="cb367-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb367-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( l <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">0.99</span>) )</span>
<span id="cb367-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb367-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">ellipse</span>(Sigma,<span class="at">centre=</span>Mu,<span class="at">level=</span>l),<span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.9-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Now we have simulated the data. It is now left for the robot to visit the cafés. That is done in the following subsection.</p>
</div>
<div id="simulate-observations" class="section level3" number="14.1.2">
<h3><span class="header-section-number">14.1.2</span> Simulate observations</h3>
<p>Here we will generate the observations that the robot will be making.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb368-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>) <span class="co"># used to replicate example</span></span>
<span id="cb368-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-3" aria-hidden="true" tabindex="-1"></a>N_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb368-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-4" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>( N_cafes , Mu , Sigma )</span>
<span id="cb368-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">22</span>)</span>
<span id="cb368-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-7" aria-hidden="true" tabindex="-1"></a>N_visits <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb368-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-8" aria-hidden="true" tabindex="-1"></a>a_cafe <span class="ot">&lt;-</span> vary_effects[,<span class="dv">1</span>]</span>
<span id="cb368-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-9" aria-hidden="true" tabindex="-1"></a>b_cafe <span class="ot">&lt;-</span> vary_effects[,<span class="dv">2</span>]</span>
<span id="cb368-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-11" aria-hidden="true" tabindex="-1"></a>afternoon <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,N_visits<span class="sc">*</span>N_cafes<span class="sc">/</span><span class="dv">2</span>) <span class="co">#Every second is afternoon</span></span>
<span id="cb368-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-12" aria-hidden="true" tabindex="-1"></a>cafe_id <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="dv">1</span><span class="sc">:</span>N_cafes , <span class="at">each=</span>N_visits ) <span class="co">#Each café is visited 10 times</span></span>
<span id="cb368-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-13" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> a_cafe[cafe_id] <span class="sc">+</span> b_cafe[cafe_id]<span class="sc">*</span>afternoon <span class="co">#Mean waiting times, every second is lower as it is afternoon.</span></span>
<span id="cb368-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-14" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># std dev within cafes</span></span>
<span id="cb368-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-15" aria-hidden="true" tabindex="-1"></a>wait <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N_visits<span class="sc">*</span>N_cafes , mu , sigma ) <span class="co">#The wait is defined by normal distribution based on mu and sigma</span></span>
<span id="cb368-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Collect information in a data frame</span></span>
<span id="cb368-18"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-18" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">cafe=</span>cafe_id , <span class="at">afternoon=</span>afternoon , <span class="at">wait=</span>wait )</span>
<span id="cb368-19"><a href="ch-14-advuntetures-in-coviaraince.html#cb368-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d,<span class="dv">15</span>)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">cafe</th>
<th align="right">afternoon</th>
<th align="right">wait</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3.967893</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3.857198</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.727875</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.761013</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.119483</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">3.543652</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.190949</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.533224</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">4.124032</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">2.764887</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1.628544</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1.299709</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">2.382012</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1.216717</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1.614051</td>
</tr>
</tbody>
</table>
</div>
<p>We can also plot them agains each other, here it is clear that each café is having very different mean waiting times</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span>
<span id="cb369-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(magrittr)</span></span>
<span id="cb369-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-3" aria-hidden="true" tabindex="-1"></a><span class="co"># d1 &lt;- d %&gt;% </span></span>
<span id="cb369-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(cafe,afternoon) %&gt;% </span></span>
<span id="cb369-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(mu_group = mean(wait)) %&gt;% </span></span>
<span id="cb369-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-wait) %&gt;% </span></span>
<span id="cb369-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct()</span></span>
<span id="cb369-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb369-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb369-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(d1,col = alpha(d1$afternoon + 1, 0.5), pch=16,main = &quot;Black = morning, red = afternoon&quot;)</span></span></code></pre></div>
<p><img src="Images/paste-18F9298B.png" /></p>
<p>Notice that in the windoes with café each horizontal line is a cafe and wee see the different expected waiting times based on the time of the day. We see that overall the waiting time is the largest in the afternoon and also the cafés are differnt, some have a longer waiting time than the other.</p>
<p>Thus it is interesting to have multiple levels on the slopes as well.</p>
</div>
<div id="the-varying-slopes-model" class="section level3" number="14.1.3">
<h3><span class="header-section-number">14.1.3</span> The varying slopes model</h3>
<p>This section elaborates on how we need to add the varying effects (the varying slopes). To do this, one must construct a matrix with the parameters for each group. We see in the following chunk that we have a matrix given <span class="math inline">\(\alpha_{cafe}\)</span> and <span class="math inline">\(\beta_{cafe}\)</span>. Whenever you see the square brackets it basically means that it is a matrix. Notice that the varying effects is explained by a multivariate normal distribution, basically a distribution based on more than one distribution, try to google it for visualization.</p>
<p>Then we have S here the standard deviations is multiplied by R times the stadnard deviations. R is typically given by LKJcorr distribution.</p>
<p>LKJcorr is a distribution that is explained by eta. It takes the following shapes:</p>
<ul>
<li>eta = 1, then uniform correlation matrices</li>
<li>eta &gt; 1, then correlation between intersect and slopes, but not extreme</li>
<li>eta &lt; 1, elevates extreme correlations</li>
</ul>
<p>An example:</p>
<p><img src="Images/paste-B415E975.png" /></p>
<p>In the following an example is also plotted.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb370-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">rlkjcorr</span>( <span class="fl">1e4</span> , <span class="at">K=</span><span class="dv">2</span> , <span class="at">eta=</span><span class="dv">2</span> )</span>
<span id="cb370-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( R[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">xlab=</span><span class="st">&quot;correlation&quot;</span> )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.11-1.png" width="720" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">867530</span>)</span>
<span id="cb371-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-2" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb371-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb371-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-4" aria-hidden="true" tabindex="-1"></a>    wait <span class="sc">~</span> <span class="fu">normal</span>( mu , sigma ),</span>
<span id="cb371-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a_cafe[cafe] <span class="sc">+</span> b_cafe[cafe]<span class="sc">*</span>afternoon,</span>
<span id="cb371-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a_cafe,b_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(a,b) , Rho , sigma_cafe ),</span>
<span id="cb371-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; a = alpha, b = beta, this create a matrix, hence each</span></span>
<span id="cb371-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; row in the matrix = a cafe, that has a pair of params, a and b</span></span>
<span id="cb371-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-9" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; We then write multi_normal, where provide the a and be params</span></span>
<span id="cb371-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-10" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; Ulam knows how Rho matrix needs to be set up.</span></span>
<span id="cb371-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb371-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-12" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb371-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-13" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb371-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-14" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb371-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-15" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb371-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-16" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>) <span class="co">#i.e., the onion prior. Eta = 2</span></span>
<span id="cb371-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb371-17" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>d , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb373-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m14<span class="fl">.1</span>)</span>
<span id="cb373-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( post<span class="sc">$</span>Rho[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) ) <span class="co"># posterior</span></span>
<span id="cb373-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb373-3" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">rlkjcorr</span>( <span class="fl">1e4</span> , <span class="at">K=</span><span class="dv">2</span> , <span class="at">eta=</span><span class="dv">2</span> ) <span class="co"># prior</span></span>
<span id="cb373-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb373-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( R[,<span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">add=</span><span class="cn">TRUE</span> , <span class="at">lty=</span><span class="dv">2</span> )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.13-1.png" width="720" style="display: block; margin: auto;" /></p>
<p><em>Notice that the dotted line is the prior and the solid line is the posterior.</em></p>
<p>We see that almost all of the mass is between zero, hence a negative relationship. That is as expected as that is what we modeled it for.</p>
<p>Now we can plot the differences between the raw data values (blue points) hence fixed effects estimates. The open circles are the varying effects estimates. Hence we see that the varying effects model is producing a bit different results. That is the product of being able to differentiate the model between different categories (cafés and waiting time) in the data.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute unpooled estimates directly from data</span></span>
<span id="cb374-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-2" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>N_cafes ,</span>
<span id="cb374-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(i) <span class="fu">mean</span>(wait[cafe_id<span class="sc">==</span>i <span class="sc">&amp;</span> afternoon<span class="sc">==</span><span class="dv">0</span>]) )</span>
<span id="cb374-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span>N_cafes ,</span>
<span id="cb374-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(i) <span class="fu">mean</span>(wait[cafe_id<span class="sc">==</span>i <span class="sc">&amp;</span> afternoon<span class="sc">==</span><span class="dv">1</span>]) ) <span class="sc">-</span> a1</span>
<span id="cb374-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior means of partially pooled estimates</span></span>
<span id="cb374-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-8" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m14<span class="fl">.1</span>)</span>
<span id="cb374-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-9" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>a_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb374-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-10" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">apply</span>( post<span class="sc">$</span>b_cafe , <span class="dv">2</span> , mean )</span>
<span id="cb374-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot both and connect with lines</span></span>
<span id="cb374-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( a1 , b1 , <span class="at">xlab=</span><span class="st">&quot;intercept&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;slope&quot;</span> ,</span>
<span id="cb374-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch=</span><span class="dv">16</span> , <span class="at">col=</span>rangi2 , <span class="at">ylim=</span><span class="fu">c</span>( <span class="fu">min</span>(b1)<span class="sc">-</span><span class="fl">0.1</span> , <span class="fu">max</span>(b1)<span class="sc">+</span><span class="fl">0.1</span> ) ,</span>
<span id="cb374-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim=</span><span class="fu">c</span>( <span class="fu">min</span>(a1)<span class="sc">-</span><span class="fl">0.1</span> , <span class="fu">max</span>(a1)<span class="sc">+</span><span class="fl">0.1</span> ) )</span>
<span id="cb374-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( a2 , b2 , <span class="at">pch=</span><span class="dv">1</span> )</span>
<span id="cb374-18"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-19"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N_cafes ) <span class="fu">lines</span>( <span class="fu">c</span>(a1[i],a2[i]) , <span class="fu">c</span>(b1[i],b2[i]) )</span>
<span id="cb374-20"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-21"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-21" aria-hidden="true" tabindex="-1"></a><span class="co"># compute posterior mean bivariate Gaussian 14.15</span></span>
<span id="cb374-22"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-22" aria-hidden="true" tabindex="-1"></a>Mu_est <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(post<span class="sc">$</span>a) , <span class="fu">mean</span>(post<span class="sc">$</span>b) )</span>
<span id="cb374-23"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-23" aria-hidden="true" tabindex="-1"></a>rho_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>Rho[,<span class="dv">1</span>,<span class="dv">2</span>] )</span>
<span id="cb374-24"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-24" aria-hidden="true" tabindex="-1"></a>sa_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">1</span>] )</span>
<span id="cb374-25"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-25" aria-hidden="true" tabindex="-1"></a>sb_est <span class="ot">&lt;-</span> <span class="fu">mean</span>( post<span class="sc">$</span>sigma_cafe[,<span class="dv">2</span>] )</span>
<span id="cb374-26"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-26" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sa_est<span class="sc">*</span>sb_est<span class="sc">*</span>rho_est</span>
<span id="cb374-27"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-27" aria-hidden="true" tabindex="-1"></a>Sigma_est <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(sa_est<span class="sc">^</span><span class="dv">2</span>,cov_ab,cov_ab,sb_est<span class="sc">^</span><span class="dv">2</span>) , <span class="at">ncol=</span><span class="dv">2</span> )</span>
<span id="cb374-28"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-28" aria-hidden="true" tabindex="-1"></a><span class="co"># draw contours</span></span>
<span id="cb374-29"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb374-30"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( l <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.8</span>,<span class="fl">0.99</span>) )</span>
<span id="cb374-31"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">ellipse</span>(Sigma_est,<span class="at">centre=</span>Mu_est,<span class="at">level=</span>l),</span>
<span id="cb374-32"><a href="ch-14-advuntetures-in-coviaraince.html#cb374-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.14-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Plot interpretation:</p>
<ul>
<li><p>The contours of the inferred population, thus the multivariate distribution that is learned from the data. We see that each ellipse is the quantiles of the data. hence 50 = 50% of the data.</p></li>
<li><p>We see that we have a couple of observations with a high slope (top of the graph). We see that the model is skeptical of that. Although when it regularize that, it also alters the intercept, that is because the model knows that slope and intercept is correlated.</p></li>
</ul>
</div>
</div>
<div id="advanced-varying-slopes" class="section level2" number="14.2">
<h2><span class="header-section-number">14.2</span> Advanced varying slopes</h2>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb375-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span>
<span id="cb375-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> chimpanzees</span>
<span id="cb375-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>block_id <span class="ot">&lt;-</span> d<span class="sc">$</span>block</span>
<span id="cb375-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-6" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>treatment <span class="ot">&lt;-</span> 1L <span class="sc">+</span> d<span class="sc">$</span>prosoc_left <span class="sc">+</span> 2L<span class="sc">*</span>d<span class="sc">$</span>condition</span>
<span id="cb375-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-8" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb375-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">L =</span> d<span class="sc">$</span>pulled_left,</span>
<span id="cb375-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tid =</span> d<span class="sc">$</span>treatment,</span>
<span id="cb375-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">actor =</span> d<span class="sc">$</span>actor,</span>
<span id="cb375-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">block_id =</span> <span class="fu">as.integer</span>(d<span class="sc">$</span>block_id) )</span>
<span id="cb375-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4387510</span>)</span>
<span id="cb375-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-15" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb375-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb375-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb375-18"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-18" aria-hidden="true" tabindex="-1"></a>    L <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>,p),</span>
<span id="cb375-19"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> g[tid] <span class="sc">+</span> alpha[actor,tid] <span class="sc">+</span> beta[block_id,tid],</span>
<span id="cb375-20"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-20" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; After alpha we have a matrix consisting of actor and treatment</span></span>
<span id="cb375-21"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; alpha = an actor and tid = treatment, hence for each actor there </span></span>
<span id="cb375-22"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; is information about the given actor and its treatment.</span></span>
<span id="cb375-23"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb375-24"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; It goes the same for the blocks, where the matrix consists of:</span></span>
<span id="cb375-25"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">#&#39; row values = block id and each column = treamtnent id</span></span>
<span id="cb375-26"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb375-27"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adaptive priors</span></span>
<span id="cb375-28"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-28" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>alpha[actor] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>,Rho_actor,sigma_actor),</span>
<span id="cb375-29"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-29" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; We jave a matrix consisting of 4 treatments and the actors</span></span>
<span id="cb375-30"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-30" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; vector[4] = we have four different treatments</span></span>
<span id="cb375-31"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; It is distributed as a multivariate normal distribution</span></span>
<span id="cb375-32"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-32" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; Rho actor = a matrix, the model already knows that</span></span>
<span id="cb375-33"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-33" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; sigma_actor = a vector of length 4</span></span>
<span id="cb375-34"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-34" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>beta[block_id] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>,Rho_block,sigma_block),</span>
<span id="cb375-35"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb375-36"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed priors</span></span>
<span id="cb375-37"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-37" aria-hidden="true" tabindex="-1"></a>    g[tid] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb375-38"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-38" aria-hidden="true" tabindex="-1"></a>    sigma_actor <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>), </span>
<span id="cb375-39"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-39" aria-hidden="true" tabindex="-1"></a>    Rho_actor <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">4</span>), <span class="co">#The onion prior, eta = 4 to regulaize</span></span>
<span id="cb375-40"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-40" aria-hidden="true" tabindex="-1"></a>    sigma_block <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb375-41"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-41" aria-hidden="true" tabindex="-1"></a>    Rho_block <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">4</span>) <span class="co">#the onion prior, just for the blovks</span></span>
<span id="cb375-42"><a href="ch-14-advuntetures-in-coviaraince.html#cb375-42" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>dat , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<p>We see that we are getting a lot of divergent transitions, that is what we have seen before, thus we <strong>should do the non centered model</strong>.</p>
<p>This is similar varying intercepts, although it is a bit more complex when having varying slopes.</p>
<p>To do this we are going to apply a Cholesky method (Cholesky Magic) this is done internally. There is an example of this in the slides, although it appears to be outside of the course scope.</p>
<p><strong>Now we are going to do the uncentered model (respecify the model)</strong></p>
<p>the non-centered model is simply just a standardized model, where all data is standardized (z-normal)</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4387510</span>)</span>
<span id="cb377-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-2" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb377-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb377-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-5" aria-hidden="true" tabindex="-1"></a>    L <span class="sc">~</span> <span class="fu">binomial</span>(<span class="dv">1</span>,p),</span>
<span id="cb377-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> g[tid] <span class="sc">+</span> alpha[actor,tid] <span class="sc">+</span> beta[block_id,tid],</span>
<span id="cb377-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; We have matrices for alpha and beta, rows = actor / block and columns = treatment id</span></span>
<span id="cb377-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb377-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adaptive priors - non-centered</span></span>
<span id="cb377-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-10" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[actor,<span class="dv">4</span>]<span class="sc">:</span>alpha <span class="ot">&lt;-</span> <span class="co">#rows = actors, columns = treatments</span></span>
<span id="cb377-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">compose_noncentered</span>( sigma_actor , L_Rho_actor , z_actor ),</span>
<span id="cb377-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb377-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-13" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; Transparse is just fitting the code into a stan framework</span></span>
<span id="cb377-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; L_Rho_actor is some cholesky scores and z_actor is some z-scores for each actor</span></span>
<span id="cb377-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb377-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-16" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[block_id,<span class="dv">4</span>]<span class="sc">:</span>beta <span class="ot">&lt;-</span></span>
<span id="cb377-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">compose_noncentered</span>( sigma_block , L_Rho_block , z_block ),</span>
<span id="cb377-18"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-18" aria-hidden="true" tabindex="-1"></a>      matrix[<span class="dv">4</span>,actor]<span class="sc">:</span>z_actor <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb377-19"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-19" aria-hidden="true" tabindex="-1"></a>      matrix[<span class="dv">4</span>,block_id]<span class="sc">:</span>z_block <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="dv">1</span> ),</span>
<span id="cb377-20"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb377-21"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed priors</span></span>
<span id="cb377-22"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-22" aria-hidden="true" tabindex="-1"></a>    g[tid] <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb377-23"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-23" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>sigma_actor <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb377-24"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-24" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">4</span>]<span class="sc">:</span>L_Rho_actor <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>( <span class="dv">2</span> ),  <span class="co">#The correlation between actor and treatment</span></span>
<span id="cb377-25"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-25" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; cholesky version of LKJ</span></span>
<span id="cb377-26"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-26" aria-hidden="true" tabindex="-1"></a>      <span class="co">#&#39; LKJ distribution is still used</span></span>
<span id="cb377-27"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-27" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>sigma_block <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb377-28"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-28" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">4</span>]<span class="sc">:</span>L_Rho_block <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>( <span class="dv">2</span> ), <span class="co">#The correlation between block and treatment</span></span>
<span id="cb377-29"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb377-30"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute ordinary correlation matrixes from Cholesky factors</span></span>
<span id="cb377-31"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-31" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">4</span>,<span class="dv">4</span>]<span class="sc">:</span>Rho_actor <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>(L_Rho_actor),</span>
<span id="cb377-32"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-32" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">4</span>,<span class="dv">4</span>]<span class="sc">:</span>Rho_block <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>(L_Rho_block)</span>
<span id="cb377-33"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-33" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb377-34"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-34" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">data=</span>dat </span>
<span id="cb377-35"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-35" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">chains=</span><span class="dv">4</span> </span>
<span id="cb377-36"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-36" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">cores=</span><span class="dv">4</span> </span>
<span id="cb377-37"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-37" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">log_lik=</span><span class="cn">TRUE</span> </span>
<span id="cb377-38"><a href="ch-14-advuntetures-in-coviaraince.html#cb377-38" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
## clang -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG   -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DBOOST_NO_AUTO_PTR  -include &#39;/Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/usr/local/include   -fPIC  -Wall -g -O2  -c foo.c -o foo.o
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:88:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:1: error: unknown type name &#39;namespace&#39;
## namespace Eigen {
## ^
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:628:16: error: expected &#39;;&#39; after top level declarator
## namespace Eigen {
##                ^
##                ;
## In file included from &lt;built-in&gt;:1:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/StanHeaders/include/stan/math/prim/mat/fun/Eigen.hpp:13:
## In file included from /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Dense:1:
## /Library/Frameworks/R.framework/Versions/4.0/Resources/library/RcppEigen/include/Eigen/Core:96:10: fatal error: &#39;complex&#39; file not found
## #include &lt;complex&gt;
##          ^~~~~~~~~
## 3 errors generated.
## make: *** [foo.o] Error 1</code></pre>
<p>Now we will see that the model produce much more efficient results, although the result is the exact same, the model is simply just able to explore the probability regions more effectively.</p>
<p>We see from the following plot that the effective samples fro the non-centered model is far better.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract n_eff values for each model</span></span>
<span id="cb379-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-2" aria-hidden="true" tabindex="-1"></a>neff_nc <span class="ot">&lt;-</span> <span class="fu">precis</span>(m14<span class="fl">.3</span>,<span class="dv">3</span>,<span class="at">pars=</span><span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>,<span class="st">&quot;beta&quot;</span>))<span class="sc">$</span>n_eff</span>
<span id="cb379-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-3" aria-hidden="true" tabindex="-1"></a>neff_c <span class="ot">&lt;-</span> <span class="fu">precis</span>(m14<span class="fl">.2</span>,<span class="dv">3</span>,<span class="at">pars=</span><span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>,<span class="st">&quot;beta&quot;</span>))<span class="sc">$</span>n_eff</span>
<span id="cb379-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( neff_c , neff_nc , <span class="at">xlab=</span><span class="st">&quot;centered (default)&quot;</span> ,</span>
<span id="cb379-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-5" aria-hidden="true" tabindex="-1"></a><span class="at">ylab=</span><span class="st">&quot;non-centered (cholesky)&quot;</span> , <span class="at">lwd=</span><span class="fl">1.5</span> )</span>
<span id="cb379-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb379-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span><span class="dv">0</span>,<span class="at">b=</span><span class="dv">1</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/unnamed-chunk-189-1.png" width="720" style="display: block; margin: auto;" /></p>
<div id="inference" class="section level4" number="14.2.0.1">
<h4><span class="header-section-number">14.2.0.1</span> Inference!</h4>
<p>Here we will see the effects, the first 4 being the actor effects (one for each treatment) and the same principle with the blocks, one for each treamt</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( m14<span class="fl">.3</span> , <span class="at">depth=</span><span class="dv">2</span> , <span class="at">pars=</span><span class="fu">c</span>(<span class="st">&quot;sigma_actor&quot;</span>,<span class="st">&quot;sigma_block&quot;</span>) )</span></code></pre></div>
<div class="kable-table">
<table class="kable_wrapper">
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.3769325</td>
</tr>
<tr class="even">
<td align="right">0.8929684</td>
</tr>
<tr class="odd">
<td align="right">1.8338578</td>
</tr>
<tr class="even">
<td align="right">1.5753516</td>
</tr>
<tr class="odd">
<td align="right">0.4065954</td>
</tr>
<tr class="even">
<td align="right">0.4319259</td>
</tr>
<tr class="odd">
<td align="right">0.2968035</td>
</tr>
<tr class="even">
<td align="right">0.4580187</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4818628</td>
</tr>
<tr class="even">
<td align="right">0.4216382</td>
</tr>
<tr class="odd">
<td align="right">0.5425387</td>
</tr>
<tr class="even">
<td align="right">0.6021124</td>
</tr>
<tr class="odd">
<td align="right">0.3257347</td>
</tr>
<tr class="even">
<td align="right">0.3365054</td>
</tr>
<tr class="odd">
<td align="right">0.2845219</td>
</tr>
<tr class="even">
<td align="right">0.3720914</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.7620038</td>
</tr>
<tr class="even">
<td align="right">0.3914742</td>
</tr>
<tr class="odd">
<td align="right">1.1096785</td>
</tr>
<tr class="even">
<td align="right">0.8333287</td>
</tr>
<tr class="odd">
<td align="right">0.0321586</td>
</tr>
<tr class="even">
<td align="right">0.0348733</td>
</tr>
<tr class="odd">
<td align="right">0.0228155</td>
</tr>
<tr class="even">
<td align="right">0.0382124</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2.2249059</td>
</tr>
<tr class="even">
<td align="right">1.6097088</td>
</tr>
<tr class="odd">
<td align="right">2.7898991</td>
</tr>
<tr class="even">
<td align="right">2.6362733</td>
</tr>
<tr class="odd">
<td align="right">0.9931536</td>
</tr>
<tr class="even">
<td align="right">1.0264000</td>
</tr>
<tr class="odd">
<td align="right">0.7778716</td>
</tr>
<tr class="even">
<td align="right">1.1011438</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">947.8734</td>
</tr>
<tr class="even">
<td align="right">895.9099</td>
</tr>
<tr class="odd">
<td align="right">1452.2190</td>
</tr>
<tr class="even">
<td align="right">1363.9190</td>
</tr>
<tr class="odd">
<td align="right">1067.7924</td>
</tr>
<tr class="even">
<td align="right">948.9628</td>
</tr>
<tr class="odd">
<td align="right">1209.0866</td>
</tr>
<tr class="even">
<td align="right">1152.5056</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.0027765</td>
</tr>
<tr class="even">
<td align="right">1.0044496</td>
</tr>
<tr class="odd">
<td align="right">0.9999155</td>
</tr>
<tr class="even">
<td align="right">1.0026105</td>
</tr>
<tr class="odd">
<td align="right">1.0029098</td>
</tr>
<tr class="even">
<td align="right">1.0022410</td>
</tr>
<tr class="odd">
<td align="right">0.9998106</td>
</tr>
<tr class="even">
<td align="right">1.0002882</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<p><em>One entry for each treatment.</em></p>
<p>We see that the mean of the blocks is more or less the same, that is because the model has learned that the blocks are basically the same.</p>
<p>Although we see that the mean for sigma actor (variance for each chimp) is the lowest overall. Thus we see for the leftie chimp, the second treatment is also where there is the greatest probability of not pulling the left lever (i.e., lowest probability of pulling the left lever)</p>
<p>Now we can intepret how the estimated data compared to the raw data.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute mean for each actor in each treatment </span></span>
<span id="cb381-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-2" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> <span class="fu">by</span>( d<span class="sc">$</span>pulled_left , <span class="fu">list</span>( d<span class="sc">$</span>actor , d<span class="sc">$</span>treatment ) , mean )</span>
<span id="cb381-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate posterior predictions using link</span></span>
<span id="cb381-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-5" aria-hidden="true" tabindex="-1"></a>datp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb381-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-6" aria-hidden="true" tabindex="-1"></a><span class="at">actor=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,<span class="at">each=</span><span class="dv">4</span>) ,</span>
<span id="cb381-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-7" aria-hidden="true" tabindex="-1"></a><span class="at">tid=</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,<span class="at">times=</span><span class="dv">7</span>) ,</span>
<span id="cb381-8"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-8" aria-hidden="true" tabindex="-1"></a><span class="at">block_id=</span><span class="fu">rep</span>(<span class="dv">5</span>,<span class="at">times=</span><span class="dv">4</span><span class="sc">*</span><span class="dv">7</span>) )</span>
<span id="cb381-9"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-9" aria-hidden="true" tabindex="-1"></a>p_post <span class="ot">&lt;-</span> <span class="fu">link</span>( m14<span class="fl">.3</span> , <span class="at">data=</span>datp )</span>
<span id="cb381-10"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-10" aria-hidden="true" tabindex="-1"></a>p_mu <span class="ot">&lt;-</span> <span class="fu">apply</span>( p_post , <span class="dv">2</span> , mean )</span>
<span id="cb381-11"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-11" aria-hidden="true" tabindex="-1"></a>p_ci <span class="ot">&lt;-</span> <span class="fu">apply</span>( p_post , <span class="dv">2</span> , PI )</span>
<span id="cb381-12"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-13"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot</span></span>
<span id="cb381-14"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span> , <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">28</span>) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>) , <span class="at">xlab=</span><span class="st">&quot;&quot;</span> ,</span>
<span id="cb381-15"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab=</span><span class="st">&quot;proportion left lever&quot;</span> , <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span> , <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span> )</span>
<span id="cb381-16"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-16" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>( <span class="dv">2</span> , <span class="at">at=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>) , <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>) )</span>
<span id="cb381-17"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">h=</span><span class="fl">0.5</span> , <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb381-18"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-19"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span> ) <span class="fu">abline</span>( <span class="at">v=</span>(j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="fl">+4.5</span> , <span class="at">lwd=</span><span class="fl">0.5</span> )</span>
<span id="cb381-20"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span> ) <span class="fu">text</span>( (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="fl">+2.5</span> , <span class="fl">1.1</span> , <span class="fu">concat</span>(<span class="st">&quot;actor &quot;</span>,j) , <span class="at">xpd=</span><span class="cn">TRUE</span> )</span>
<span id="cb381-21"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-22"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-22" aria-hidden="true" tabindex="-1"></a>xo <span class="ot">&lt;-</span> <span class="fl">0.1</span> <span class="co"># offset distance to stagger raw data and predictions</span></span>
<span id="cb381-23"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-24"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-24" aria-hidden="true" tabindex="-1"></a><span class="co"># raw data</span></span>
<span id="cb381-25"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( j <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)[<span class="sc">-</span><span class="dv">2</span>] ) {</span>
<span id="cb381-26"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)<span class="sc">-</span>xo , pl[j,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] , <span class="at">lwd=</span><span class="dv">2</span> , <span class="at">col=</span>rangi2 )</span>
<span id="cb381-27"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)<span class="sc">-</span>xo , pl[j,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)] , <span class="at">lwd=</span><span class="dv">2</span> , <span class="at">col=</span>rangi2 )</span>
<span id="cb381-28"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb381-29"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-30"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-30" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span><span class="sc">-</span>xo , <span class="fu">t</span>(pl) , <span class="at">pch=</span><span class="dv">16</span> , <span class="at">col=</span><span class="st">&quot;white&quot;</span> , <span class="at">cex=</span><span class="fl">1.7</span> )</span>
<span id="cb381-31"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-31" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span><span class="sc">-</span>xo , <span class="fu">t</span>(pl) , <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">16</span>,<span class="dv">16</span>) , <span class="at">col=</span>rangi2 , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb381-32"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-33"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-33" aria-hidden="true" tabindex="-1"></a>yoff <span class="ot">&lt;-</span> <span class="fl">0.175</span></span>
<span id="cb381-34"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-35"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-35" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="dv">1</span><span class="sc">-</span>xo , pl[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">-</span>yoff , <span class="st">&quot;R/N&quot;</span> , <span class="at">pos=</span><span class="dv">1</span> , <span class="at">cex=</span><span class="fl">0.8</span> )</span>
<span id="cb381-36"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-36" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="dv">2</span><span class="sc">-</span>xo , pl[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">+</span>yoff , <span class="st">&quot;L/N&quot;</span> , <span class="at">pos=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">0.8</span> )</span>
<span id="cb381-37"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-37" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="dv">3</span><span class="sc">-</span>xo , pl[<span class="dv">1</span>,<span class="dv">3</span>]<span class="sc">-</span>yoff , <span class="st">&quot;R/P&quot;</span> , <span class="at">pos=</span><span class="dv">1</span> , <span class="at">cex=</span><span class="fl">0.8</span> )</span>
<span id="cb381-38"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-38" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>( <span class="dv">4</span><span class="sc">-</span>xo , pl[<span class="dv">1</span>,<span class="dv">4</span>]<span class="sc">+</span>yoff , <span class="st">&quot;L/P&quot;</span> , <span class="at">pos=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">0.8</span> )</span>
<span id="cb381-39"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-40"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-40" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predictions</span></span>
<span id="cb381-41"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( j <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)[<span class="sc">-</span><span class="dv">2</span>] ) {</span>
<span id="cb381-42"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)<span class="sc">+</span>xo , p_mu[(j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb381-43"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( (j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)<span class="sc">+</span>xo , p_mu[(j<span class="dv">-1</span>)<span class="sc">*</span><span class="dv">4</span><span class="sc">+</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)] , <span class="at">lwd=</span><span class="dv">2</span> )</span>
<span id="cb381-44"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb381-45"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-46"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span> ) <span class="fu">lines</span>( <span class="fu">c</span>(i,i)<span class="sc">+</span>xo , p_ci[,i] , <span class="at">lwd=</span><span class="dv">1</span> )</span>
<span id="cb381-47"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-47" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span><span class="sc">+</span>xo , p_mu , <span class="at">pch=</span><span class="dv">16</span> , <span class="at">col=</span><span class="st">&quot;white&quot;</span> , <span class="at">cex=</span><span class="fl">1.3</span> )</span>
<span id="cb381-48"><a href="ch-14-advuntetures-in-coviaraince.html#cb381-48" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">28</span><span class="sc">+</span>xo , p_mu , <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">16</span>,<span class="dv">16</span>) )</span></code></pre></div>
<p><img src="Bayesian-Data-Analysis-Notes_files/figure-html/14.22-1.png" width="720" style="display: block; margin: auto;" /></p>
<p>Interpretation:</p>
<ul>
<li>blue points is the raw data and the black poinst are the posterior predictions</li>
<li>We see the actor is simply just very left handed. If we then look at the meean for actor 2, we see that it is the lowest, that is because this is shrunk the most.</li>
</ul>
</div>
<div id="conclusions---multilevel-horoscopes" class="section level4" number="14.2.0.2">
<h4><span class="header-section-number">14.2.0.2</span> Conclusions - multilevel horoscopes</h4>
<p>Basically people tend to want defaults model given the data although there is no such thing. you should follow this flow:</p>
<ol style="list-style-type: decimal">
<li><p>Think about the causal model first</p></li>
<li><p>Begin with ‘empty’ model with varying intercept on relevant clusters</p></li>
<li><p>Standardize predictors</p></li>
<li><p>Use regularizing priors (simulate)</p></li>
<li><p>Add in predictors and vary their slopes</p></li>
<li><p>Can drop varying effects with tiny sigmas</p></li>
<li><p>Consider two sorts of posterior prediction</p>
<ol style="list-style-type: lower-alpha">
<li>Same units: What happened in these data?</li>
<li>New units: What might we expect for new units?</li>
</ol></li>
<li><p>Your knowledge of domain trumps all</p></li>
</ol>
</div>
</div>
<div id="exercises-7" class="section level2" number="14.3">
<h2><span class="header-section-number">14.3</span> Exercises</h2>
<div id="e1-2" class="section level3" number="14.3.1">
<h3><span class="header-section-number">14.3.1</span> E1</h3>
<p><em>Add to the following model varying slopes on the predictor x.</em></p>
<p><img src="Images/paste-292D958D.png" /></p>
<p>notice that in the new edition we just use exponential instead of halfcauchy.</p>
<p><span class="math display">\[
\begin{align*}
\text{First the probability of the data and the linear model} \\ \\
y_i \sim Normial(\mu_i,\sigma) &amp;&amp; \text{Likelihood} \\ 
\mu_i = \alpha_{GROUP[i]} + \beta_{GROUP[i]} x_i &amp;&amp; \text{Linear model} \\
\\ \text{Then matrix of varying intercepts and slopes, with its covariance matrix} \\ \\
\begin{bmatrix} \alpha_{GROUP[i]} \\ \beta_{GROUP[i]} \\ \end{bmatrix} \sim MVNormal( \begin{bmatrix} \alpha \\ \beta \\ \end{bmatrix} ,S) &amp;&amp; \text{Population of varying effects} \\
S = \begin{pmatrix} \sigma_\alpha &amp; 0 \\ 0 &amp; \sigma_\beta  \end{pmatrix} R \begin{pmatrix} \sigma_\alpha &amp; 0 \\ 0 &amp; \sigma_\beta \\  \end{pmatrix} &amp;&amp; \text{construct covariance matrix} \\ 
\\ \text{Then the hyper priors} \\ \\
\alpha \sim Normal(0,10) \\
\beta \sim Normal(0,1) \\
\sigma \sim Exponential(1) \\
\sigma\_\alpha \sim Exponential(1) \\
R \sim LKJcorr(2) &amp;&amp; \text{We assume intecept / slope correlations but not too strong}
\end{align*}
\]</span></p>
<p>Notice that the MVNormal([]) means a matrix, that being the [] inside a matrix, that being the ().</p>
<p>Notes on LKJCorr, notice that this distribution is the assumed relationship between slopes and intercepts, the LKJCorr is good distriubtion to make these assimptions, examples:</p>
<p><img src="Images/paste-9A99924F.png" /></p>
<p>We see that it goes from -1 to 1, thus we are able to use other distributions although this just suits very well. The higher the LKJCorr the closer to 0 are we certain that the correlation is.</p>
</div>
<div id="e3-2" class="section level3" number="14.3.2">
<h3><span class="header-section-number">14.3.2</span> E3</h3>
<p><em>When is it possible for a varying slopes model to have fewer effective parameters (as estimated by WAIC or DIC) than the corresponding model with fixed (unpooled) slopes? Explain</em></p>
<p>We saw in the exercise and in the chapter, that the multilevel model is having an adaptive regularization, so if we see that there is little variance in the data we will observe that the multilevel model is able to regularize the model and thus recognize that it needs less ‘wiggle’ to fit the model.</p>
</div>
<div id="h1-5" class="section level3" number="14.3.3">
<h3><span class="header-section-number">14.3.3</span> H1</h3>
<p>Let’s revisit the Bangladesh fertility data, <code>data(bangladesh)</code>, from the practice problems for Chapter 13. <em>Fit a model with both varying intercepts by district_id</em> and <em>varying slopes of urban by district_id</em>. You are still predicting use contraception. Inspect the correlation between the intercepts and slopes.</p>
<p>Can you interpret this correlation, in terms of what it tells you about the pattern of contraceptive use in the sample?</p>
<p>It might help to plot the mean (or median) varying effect estimates for both the intercepts and slopes, by district.</p>
<p>Then you can visualize the correlation and maybe more easily think through what it means to have a particular correlation. Plotting predicted proportion of women using contraception, with urban women on one axis and rural on the other, might also help.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb382-2"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(bangladesh)</span>
<span id="cb382-3"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> bangladesh</span>
<span id="cb382-4"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>district_id <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(d<span class="sc">$</span>district))</span>
<span id="cb382-5"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-5" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb382-6"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> d<span class="sc">$</span>use.contraception,</span>
<span id="cb382-7"><a href="ch-14-advuntetures-in-coviaraince.html#cb382-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">did =</span> d<span class="sc">$</span>district_id )</span></code></pre></div>
</div>
<div id="h2-5" class="section level3" number="14.3.4">
<h3><span class="header-section-number">14.3.4</span> H2</h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ch-13-models-with-memory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch-14-adventures-in-covariance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
